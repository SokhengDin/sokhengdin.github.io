[{"data":1,"prerenderedAt":1541},["Reactive",2],{"content-/topics/linear-mpc":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"_empty":6,"title":8,"description":9,"author":10,"slug":11,"tag":11,"body":12,"_type":1536,"_id":1537,"_source":1538,"_file":1539,"_extension":1540},"/topics/linear-mpc","topics",false,"","Linear Model Predictive Control","Introduction to Linear Model Predictive Control","Din Sokheng","linear-mpc",{"type":13,"children":14,"toc":1528},"root",[15,24,30,69,80,87,92,97,106,111,116,122,127,131,136,161,167,172,182,188,194,213,221,226,300,305,510,523,736,746,1187,1204,1415,1420,1500,1512,1518,1523],{"type":16,"tag":17,"props":18,"children":20},"element","h1",{"id":19},"what-is-model-predictive-control",[21],{"type":22,"value":23},"text","What is Model Predictive Control ?",{"type":16,"tag":25,"props":26,"children":27},"p",{},[28],{"type":22,"value":29},"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system.",{"type":16,"tag":31,"props":32,"children":39},"div",{"className":33},[34,35,36,37,38],"grid","grid-cols-2","space-x-10","justify-center","items-center",[40,59],{"type":16,"tag":41,"props":42,"children":47},"figure",{"className":43},[44,45,46],"mb-4","inline-block","max-w-sm",[48,50],{"type":22,"value":49},"\n  ",{"type":16,"tag":51,"props":52,"children":58},"img",{"className":53,"src":55,"width":56,"height":57},[54],"mx-auto","/topics/nmpc/predict_horizon.png","600px","300px",[],{"type":16,"tag":41,"props":60,"children":62},{"className":61},[44,45,46],[63,64],{"type":22,"value":49},{"type":16,"tag":51,"props":65,"children":68},{"className":66,"src":67,"width":56,"height":57},[54],"/topics/nmpc/set_points.png",[],{"type":16,"tag":70,"props":71,"children":77},"figcaption",{"className":72},[73,74,75,76],"text-center","text-sm","text-neutral-600","dark:text-neutral-400",[78],{"type":22,"value":79},"\n      A car with finite horizons prediction and set point prediction over finite horizons.\n",{"type":16,"tag":81,"props":82,"children":84},"h2",{"id":83},"how-it-work",[85],{"type":22,"value":86},"How it work ?",{"type":16,"tag":25,"props":88,"children":89},{},[90],{"type":22,"value":91},"It works by solving the cost function that is produced by the sum of quadratic costs. For example, imagine you are riding a bike, and you want to get an ice cream because it is summer, and it tastes good ðŸ˜†. So, to get the ice cream, you need to grab your bike and ride it to the mart to buy one. What does it take to get you from your home to the mart store? Of course, it must be the energy produced by your muscles to pedal the bike and move. Another way to think about it is the cost of how the system would react to the desired position or point that you want it to reach. MPC have two types, they are Linear MPC and Nonlinear MPC. In this blog, we will only talk about Linear MPC.",{"type":16,"tag":81,"props":93,"children":94},{"id":11},[95],{"type":22,"value":96},"Linear MPC",{"type":16,"tag":25,"props":98,"children":99},{},[100,102],{"type":22,"value":101},"Linear MPC or Linear Model Predictive Control is an optimal control method that use with the system that it behavors linearly. It means that we can easily control this system with lost cost computation of the optimization and also ensure the lower risk of the system too!. ",{"type":16,"tag":103,"props":104,"children":105},"br",{},[],{"type":16,"tag":25,"props":107,"children":108},{},[109],{"type":22,"value":110},"Here is the formulation of the linear discrete system.",{"type":16,"tag":112,"props":113,"children":115},"math-render",{"math-code":114},"\nX_{k+1}=AX_{k}+BU_{k}",[],{"type":16,"tag":81,"props":117,"children":119},{"id":118},"formulation",[120],{"type":22,"value":121},"Formulation",{"type":16,"tag":25,"props":123,"children":124},{},[125],{"type":22,"value":126},"As I mentioned, this is quadratic cost. It consists of summation of all the cost that was produced over the number of horizontal prediction.",{"type":16,"tag":112,"props":128,"children":130},{"math-code":129},"J(x,u) = \\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N}, U_{N})",[],{"type":16,"tag":25,"props":132,"children":133},{},[134],{"type":22,"value":135},"Notation",{"type":16,"tag":137,"props":138,"children":139},"ul",{},[140,146,151,156],{"type":16,"tag":141,"props":142,"children":143},"li",{},[144],{"type":22,"value":145},"X is the state of the system. This shall be obtained from the optimiztion problem",{"type":16,"tag":141,"props":147,"children":148},{},[149],{"type":22,"value":150},"X_ref is the reference state of the system or desired input state.",{"type":16,"tag":141,"props":152,"children":153},{},[154],{"type":22,"value":155},"U is the input control of the system. This is a solution obtained from the optimization problem.",{"type":16,"tag":141,"props":157,"children":158},{},[159],{"type":22,"value":160},"U_ref is the reference control of the system or desired input control.",{"type":16,"tag":81,"props":162,"children":164},{"id":163},"was-it-really-that-good",[165],{"type":22,"value":166},"Was it really that good ?",{"type":16,"tag":25,"props":168,"children":169},{},[170],{"type":22,"value":171},"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!.",{"type":16,"tag":41,"props":173,"children":175},{"className":174},[44,45,46],[176,177],{"type":22,"value":49},{"type":16,"tag":51,"props":178,"children":181},{"className":179,"src":180,"width":56,"height":57},[54],"/topics/nmpc/diff_mpc.png",[],{"type":16,"tag":70,"props":183,"children":185},{"className":184},[73,74,75,76],[186],{"type":22,"value":187},"\n    Plot of differential drive robot follow the circle trajectory !!!.\n",{"type":16,"tag":81,"props":189,"children":191},{"id":190},"how-to-implement-it-in-python",[192],{"type":22,"value":193},"How to implement it in Python?",{"type":16,"tag":25,"props":195,"children":196},{},[197,199,208,210],{"type":22,"value":198},"There are so many great way to implement this control everywhere with many mathematical optimization library!!!. But for the sake of god, I use Casadi and CVXPY which I think one of the most easy tool to use. I will draft some python code here, but I cannot include them all in this post. You can check it more on my github repository, I do open-source some of my work !!! ",{"type":16,"tag":200,"props":201,"children":205},"a",{"href":202,"rel":203},"https://github.com/SokhengDin/PathTracking",[204],"nofollow",[206],{"type":22,"value":207},"Github",{"type":22,"value":209},". ",{"type":16,"tag":103,"props":211,"children":212},{},[],{"type":16,"tag":25,"props":214,"children":215},{},[216,218],{"type":22,"value":217},"I recommend you guys to have your own virtual enviroment, so I would be easier to work with any other related project of control system. ",{"type":16,"tag":103,"props":219,"children":220},{},[],{"type":16,"tag":25,"props":222,"children":223},{},[224],{"type":22,"value":225},"Make sure that you have install",{"type":16,"tag":227,"props":228,"children":233},"code",{"className":229,"code":231,"language":232,"meta":7},[230],"language-bash","pip3 install casadi && pip3 install cvxpy\n","bash",[234],{"type":16,"tag":235,"props":236,"children":237},"pre",{},[238],{"type":16,"tag":227,"props":239,"children":240},{"__ignoreMap":7},[241],{"type":16,"tag":242,"props":243,"children":246},"span",{"class":244,"line":245},"line",1,[247,253,259,265,269,274,279,283,287,291,295],{"type":16,"tag":242,"props":248,"children":250},{"class":249},"ct-806137",[251],{"type":22,"value":252},"pip3",{"type":16,"tag":242,"props":254,"children":256},{"class":255},"ct-767297",[257],{"type":22,"value":258}," ",{"type":16,"tag":242,"props":260,"children":262},{"class":261},"ct-244866",[263],{"type":22,"value":264},"install",{"type":16,"tag":242,"props":266,"children":267},{"class":255},[268],{"type":22,"value":258},{"type":16,"tag":242,"props":270,"children":271},{"class":261},[272],{"type":22,"value":273},"casadi",{"type":16,"tag":242,"props":275,"children":276},{"class":255},[277],{"type":22,"value":278}," && ",{"type":16,"tag":242,"props":280,"children":281},{"class":249},[282],{"type":22,"value":252},{"type":16,"tag":242,"props":284,"children":285},{"class":255},[286],{"type":22,"value":258},{"type":16,"tag":242,"props":288,"children":289},{"class":261},[290],{"type":22,"value":264},{"type":16,"tag":242,"props":292,"children":293},{"class":255},[294],{"type":22,"value":258},{"type":16,"tag":242,"props":296,"children":297},{"class":261},[298],{"type":22,"value":299},"cvxpy",{"type":16,"tag":25,"props":301,"children":302},{},[303],{"type":22,"value":304},"It is a good idea to write your robot model as a class object in Python, because it can help handle the update state of your system. For me, I am gonna use Numpy for mathematical operation.",{"type":16,"tag":227,"props":306,"children":311},{"className":307,"code":309,"language":310,"meta":7},[308],"language-python","import numpy as np\n\nclass DifferentialDrive:\n\n    def forward_kinematic(self, yaw, v, omega):\n        vx = v * np.cos(yaw)\n        vy = v * np.sin(yaw)\n        vyaw = omega\n\n        return vx, vy, vyaw\n","python",[312],{"type":16,"tag":235,"props":313,"children":314},{},[315],{"type":16,"tag":227,"props":316,"children":317},{"__ignoreMap":7},[318,342,351,374,382,410,439,465,483,491],{"type":16,"tag":242,"props":319,"children":320},{"class":244,"line":245},[321,327,332,337],{"type":16,"tag":242,"props":322,"children":324},{"class":323},"ct-857441",[325],{"type":22,"value":326},"import",{"type":16,"tag":242,"props":328,"children":329},{"class":255},[330],{"type":22,"value":331}," numpy ",{"type":16,"tag":242,"props":333,"children":334},{"class":323},[335],{"type":22,"value":336},"as",{"type":16,"tag":242,"props":338,"children":339},{"class":255},[340],{"type":22,"value":341}," np\n",{"type":16,"tag":242,"props":343,"children":345},{"class":244,"line":344},2,[346],{"type":16,"tag":242,"props":347,"children":348},{},[349],{"type":22,"value":350},"\n",{"type":16,"tag":242,"props":352,"children":354},{"class":244,"line":353},3,[355,360,364,369],{"type":16,"tag":242,"props":356,"children":357},{"class":323},[358],{"type":22,"value":359},"class",{"type":16,"tag":242,"props":361,"children":362},{"class":255},[363],{"type":22,"value":258},{"type":16,"tag":242,"props":365,"children":366},{"class":249},[367],{"type":22,"value":368},"DifferentialDrive",{"type":16,"tag":242,"props":370,"children":371},{"class":255},[372],{"type":22,"value":373},":\n",{"type":16,"tag":242,"props":375,"children":377},{"class":244,"line":376},4,[378],{"type":16,"tag":242,"props":379,"children":380},{},[381],{"type":22,"value":350},{"type":16,"tag":242,"props":383,"children":385},{"class":244,"line":384},5,[386,391,396,400,405],{"type":16,"tag":242,"props":387,"children":388},{"class":255},[389],{"type":22,"value":390},"    ",{"type":16,"tag":242,"props":392,"children":393},{"class":323},[394],{"type":22,"value":395},"def",{"type":16,"tag":242,"props":397,"children":398},{"class":255},[399],{"type":22,"value":258},{"type":16,"tag":242,"props":401,"children":402},{"class":249},[403],{"type":22,"value":404},"forward_kinematic",{"type":16,"tag":242,"props":406,"children":407},{"class":255},[408],{"type":22,"value":409},"(self, yaw, v, omega):\n",{"type":16,"tag":242,"props":411,"children":413},{"class":244,"line":412},6,[414,419,424,429,434],{"type":16,"tag":242,"props":415,"children":416},{"class":255},[417],{"type":22,"value":418},"        vx ",{"type":16,"tag":242,"props":420,"children":421},{"class":323},[422],{"type":22,"value":423},"=",{"type":16,"tag":242,"props":425,"children":426},{"class":255},[427],{"type":22,"value":428}," v ",{"type":16,"tag":242,"props":430,"children":431},{"class":323},[432],{"type":22,"value":433},"*",{"type":16,"tag":242,"props":435,"children":436},{"class":255},[437],{"type":22,"value":438}," np.cos(yaw)\n",{"type":16,"tag":242,"props":440,"children":442},{"class":244,"line":441},7,[443,448,452,456,460],{"type":16,"tag":242,"props":444,"children":445},{"class":255},[446],{"type":22,"value":447},"        vy ",{"type":16,"tag":242,"props":449,"children":450},{"class":323},[451],{"type":22,"value":423},{"type":16,"tag":242,"props":453,"children":454},{"class":255},[455],{"type":22,"value":428},{"type":16,"tag":242,"props":457,"children":458},{"class":323},[459],{"type":22,"value":433},{"type":16,"tag":242,"props":461,"children":462},{"class":255},[463],{"type":22,"value":464}," np.sin(yaw)\n",{"type":16,"tag":242,"props":466,"children":468},{"class":244,"line":467},8,[469,474,478],{"type":16,"tag":242,"props":470,"children":471},{"class":255},[472],{"type":22,"value":473},"        vyaw ",{"type":16,"tag":242,"props":475,"children":476},{"class":323},[477],{"type":22,"value":423},{"type":16,"tag":242,"props":479,"children":480},{"class":255},[481],{"type":22,"value":482}," omega\n",{"type":16,"tag":242,"props":484,"children":486},{"class":244,"line":485},9,[487],{"type":16,"tag":242,"props":488,"children":489},{},[490],{"type":22,"value":350},{"type":16,"tag":242,"props":492,"children":494},{"class":244,"line":493},10,[495,500,505],{"type":16,"tag":242,"props":496,"children":497},{"class":255},[498],{"type":22,"value":499},"        ",{"type":16,"tag":242,"props":501,"children":502},{"class":323},[503],{"type":22,"value":504},"return",{"type":16,"tag":242,"props":506,"children":507},{"class":255},[508],{"type":22,"value":509}," vx, vy, vyaw",{"type":16,"tag":25,"props":511,"children":512},{},[513,515,521],{"type":22,"value":514},"Next add this update state function into our ",{"type":16,"tag":516,"props":517,"children":518},"strong",{},[519],{"type":22,"value":520},"DifferentialDrive ",{"type":22,"value":522}," class, by doing this we would have all the attribute of our robot system.",{"type":16,"tag":227,"props":524,"children":527},{"className":525,"code":526,"language":310,"meta":7},[308],"def update_state(self, x0, y0, yaw0, yaw, v, omega):\n\n  dx, dy, dyaw = self.robot_model.forward_kinematic(yaw, v, omega)\n\n  x_next = x0 + dx*self.dtau\n  y_next = y0 + dy*self.dtau\n  yaw_next = yaw0 + dyaw*self.dtau\n\n  return x_next, y_next, yaw_next\n",[528],{"type":16,"tag":235,"props":529,"children":530},{},[531],{"type":16,"tag":227,"props":532,"children":533},{"__ignoreMap":7},[534,555,562,589,596,636,674,712,719],{"type":16,"tag":242,"props":535,"children":536},{"class":244,"line":245},[537,541,545,550],{"type":16,"tag":242,"props":538,"children":539},{"class":323},[540],{"type":22,"value":395},{"type":16,"tag":242,"props":542,"children":543},{"class":255},[544],{"type":22,"value":258},{"type":16,"tag":242,"props":546,"children":547},{"class":249},[548],{"type":22,"value":549},"update_state",{"type":16,"tag":242,"props":551,"children":552},{"class":255},[553],{"type":22,"value":554},"(self, x0, y0, yaw0, yaw, v, omega):\n",{"type":16,"tag":242,"props":556,"children":557},{"class":244,"line":344},[558],{"type":16,"tag":242,"props":559,"children":560},{},[561],{"type":22,"value":350},{"type":16,"tag":242,"props":563,"children":564},{"class":244,"line":353},[565,570,574,578,584],{"type":16,"tag":242,"props":566,"children":567},{"class":255},[568],{"type":22,"value":569},"  dx, dy, dyaw ",{"type":16,"tag":242,"props":571,"children":572},{"class":323},[573],{"type":22,"value":423},{"type":16,"tag":242,"props":575,"children":576},{"class":255},[577],{"type":22,"value":258},{"type":16,"tag":242,"props":579,"children":581},{"class":580},"ct-533739",[582],{"type":22,"value":583},"self",{"type":16,"tag":242,"props":585,"children":586},{"class":255},[587],{"type":22,"value":588},".robot_model.forward_kinematic(yaw, v, omega)\n",{"type":16,"tag":242,"props":590,"children":591},{"class":244,"line":376},[592],{"type":16,"tag":242,"props":593,"children":594},{},[595],{"type":22,"value":350},{"type":16,"tag":242,"props":597,"children":598},{"class":244,"line":384},[599,604,608,613,618,623,627,631],{"type":16,"tag":242,"props":600,"children":601},{"class":255},[602],{"type":22,"value":603},"  x_next ",{"type":16,"tag":242,"props":605,"children":606},{"class":323},[607],{"type":22,"value":423},{"type":16,"tag":242,"props":609,"children":610},{"class":255},[611],{"type":22,"value":612}," x0 ",{"type":16,"tag":242,"props":614,"children":615},{"class":323},[616],{"type":22,"value":617},"+",{"type":16,"tag":242,"props":619,"children":620},{"class":255},[621],{"type":22,"value":622}," dx",{"type":16,"tag":242,"props":624,"children":625},{"class":323},[626],{"type":22,"value":433},{"type":16,"tag":242,"props":628,"children":629},{"class":580},[630],{"type":22,"value":583},{"type":16,"tag":242,"props":632,"children":633},{"class":255},[634],{"type":22,"value":635},".dtau\n",{"type":16,"tag":242,"props":637,"children":638},{"class":244,"line":412},[639,644,648,653,657,662,666,670],{"type":16,"tag":242,"props":640,"children":641},{"class":255},[642],{"type":22,"value":643},"  y_next ",{"type":16,"tag":242,"props":645,"children":646},{"class":323},[647],{"type":22,"value":423},{"type":16,"tag":242,"props":649,"children":650},{"class":255},[651],{"type":22,"value":652}," y0 ",{"type":16,"tag":242,"props":654,"children":655},{"class":323},[656],{"type":22,"value":617},{"type":16,"tag":242,"props":658,"children":659},{"class":255},[660],{"type":22,"value":661}," dy",{"type":16,"tag":242,"props":663,"children":664},{"class":323},[665],{"type":22,"value":433},{"type":16,"tag":242,"props":667,"children":668},{"class":580},[669],{"type":22,"value":583},{"type":16,"tag":242,"props":671,"children":672},{"class":255},[673],{"type":22,"value":635},{"type":16,"tag":242,"props":675,"children":676},{"class":244,"line":441},[677,682,686,691,695,700,704,708],{"type":16,"tag":242,"props":678,"children":679},{"class":255},[680],{"type":22,"value":681},"  yaw_next ",{"type":16,"tag":242,"props":683,"children":684},{"class":323},[685],{"type":22,"value":423},{"type":16,"tag":242,"props":687,"children":688},{"class":255},[689],{"type":22,"value":690}," yaw0 ",{"type":16,"tag":242,"props":692,"children":693},{"class":323},[694],{"type":22,"value":617},{"type":16,"tag":242,"props":696,"children":697},{"class":255},[698],{"type":22,"value":699}," dyaw",{"type":16,"tag":242,"props":701,"children":702},{"class":323},[703],{"type":22,"value":433},{"type":16,"tag":242,"props":705,"children":706},{"class":580},[707],{"type":22,"value":583},{"type":16,"tag":242,"props":709,"children":710},{"class":255},[711],{"type":22,"value":635},{"type":16,"tag":242,"props":713,"children":714},{"class":244,"line":467},[715],{"type":16,"tag":242,"props":716,"children":717},{},[718],{"type":22,"value":350},{"type":16,"tag":242,"props":720,"children":721},{"class":244,"line":485},[722,727,731],{"type":16,"tag":242,"props":723,"children":724},{"class":255},[725],{"type":22,"value":726},"  ",{"type":16,"tag":242,"props":728,"children":729},{"class":323},[730],{"type":22,"value":504},{"type":16,"tag":242,"props":732,"children":733},{"class":255},[734],{"type":22,"value":735}," x_next, y_next, yaw_next",{"type":16,"tag":25,"props":737,"children":738},{},[739,741,744],{"type":22,"value":740},"How to define the quadratic cost in Python with CVXPY ? and set the constraint for your system ? ",{"type":16,"tag":103,"props":742,"children":743},{},[],{"type":22,"value":745},"\nHere, how you would write it.",{"type":16,"tag":227,"props":747,"children":750},{"className":748,"code":749,"language":310,"meta":7},[308],"for t in range(T):\n    cost += cvxpy.quad_form(u[:, t], R)\n\n    if t != 0:\n        cost += cvxpy.quad_form(x_ref[:, t] - x[:, t], Q)\n\n    A, B, C = get_linear_model_matrix(x_ref, u_ref)\n    constraints += [x[:, t + 1] == A @ x[:, t] + B @ u[:, t] + C]\n\n    if t \u003C (T - 1):\n        cost += cvxpy.quad_form(u[:, t + 1] - u[:, t], Rd)\n        constraints += [cvxpy.abs(u[1, t + 1] - u[1, t]) \u003C= DESIRED_CONTROL]\n\ncost += cvxpy.quad_form(xref[:, T] - x[:, T], Q)\n",[751],{"type":16,"tag":235,"props":752,"children":753},{},[754],{"type":16,"tag":227,"props":755,"children":756},{"__ignoreMap":7},[757,789,807,814,848,875,882,899,981,988,1030,1072,1152,1160],{"type":16,"tag":242,"props":758,"children":759},{"class":244,"line":245},[760,765,770,775,779,784],{"type":16,"tag":242,"props":761,"children":762},{"class":323},[763],{"type":22,"value":764},"for",{"type":16,"tag":242,"props":766,"children":767},{"class":255},[768],{"type":22,"value":769}," t ",{"type":16,"tag":242,"props":771,"children":772},{"class":323},[773],{"type":22,"value":774},"in",{"type":16,"tag":242,"props":776,"children":777},{"class":255},[778],{"type":22,"value":258},{"type":16,"tag":242,"props":780,"children":781},{"class":580},[782],{"type":22,"value":783},"range",{"type":16,"tag":242,"props":785,"children":786},{"class":255},[787],{"type":22,"value":788},"(T):\n",{"type":16,"tag":242,"props":790,"children":791},{"class":244,"line":344},[792,797,802],{"type":16,"tag":242,"props":793,"children":794},{"class":255},[795],{"type":22,"value":796},"    cost ",{"type":16,"tag":242,"props":798,"children":799},{"class":323},[800],{"type":22,"value":801},"+=",{"type":16,"tag":242,"props":803,"children":804},{"class":255},[805],{"type":22,"value":806}," cvxpy.quad_form(u[:, t], R)\n",{"type":16,"tag":242,"props":808,"children":809},{"class":244,"line":353},[810],{"type":16,"tag":242,"props":811,"children":812},{},[813],{"type":22,"value":350},{"type":16,"tag":242,"props":815,"children":816},{"class":244,"line":376},[817,821,826,830,835,839,844],{"type":16,"tag":242,"props":818,"children":819},{"class":255},[820],{"type":22,"value":390},{"type":16,"tag":242,"props":822,"children":823},{"class":323},[824],{"type":22,"value":825},"if",{"type":16,"tag":242,"props":827,"children":828},{"class":255},[829],{"type":22,"value":769},{"type":16,"tag":242,"props":831,"children":832},{"class":323},[833],{"type":22,"value":834},"!=",{"type":16,"tag":242,"props":836,"children":837},{"class":255},[838],{"type":22,"value":258},{"type":16,"tag":242,"props":840,"children":841},{"class":580},[842],{"type":22,"value":843},"0",{"type":16,"tag":242,"props":845,"children":846},{"class":255},[847],{"type":22,"value":373},{"type":16,"tag":242,"props":849,"children":850},{"class":244,"line":384},[851,856,860,865,870],{"type":16,"tag":242,"props":852,"children":853},{"class":255},[854],{"type":22,"value":855},"        cost ",{"type":16,"tag":242,"props":857,"children":858},{"class":323},[859],{"type":22,"value":801},{"type":16,"tag":242,"props":861,"children":862},{"class":255},[863],{"type":22,"value":864}," cvxpy.quad_form(x_ref[:, t] ",{"type":16,"tag":242,"props":866,"children":867},{"class":323},[868],{"type":22,"value":869},"-",{"type":16,"tag":242,"props":871,"children":872},{"class":255},[873],{"type":22,"value":874}," x[:, t], Q)\n",{"type":16,"tag":242,"props":876,"children":877},{"class":244,"line":412},[878],{"type":16,"tag":242,"props":879,"children":880},{},[881],{"type":22,"value":350},{"type":16,"tag":242,"props":883,"children":884},{"class":244,"line":441},[885,890,894],{"type":16,"tag":242,"props":886,"children":887},{"class":255},[888],{"type":22,"value":889},"    A, B, C ",{"type":16,"tag":242,"props":891,"children":892},{"class":323},[893],{"type":22,"value":423},{"type":16,"tag":242,"props":895,"children":896},{"class":255},[897],{"type":22,"value":898}," get_linear_model_matrix(x_ref, u_ref)\n",{"type":16,"tag":242,"props":900,"children":901},{"class":244,"line":467},[902,907,911,916,920,924,929,934,939,944,949,954,958,963,967,972,976],{"type":16,"tag":242,"props":903,"children":904},{"class":255},[905],{"type":22,"value":906},"    constraints ",{"type":16,"tag":242,"props":908,"children":909},{"class":323},[910],{"type":22,"value":801},{"type":16,"tag":242,"props":912,"children":913},{"class":255},[914],{"type":22,"value":915}," [x[:, t ",{"type":16,"tag":242,"props":917,"children":918},{"class":323},[919],{"type":22,"value":617},{"type":16,"tag":242,"props":921,"children":922},{"class":255},[923],{"type":22,"value":258},{"type":16,"tag":242,"props":925,"children":926},{"class":580},[927],{"type":22,"value":928},"1",{"type":16,"tag":242,"props":930,"children":931},{"class":255},[932],{"type":22,"value":933},"] ",{"type":16,"tag":242,"props":935,"children":936},{"class":323},[937],{"type":22,"value":938},"==",{"type":16,"tag":242,"props":940,"children":941},{"class":255},[942],{"type":22,"value":943}," A ",{"type":16,"tag":242,"props":945,"children":946},{"class":323},[947],{"type":22,"value":948},"@",{"type":16,"tag":242,"props":950,"children":951},{"class":255},[952],{"type":22,"value":953}," x[:, t] ",{"type":16,"tag":242,"props":955,"children":956},{"class":323},[957],{"type":22,"value":617},{"type":16,"tag":242,"props":959,"children":960},{"class":255},[961],{"type":22,"value":962}," B ",{"type":16,"tag":242,"props":964,"children":965},{"class":323},[966],{"type":22,"value":948},{"type":16,"tag":242,"props":968,"children":969},{"class":255},[970],{"type":22,"value":971}," u[:, t] ",{"type":16,"tag":242,"props":973,"children":974},{"class":323},[975],{"type":22,"value":617},{"type":16,"tag":242,"props":977,"children":978},{"class":255},[979],{"type":22,"value":980}," C]\n",{"type":16,"tag":242,"props":982,"children":983},{"class":244,"line":485},[984],{"type":16,"tag":242,"props":985,"children":986},{},[987],{"type":22,"value":350},{"type":16,"tag":242,"props":989,"children":990},{"class":244,"line":493},[991,995,999,1003,1008,1013,1017,1021,1025],{"type":16,"tag":242,"props":992,"children":993},{"class":255},[994],{"type":22,"value":390},{"type":16,"tag":242,"props":996,"children":997},{"class":323},[998],{"type":22,"value":825},{"type":16,"tag":242,"props":1000,"children":1001},{"class":255},[1002],{"type":22,"value":769},{"type":16,"tag":242,"props":1004,"children":1005},{"class":323},[1006],{"type":22,"value":1007},"\u003C",{"type":16,"tag":242,"props":1009,"children":1010},{"class":255},[1011],{"type":22,"value":1012}," (T ",{"type":16,"tag":242,"props":1014,"children":1015},{"class":323},[1016],{"type":22,"value":869},{"type":16,"tag":242,"props":1018,"children":1019},{"class":255},[1020],{"type":22,"value":258},{"type":16,"tag":242,"props":1022,"children":1023},{"class":580},[1024],{"type":22,"value":928},{"type":16,"tag":242,"props":1026,"children":1027},{"class":255},[1028],{"type":22,"value":1029},"):\n",{"type":16,"tag":242,"props":1031,"children":1033},{"class":244,"line":1032},11,[1034,1038,1042,1047,1051,1055,1059,1063,1067],{"type":16,"tag":242,"props":1035,"children":1036},{"class":255},[1037],{"type":22,"value":855},{"type":16,"tag":242,"props":1039,"children":1040},{"class":323},[1041],{"type":22,"value":801},{"type":16,"tag":242,"props":1043,"children":1044},{"class":255},[1045],{"type":22,"value":1046}," cvxpy.quad_form(u[:, t ",{"type":16,"tag":242,"props":1048,"children":1049},{"class":323},[1050],{"type":22,"value":617},{"type":16,"tag":242,"props":1052,"children":1053},{"class":255},[1054],{"type":22,"value":258},{"type":16,"tag":242,"props":1056,"children":1057},{"class":580},[1058],{"type":22,"value":928},{"type":16,"tag":242,"props":1060,"children":1061},{"class":255},[1062],{"type":22,"value":933},{"type":16,"tag":242,"props":1064,"children":1065},{"class":323},[1066],{"type":22,"value":869},{"type":16,"tag":242,"props":1068,"children":1069},{"class":255},[1070],{"type":22,"value":1071}," u[:, t], Rd)\n",{"type":16,"tag":242,"props":1073,"children":1075},{"class":244,"line":1074},12,[1076,1081,1085,1090,1094,1099,1103,1107,1111,1115,1119,1124,1128,1133,1138,1142,1147],{"type":16,"tag":242,"props":1077,"children":1078},{"class":255},[1079],{"type":22,"value":1080},"        constraints ",{"type":16,"tag":242,"props":1082,"children":1083},{"class":323},[1084],{"type":22,"value":801},{"type":16,"tag":242,"props":1086,"children":1087},{"class":255},[1088],{"type":22,"value":1089}," [cvxpy.abs(u[",{"type":16,"tag":242,"props":1091,"children":1092},{"class":580},[1093],{"type":22,"value":928},{"type":16,"tag":242,"props":1095,"children":1096},{"class":255},[1097],{"type":22,"value":1098},", t ",{"type":16,"tag":242,"props":1100,"children":1101},{"class":323},[1102],{"type":22,"value":617},{"type":16,"tag":242,"props":1104,"children":1105},{"class":255},[1106],{"type":22,"value":258},{"type":16,"tag":242,"props":1108,"children":1109},{"class":580},[1110],{"type":22,"value":928},{"type":16,"tag":242,"props":1112,"children":1113},{"class":255},[1114],{"type":22,"value":933},{"type":16,"tag":242,"props":1116,"children":1117},{"class":323},[1118],{"type":22,"value":869},{"type":16,"tag":242,"props":1120,"children":1121},{"class":255},[1122],{"type":22,"value":1123}," u[",{"type":16,"tag":242,"props":1125,"children":1126},{"class":580},[1127],{"type":22,"value":928},{"type":16,"tag":242,"props":1129,"children":1130},{"class":255},[1131],{"type":22,"value":1132},", t]) ",{"type":16,"tag":242,"props":1134,"children":1135},{"class":323},[1136],{"type":22,"value":1137},"\u003C=",{"type":16,"tag":242,"props":1139,"children":1140},{"class":255},[1141],{"type":22,"value":258},{"type":16,"tag":242,"props":1143,"children":1144},{"class":580},[1145],{"type":22,"value":1146},"DESIRED_CONTROL",{"type":16,"tag":242,"props":1148,"children":1149},{"class":255},[1150],{"type":22,"value":1151},"]\n",{"type":16,"tag":242,"props":1153,"children":1155},{"class":244,"line":1154},13,[1156],{"type":16,"tag":242,"props":1157,"children":1158},{},[1159],{"type":22,"value":350},{"type":16,"tag":242,"props":1161,"children":1163},{"class":244,"line":1162},14,[1164,1169,1173,1178,1182],{"type":16,"tag":242,"props":1165,"children":1166},{"class":255},[1167],{"type":22,"value":1168},"cost ",{"type":16,"tag":242,"props":1170,"children":1171},{"class":323},[1172],{"type":22,"value":801},{"type":16,"tag":242,"props":1174,"children":1175},{"class":255},[1176],{"type":22,"value":1177}," cvxpy.quad_form(xref[:, T] ",{"type":16,"tag":242,"props":1179,"children":1180},{"class":323},[1181],{"type":22,"value":869},{"type":16,"tag":242,"props":1183,"children":1184},{"class":255},[1185],{"type":22,"value":1186}," x[:, T], Q)",{"type":16,"tag":25,"props":1188,"children":1189},{},[1190,1192,1197,1199,1202],{"type":22,"value":1191},"The function ",{"type":16,"tag":516,"props":1193,"children":1194},{},[1195],{"type":22,"value":1196}," get_linear_model_matrix ",{"type":22,"value":1198}," would return the linearized model as the shown as the formula above. ",{"type":16,"tag":103,"props":1200,"children":1201},{},[],{"type":22,"value":1203},"\nWe can set more constraint by adding",{"type":16,"tag":227,"props":1205,"children":1208},{"className":1206,"code":1207,"language":310,"meta":7},[308],"  constraints += [x[:, 0] == x0]\n  constraints += [x[2, :] \u003C= MAX_SPEED]\n  constraints += [x[2, :] >= MIN_SPEED]\n  constraints += [cvxpy.abs(u[0, :]) \u003C= MAX_ACCEL]\n  constraints += [cvxpy.abs(u[1, :]) \u003C= MAX_STEER]\n",[1209],{"type":16,"tag":235,"props":1210,"children":1211},{},[1212],{"type":16,"tag":227,"props":1213,"children":1214},{"__ignoreMap":7},[1215,1249,1292,1333,1374],{"type":16,"tag":242,"props":1216,"children":1217},{"class":244,"line":245},[1218,1223,1227,1232,1236,1240,1244],{"type":16,"tag":242,"props":1219,"children":1220},{"class":255},[1221],{"type":22,"value":1222},"  constraints ",{"type":16,"tag":242,"props":1224,"children":1225},{"class":323},[1226],{"type":22,"value":801},{"type":16,"tag":242,"props":1228,"children":1229},{"class":255},[1230],{"type":22,"value":1231}," [x[:, ",{"type":16,"tag":242,"props":1233,"children":1234},{"class":580},[1235],{"type":22,"value":843},{"type":16,"tag":242,"props":1237,"children":1238},{"class":255},[1239],{"type":22,"value":933},{"type":16,"tag":242,"props":1241,"children":1242},{"class":323},[1243],{"type":22,"value":938},{"type":16,"tag":242,"props":1245,"children":1246},{"class":255},[1247],{"type":22,"value":1248}," x0]\n",{"type":16,"tag":242,"props":1250,"children":1251},{"class":244,"line":344},[1252,1256,1260,1265,1270,1275,1279,1283,1288],{"type":16,"tag":242,"props":1253,"children":1254},{"class":255},[1255],{"type":22,"value":1222},{"type":16,"tag":242,"props":1257,"children":1258},{"class":323},[1259],{"type":22,"value":801},{"type":16,"tag":242,"props":1261,"children":1262},{"class":255},[1263],{"type":22,"value":1264}," [x[",{"type":16,"tag":242,"props":1266,"children":1267},{"class":580},[1268],{"type":22,"value":1269},"2",{"type":16,"tag":242,"props":1271,"children":1272},{"class":255},[1273],{"type":22,"value":1274},", :] ",{"type":16,"tag":242,"props":1276,"children":1277},{"class":323},[1278],{"type":22,"value":1137},{"type":16,"tag":242,"props":1280,"children":1281},{"class":255},[1282],{"type":22,"value":258},{"type":16,"tag":242,"props":1284,"children":1285},{"class":580},[1286],{"type":22,"value":1287},"MAX_SPEED",{"type":16,"tag":242,"props":1289,"children":1290},{"class":255},[1291],{"type":22,"value":1151},{"type":16,"tag":242,"props":1293,"children":1294},{"class":244,"line":353},[1295,1299,1303,1307,1311,1315,1320,1324,1329],{"type":16,"tag":242,"props":1296,"children":1297},{"class":255},[1298],{"type":22,"value":1222},{"type":16,"tag":242,"props":1300,"children":1301},{"class":323},[1302],{"type":22,"value":801},{"type":16,"tag":242,"props":1304,"children":1305},{"class":255},[1306],{"type":22,"value":1264},{"type":16,"tag":242,"props":1308,"children":1309},{"class":580},[1310],{"type":22,"value":1269},{"type":16,"tag":242,"props":1312,"children":1313},{"class":255},[1314],{"type":22,"value":1274},{"type":16,"tag":242,"props":1316,"children":1317},{"class":323},[1318],{"type":22,"value":1319},">=",{"type":16,"tag":242,"props":1321,"children":1322},{"class":255},[1323],{"type":22,"value":258},{"type":16,"tag":242,"props":1325,"children":1326},{"class":580},[1327],{"type":22,"value":1328},"MIN_SPEED",{"type":16,"tag":242,"props":1330,"children":1331},{"class":255},[1332],{"type":22,"value":1151},{"type":16,"tag":242,"props":1334,"children":1335},{"class":244,"line":376},[1336,1340,1344,1348,1352,1357,1361,1365,1370],{"type":16,"tag":242,"props":1337,"children":1338},{"class":255},[1339],{"type":22,"value":1222},{"type":16,"tag":242,"props":1341,"children":1342},{"class":323},[1343],{"type":22,"value":801},{"type":16,"tag":242,"props":1345,"children":1346},{"class":255},[1347],{"type":22,"value":1089},{"type":16,"tag":242,"props":1349,"children":1350},{"class":580},[1351],{"type":22,"value":843},{"type":16,"tag":242,"props":1353,"children":1354},{"class":255},[1355],{"type":22,"value":1356},", :]) ",{"type":16,"tag":242,"props":1358,"children":1359},{"class":323},[1360],{"type":22,"value":1137},{"type":16,"tag":242,"props":1362,"children":1363},{"class":255},[1364],{"type":22,"value":258},{"type":16,"tag":242,"props":1366,"children":1367},{"class":580},[1368],{"type":22,"value":1369},"MAX_ACCEL",{"type":16,"tag":242,"props":1371,"children":1372},{"class":255},[1373],{"type":22,"value":1151},{"type":16,"tag":242,"props":1375,"children":1376},{"class":244,"line":384},[1377,1381,1385,1389,1393,1397,1401,1405,1410],{"type":16,"tag":242,"props":1378,"children":1379},{"class":255},[1380],{"type":22,"value":1222},{"type":16,"tag":242,"props":1382,"children":1383},{"class":323},[1384],{"type":22,"value":801},{"type":16,"tag":242,"props":1386,"children":1387},{"class":255},[1388],{"type":22,"value":1089},{"type":16,"tag":242,"props":1390,"children":1391},{"class":580},[1392],{"type":22,"value":928},{"type":16,"tag":242,"props":1394,"children":1395},{"class":255},[1396],{"type":22,"value":1356},{"type":16,"tag":242,"props":1398,"children":1399},{"class":323},[1400],{"type":22,"value":1137},{"type":16,"tag":242,"props":1402,"children":1403},{"class":255},[1404],{"type":22,"value":258},{"type":16,"tag":242,"props":1406,"children":1407},{"class":580},[1408],{"type":22,"value":1409},"MAX_STEER",{"type":16,"tag":242,"props":1411,"children":1412},{"class":255},[1413],{"type":22,"value":1414},"]",{"type":16,"tag":25,"props":1416,"children":1417},{},[1418],{"type":22,"value":1419},"Finally, we define the optimizer for our system by",{"type":16,"tag":227,"props":1421,"children":1424},{"className":1422,"code":1423,"language":310,"meta":7},[308],"prob = cvxpy.Problem(cvxpy.Minimize(cost), constraints)\nprob.solve(solver=cvxpy.ECOS, verbose=False)\n",[1425],{"type":16,"tag":235,"props":1426,"children":1427},{},[1428],{"type":16,"tag":227,"props":1429,"children":1430},{"__ignoreMap":7},[1431,1448],{"type":16,"tag":242,"props":1432,"children":1433},{"class":244,"line":245},[1434,1439,1443],{"type":16,"tag":242,"props":1435,"children":1436},{"class":255},[1437],{"type":22,"value":1438},"prob ",{"type":16,"tag":242,"props":1440,"children":1441},{"class":323},[1442],{"type":22,"value":423},{"type":16,"tag":242,"props":1444,"children":1445},{"class":255},[1446],{"type":22,"value":1447}," cvxpy.Problem(cvxpy.Minimize(cost), constraints)\n",{"type":16,"tag":242,"props":1449,"children":1450},{"class":244,"line":344},[1451,1456,1462,1466,1471,1476,1481,1486,1490,1495],{"type":16,"tag":242,"props":1452,"children":1453},{"class":255},[1454],{"type":22,"value":1455},"prob.solve(",{"type":16,"tag":242,"props":1457,"children":1459},{"class":1458},"ct-657843",[1460],{"type":22,"value":1461},"solver",{"type":16,"tag":242,"props":1463,"children":1464},{"class":323},[1465],{"type":22,"value":423},{"type":16,"tag":242,"props":1467,"children":1468},{"class":255},[1469],{"type":22,"value":1470},"cvxpy.",{"type":16,"tag":242,"props":1472,"children":1473},{"class":580},[1474],{"type":22,"value":1475},"ECOS",{"type":16,"tag":242,"props":1477,"children":1478},{"class":255},[1479],{"type":22,"value":1480},", ",{"type":16,"tag":242,"props":1482,"children":1483},{"class":1458},[1484],{"type":22,"value":1485},"verbose",{"type":16,"tag":242,"props":1487,"children":1488},{"class":323},[1489],{"type":22,"value":423},{"type":16,"tag":242,"props":1491,"children":1492},{"class":580},[1493],{"type":22,"value":1494},"False",{"type":16,"tag":242,"props":1496,"children":1497},{"class":255},[1498],{"type":22,"value":1499},")",{"type":16,"tag":25,"props":1501,"children":1502},{},[1503,1505],{"type":22,"value":1504},"For more detail about using CVXPY, here is the link ",{"type":16,"tag":200,"props":1506,"children":1509},{"href":1507,"rel":1508},"https://www.cvxpy.org",[204],[1510],{"type":22,"value":1511},"CVXPY",{"type":16,"tag":81,"props":1513,"children":1515},{"id":1514},"in-conclusion",[1516],{"type":22,"value":1517},"In conclusion",{"type":16,"tag":25,"props":1519,"children":1520},{},[1521],{"type":22,"value":1522},"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too. Next post, I will explain about Nonlinear Model Predictive Control by using Casadi framework for mathematical optimization.",{"type":16,"tag":1524,"children":1525},"style",[1526],{"type":22,"value":1527},".ct-806137{color:#B392F0;}\n.ct-767297{color:#E1E4E8;}\n.ct-244866{color:#9ECBFF;}\n.ct-857441{color:#F97583;}\n.ct-533739{color:#79B8FF;}\n.ct-657843{color:#FFAB70;}",{"title":7,"searchDepth":344,"depth":344,"links":1529},[1530,1531,1532,1533,1534,1535],{"id":83,"depth":344,"text":86},{"id":11,"depth":344,"text":96},{"id":118,"depth":344,"text":121},{"id":163,"depth":344,"text":166},{"id":190,"depth":344,"text":193},{"id":1514,"depth":344,"text":1517},"markdown","content:topics:linear-mpc.md","content","topics/linear-mpc.md","md",1693412006918]