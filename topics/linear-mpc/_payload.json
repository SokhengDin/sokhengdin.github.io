[{"data":1,"prerenderedAt":1592},["Reactive",2],{"content-/topics/linear-mpc":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"_empty":6,"title":8,"description":9,"author":10,"slug":11,"tag":11,"img":12,"body":13,"_type":1587,"_id":1588,"_source":1589,"_file":1590,"_extension":1591},"/topics/linear-mpc","topics",false,"","Linear Model Predictive Control","Introduction to Linear Model Predictive Control","Din Sokheng","linear-mpc","/topics/nmpc/predict_horizon.png",{"type":14,"children":15,"toc":1577},"root",[16,25,31,54,65,71,76,81,90,95,100,106,111,115,120,162,168,173,188,194,200,219,227,232,306,311,516,529,742,752,1193,1210,1421,1426,1506,1518,1524,1529,1535,1572],{"type":17,"tag":18,"props":19,"children":21},"element","h2",{"id":20},"what-is-model-predictive-control",[22],{"type":23,"value":24},"text","What is Model Predictive Control ?",{"type":17,"tag":26,"props":27,"children":28},"p",{},[29],{"type":23,"value":30},"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system.",{"type":17,"tag":32,"props":33,"children":40},"div",{"className":34},[35,36,37,38,39],"grid","grid-cols-2","space-x-10","justify-center","items-center",[41,49],{"type":17,"tag":42,"props":43,"children":48},"img",{"className":44,"src":12,"width":46,"height":47},[45],"mx-auto","600px","300px",[],{"type":17,"tag":42,"props":50,"children":53},{"className":51,"src":52,"width":46,"height":47},[45],"/topics/nmpc/set_points.png",[],{"type":17,"tag":55,"props":56,"children":62},"figcaption",{"className":57},[58,59,60,61],"text-center","text-sm","text-neutral-600","dark:text-neutral-400",[63],{"type":23,"value":64},"\n      A car with finite horizons prediction and set point prediction over finite horizons.\n",{"type":17,"tag":18,"props":66,"children":68},{"id":67},"how-it-works",[69],{"type":23,"value":70},"How it works ?",{"type":17,"tag":26,"props":72,"children":73},{},[74],{"type":23,"value":75},"It works by solving the cost function that is produced by the sum of quadratic costs. For example, imagine you are riding a bike, and you want to get an ice cream because it is summer, and it tastes good ðŸ˜†. So, to get the ice cream, you need to grab your bike and ride it to the mart to buy one. What does it take to get you from your home to the mart store? Of course, it must be the energy produced by your muscles to pedal the bike and move. Another way to think about it is the cost of how the system would react to the desired position or point that you want it to reach. MPC have two types, they are Linear MPC and Nonlinear MPC. In this blog, we will only talk about Linear MPC.",{"type":17,"tag":18,"props":77,"children":78},{"id":11},[79],{"type":23,"value":80},"Linear MPC",{"type":17,"tag":26,"props":82,"children":83},{},[84,86],{"type":23,"value":85},"Linear MPC or Linear Model Predictive Control is an optimal control method that use with the system that it behavors linearly. It means that we can easily control this system with lost cost computation of the optimization and also ensure the lower risk of the system too!. ",{"type":17,"tag":87,"props":88,"children":89},"br",{},[],{"type":17,"tag":26,"props":91,"children":92},{},[93],{"type":23,"value":94},"Here is the formulation of the linear discrete system.",{"type":17,"tag":96,"props":97,"children":99},"math-render",{"styles":58,":latex-express":98},"X_{k+1}=AX_{k}+BU_{k}",[],{"type":17,"tag":18,"props":101,"children":103},{"id":102},"formulation",[104],{"type":23,"value":105},"Formulation",{"type":17,"tag":26,"props":107,"children":108},{},[109],{"type":23,"value":110},"As I mentioned, this is quadratic cost. It consists of summation of all the cost that was produced over the number of horizontal prediction.",{"type":17,"tag":96,"props":112,"children":114},{"styles":58,"latex-express":113},"J(x,u) = \\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N}, U_{N})",[],{"type":17,"tag":26,"props":116,"children":117},{},[118],{"type":23,"value":119},"Notation",{"type":17,"tag":121,"props":122,"children":123},"ul",{},[124,135,144,153],{"type":17,"tag":125,"props":126,"children":127},"li",{},[128,133],{"type":17,"tag":96,"props":129,"children":132},{"styles":130,"latex-express":131},"inline-flex space-x-3","X",[],{"type":23,"value":134}," is the state of the system. This shall be obtained from the optimiztion problem",{"type":17,"tag":125,"props":136,"children":137},{},[138,142],{"type":17,"tag":96,"props":139,"children":141},{"styles":130,"latex-express":140},"X_{ref}",[],{"type":23,"value":143}," is the reference state of the system or desired input state.",{"type":17,"tag":125,"props":145,"children":146},{},[147,151],{"type":17,"tag":96,"props":148,"children":150},{"styles":130,"latex-express":149},"U",[],{"type":23,"value":152}," is the input control of the system. This is a solution obtained from the optimization problem.",{"type":17,"tag":125,"props":154,"children":155},{},[156,160],{"type":17,"tag":96,"props":157,"children":159},{"styles":130,"latex-express":158},"U_{ref}",[],{"type":23,"value":161}," is the reference control of the system or desired input control.",{"type":17,"tag":18,"props":163,"children":165},{"id":164},"was-it-really-that-good",[166],{"type":23,"value":167},"Was it really that good ?",{"type":17,"tag":26,"props":169,"children":170},{},[171],{"type":23,"value":172},"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!.",{"type":17,"tag":174,"props":175,"children":180},"figure",{"className":176},[177,178,179],"mb-4","inline-block","max-w-sm",[181,183],{"type":23,"value":182},"\n  ",{"type":17,"tag":42,"props":184,"children":187},{"className":185,"src":186,"width":46,"height":47},[45],"/topics/nmpc/diff_mpc.png",[],{"type":17,"tag":55,"props":189,"children":191},{"className":190},[58,59,60,61],[192],{"type":23,"value":193},"\n    Plot of differential drive robot follow the circle trajectory !!!.\n",{"type":17,"tag":18,"props":195,"children":197},{"id":196},"how-to-implement-it-in-python",[198],{"type":23,"value":199},"How to implement it in Python?",{"type":17,"tag":26,"props":201,"children":202},{},[203,205,214,216],{"type":23,"value":204},"There are so many great way to implement this control everywhere with many mathematical optimization library!!!. But for the sake of god, I use Casadi and CVXPY which I think one of the most easy tool to use. I will draft some python code here, but I cannot include them all in this post. You can check it more on my github repository, I do open-source some of my work !!! ",{"type":17,"tag":206,"props":207,"children":211},"a",{"href":208,"rel":209},"https://github.com/SokhengDin/PathTracking",[210],"nofollow",[212],{"type":23,"value":213},"Github",{"type":23,"value":215},". ",{"type":17,"tag":87,"props":217,"children":218},{},[],{"type":17,"tag":26,"props":220,"children":221},{},[222,224],{"type":23,"value":223},"I recommend you guys to have your own virtual enviroment, so I would be easier to work with any other related project of control system. ",{"type":17,"tag":87,"props":225,"children":226},{},[],{"type":17,"tag":26,"props":228,"children":229},{},[230],{"type":23,"value":231},"Make sure that you have install.",{"type":17,"tag":233,"props":234,"children":239},"code",{"className":235,"code":237,"language":238,"meta":7},[236],"language-bash","pip3 install casadi && pip3 install cvxpy\n","bash",[240],{"type":17,"tag":241,"props":242,"children":243},"pre",{},[244],{"type":17,"tag":233,"props":245,"children":246},{"__ignoreMap":7},[247],{"type":17,"tag":248,"props":249,"children":252},"span",{"class":250,"line":251},"line",1,[253,259,265,271,275,280,285,289,293,297,301],{"type":17,"tag":248,"props":254,"children":256},{"class":255},"ct-806137",[257],{"type":23,"value":258},"pip3",{"type":17,"tag":248,"props":260,"children":262},{"class":261},"ct-767297",[263],{"type":23,"value":264}," ",{"type":17,"tag":248,"props":266,"children":268},{"class":267},"ct-244866",[269],{"type":23,"value":270},"install",{"type":17,"tag":248,"props":272,"children":273},{"class":261},[274],{"type":23,"value":264},{"type":17,"tag":248,"props":276,"children":277},{"class":267},[278],{"type":23,"value":279},"casadi",{"type":17,"tag":248,"props":281,"children":282},{"class":261},[283],{"type":23,"value":284}," && ",{"type":17,"tag":248,"props":286,"children":287},{"class":255},[288],{"type":23,"value":258},{"type":17,"tag":248,"props":290,"children":291},{"class":261},[292],{"type":23,"value":264},{"type":17,"tag":248,"props":294,"children":295},{"class":267},[296],{"type":23,"value":270},{"type":17,"tag":248,"props":298,"children":299},{"class":261},[300],{"type":23,"value":264},{"type":17,"tag":248,"props":302,"children":303},{"class":267},[304],{"type":23,"value":305},"cvxpy",{"type":17,"tag":26,"props":307,"children":308},{},[309],{"type":23,"value":310},"It is a good idea to write your robot model as a class object in Python, because it can help handle the update state of your system. For me, I am gonna use Numpy for mathematical operation.",{"type":17,"tag":233,"props":312,"children":317},{"className":313,"code":315,"language":316,"meta":7},[314],"language-python","import numpy as np\n\nclass DifferentialDrive:\n\n    def forward_kinematic(self, yaw, v, omega):\n        vx = v * np.cos(yaw)\n        vy = v * np.sin(yaw)\n        vyaw = omega\n\n        return vx, vy, vyaw\n","python",[318],{"type":17,"tag":241,"props":319,"children":320},{},[321],{"type":17,"tag":233,"props":322,"children":323},{"__ignoreMap":7},[324,348,357,380,388,416,445,471,489,497],{"type":17,"tag":248,"props":325,"children":326},{"class":250,"line":251},[327,333,338,343],{"type":17,"tag":248,"props":328,"children":330},{"class":329},"ct-857441",[331],{"type":23,"value":332},"import",{"type":17,"tag":248,"props":334,"children":335},{"class":261},[336],{"type":23,"value":337}," numpy ",{"type":17,"tag":248,"props":339,"children":340},{"class":329},[341],{"type":23,"value":342},"as",{"type":17,"tag":248,"props":344,"children":345},{"class":261},[346],{"type":23,"value":347}," np\n",{"type":17,"tag":248,"props":349,"children":351},{"class":250,"line":350},2,[352],{"type":17,"tag":248,"props":353,"children":354},{},[355],{"type":23,"value":356},"\n",{"type":17,"tag":248,"props":358,"children":360},{"class":250,"line":359},3,[361,366,370,375],{"type":17,"tag":248,"props":362,"children":363},{"class":329},[364],{"type":23,"value":365},"class",{"type":17,"tag":248,"props":367,"children":368},{"class":261},[369],{"type":23,"value":264},{"type":17,"tag":248,"props":371,"children":372},{"class":255},[373],{"type":23,"value":374},"DifferentialDrive",{"type":17,"tag":248,"props":376,"children":377},{"class":261},[378],{"type":23,"value":379},":\n",{"type":17,"tag":248,"props":381,"children":383},{"class":250,"line":382},4,[384],{"type":17,"tag":248,"props":385,"children":386},{},[387],{"type":23,"value":356},{"type":17,"tag":248,"props":389,"children":391},{"class":250,"line":390},5,[392,397,402,406,411],{"type":17,"tag":248,"props":393,"children":394},{"class":261},[395],{"type":23,"value":396},"    ",{"type":17,"tag":248,"props":398,"children":399},{"class":329},[400],{"type":23,"value":401},"def",{"type":17,"tag":248,"props":403,"children":404},{"class":261},[405],{"type":23,"value":264},{"type":17,"tag":248,"props":407,"children":408},{"class":255},[409],{"type":23,"value":410},"forward_kinematic",{"type":17,"tag":248,"props":412,"children":413},{"class":261},[414],{"type":23,"value":415},"(self, yaw, v, omega):\n",{"type":17,"tag":248,"props":417,"children":419},{"class":250,"line":418},6,[420,425,430,435,440],{"type":17,"tag":248,"props":421,"children":422},{"class":261},[423],{"type":23,"value":424},"        vx ",{"type":17,"tag":248,"props":426,"children":427},{"class":329},[428],{"type":23,"value":429},"=",{"type":17,"tag":248,"props":431,"children":432},{"class":261},[433],{"type":23,"value":434}," v ",{"type":17,"tag":248,"props":436,"children":437},{"class":329},[438],{"type":23,"value":439},"*",{"type":17,"tag":248,"props":441,"children":442},{"class":261},[443],{"type":23,"value":444}," np.cos(yaw)\n",{"type":17,"tag":248,"props":446,"children":448},{"class":250,"line":447},7,[449,454,458,462,466],{"type":17,"tag":248,"props":450,"children":451},{"class":261},[452],{"type":23,"value":453},"        vy ",{"type":17,"tag":248,"props":455,"children":456},{"class":329},[457],{"type":23,"value":429},{"type":17,"tag":248,"props":459,"children":460},{"class":261},[461],{"type":23,"value":434},{"type":17,"tag":248,"props":463,"children":464},{"class":329},[465],{"type":23,"value":439},{"type":17,"tag":248,"props":467,"children":468},{"class":261},[469],{"type":23,"value":470}," np.sin(yaw)\n",{"type":17,"tag":248,"props":472,"children":474},{"class":250,"line":473},8,[475,480,484],{"type":17,"tag":248,"props":476,"children":477},{"class":261},[478],{"type":23,"value":479},"        vyaw ",{"type":17,"tag":248,"props":481,"children":482},{"class":329},[483],{"type":23,"value":429},{"type":17,"tag":248,"props":485,"children":486},{"class":261},[487],{"type":23,"value":488}," omega\n",{"type":17,"tag":248,"props":490,"children":492},{"class":250,"line":491},9,[493],{"type":17,"tag":248,"props":494,"children":495},{},[496],{"type":23,"value":356},{"type":17,"tag":248,"props":498,"children":500},{"class":250,"line":499},10,[501,506,511],{"type":17,"tag":248,"props":502,"children":503},{"class":261},[504],{"type":23,"value":505},"        ",{"type":17,"tag":248,"props":507,"children":508},{"class":329},[509],{"type":23,"value":510},"return",{"type":17,"tag":248,"props":512,"children":513},{"class":261},[514],{"type":23,"value":515}," vx, vy, vyaw",{"type":17,"tag":26,"props":517,"children":518},{},[519,521,527],{"type":23,"value":520},"Next add this update state function into our ",{"type":17,"tag":522,"props":523,"children":524},"strong",{},[525],{"type":23,"value":526},"DifferentialDrive ",{"type":23,"value":528}," class, by doing this we would have all the attribute of our robot system.",{"type":17,"tag":233,"props":530,"children":533},{"className":531,"code":532,"language":316,"meta":7},[314],"def update_state(self, x0, y0, yaw0, yaw, v, omega):\n\n  dx, dy, dyaw = self.robot_model.forward_kinematic(yaw, v, omega)\n\n  x_next = x0 + dx*self.dtau\n  y_next = y0 + dy*self.dtau\n  yaw_next = yaw0 + dyaw*self.dtau\n\n  return x_next, y_next, yaw_next\n",[534],{"type":17,"tag":241,"props":535,"children":536},{},[537],{"type":17,"tag":233,"props":538,"children":539},{"__ignoreMap":7},[540,561,568,595,602,642,680,718,725],{"type":17,"tag":248,"props":541,"children":542},{"class":250,"line":251},[543,547,551,556],{"type":17,"tag":248,"props":544,"children":545},{"class":329},[546],{"type":23,"value":401},{"type":17,"tag":248,"props":548,"children":549},{"class":261},[550],{"type":23,"value":264},{"type":17,"tag":248,"props":552,"children":553},{"class":255},[554],{"type":23,"value":555},"update_state",{"type":17,"tag":248,"props":557,"children":558},{"class":261},[559],{"type":23,"value":560},"(self, x0, y0, yaw0, yaw, v, omega):\n",{"type":17,"tag":248,"props":562,"children":563},{"class":250,"line":350},[564],{"type":17,"tag":248,"props":565,"children":566},{},[567],{"type":23,"value":356},{"type":17,"tag":248,"props":569,"children":570},{"class":250,"line":359},[571,576,580,584,590],{"type":17,"tag":248,"props":572,"children":573},{"class":261},[574],{"type":23,"value":575},"  dx, dy, dyaw ",{"type":17,"tag":248,"props":577,"children":578},{"class":329},[579],{"type":23,"value":429},{"type":17,"tag":248,"props":581,"children":582},{"class":261},[583],{"type":23,"value":264},{"type":17,"tag":248,"props":585,"children":587},{"class":586},"ct-533739",[588],{"type":23,"value":589},"self",{"type":17,"tag":248,"props":591,"children":592},{"class":261},[593],{"type":23,"value":594},".robot_model.forward_kinematic(yaw, v, omega)\n",{"type":17,"tag":248,"props":596,"children":597},{"class":250,"line":382},[598],{"type":17,"tag":248,"props":599,"children":600},{},[601],{"type":23,"value":356},{"type":17,"tag":248,"props":603,"children":604},{"class":250,"line":390},[605,610,614,619,624,629,633,637],{"type":17,"tag":248,"props":606,"children":607},{"class":261},[608],{"type":23,"value":609},"  x_next ",{"type":17,"tag":248,"props":611,"children":612},{"class":329},[613],{"type":23,"value":429},{"type":17,"tag":248,"props":615,"children":616},{"class":261},[617],{"type":23,"value":618}," x0 ",{"type":17,"tag":248,"props":620,"children":621},{"class":329},[622],{"type":23,"value":623},"+",{"type":17,"tag":248,"props":625,"children":626},{"class":261},[627],{"type":23,"value":628}," dx",{"type":17,"tag":248,"props":630,"children":631},{"class":329},[632],{"type":23,"value":439},{"type":17,"tag":248,"props":634,"children":635},{"class":586},[636],{"type":23,"value":589},{"type":17,"tag":248,"props":638,"children":639},{"class":261},[640],{"type":23,"value":641},".dtau\n",{"type":17,"tag":248,"props":643,"children":644},{"class":250,"line":418},[645,650,654,659,663,668,672,676],{"type":17,"tag":248,"props":646,"children":647},{"class":261},[648],{"type":23,"value":649},"  y_next ",{"type":17,"tag":248,"props":651,"children":652},{"class":329},[653],{"type":23,"value":429},{"type":17,"tag":248,"props":655,"children":656},{"class":261},[657],{"type":23,"value":658}," y0 ",{"type":17,"tag":248,"props":660,"children":661},{"class":329},[662],{"type":23,"value":623},{"type":17,"tag":248,"props":664,"children":665},{"class":261},[666],{"type":23,"value":667}," dy",{"type":17,"tag":248,"props":669,"children":670},{"class":329},[671],{"type":23,"value":439},{"type":17,"tag":248,"props":673,"children":674},{"class":586},[675],{"type":23,"value":589},{"type":17,"tag":248,"props":677,"children":678},{"class":261},[679],{"type":23,"value":641},{"type":17,"tag":248,"props":681,"children":682},{"class":250,"line":447},[683,688,692,697,701,706,710,714],{"type":17,"tag":248,"props":684,"children":685},{"class":261},[686],{"type":23,"value":687},"  yaw_next ",{"type":17,"tag":248,"props":689,"children":690},{"class":329},[691],{"type":23,"value":429},{"type":17,"tag":248,"props":693,"children":694},{"class":261},[695],{"type":23,"value":696}," yaw0 ",{"type":17,"tag":248,"props":698,"children":699},{"class":329},[700],{"type":23,"value":623},{"type":17,"tag":248,"props":702,"children":703},{"class":261},[704],{"type":23,"value":705}," dyaw",{"type":17,"tag":248,"props":707,"children":708},{"class":329},[709],{"type":23,"value":439},{"type":17,"tag":248,"props":711,"children":712},{"class":586},[713],{"type":23,"value":589},{"type":17,"tag":248,"props":715,"children":716},{"class":261},[717],{"type":23,"value":641},{"type":17,"tag":248,"props":719,"children":720},{"class":250,"line":473},[721],{"type":17,"tag":248,"props":722,"children":723},{},[724],{"type":23,"value":356},{"type":17,"tag":248,"props":726,"children":727},{"class":250,"line":491},[728,733,737],{"type":17,"tag":248,"props":729,"children":730},{"class":261},[731],{"type":23,"value":732},"  ",{"type":17,"tag":248,"props":734,"children":735},{"class":329},[736],{"type":23,"value":510},{"type":17,"tag":248,"props":738,"children":739},{"class":261},[740],{"type":23,"value":741}," x_next, y_next, yaw_next",{"type":17,"tag":26,"props":743,"children":744},{},[745,747,750],{"type":23,"value":746},"How to define the quadratic cost in Python with CVXPY ? and set the constraint for your system ? ",{"type":17,"tag":87,"props":748,"children":749},{},[],{"type":23,"value":751},"\nHere, how you would write it.",{"type":17,"tag":233,"props":753,"children":756},{"className":754,"code":755,"language":316,"meta":7},[314],"for t in range(T):\n    cost += cvxpy.quad_form(u[:, t], R)\n\n    if t != 0:\n        cost += cvxpy.quad_form(x_ref[:, t] - x[:, t], Q)\n\n    A, B, C = get_linear_model_matrix(x_ref, u_ref)\n    constraints += [x[:, t + 1] == A @ x[:, t] + B @ u[:, t] + C]\n\n    if t \u003C (T - 1):\n        cost += cvxpy.quad_form(u[:, t + 1] - u[:, t], Rd)\n        constraints += [cvxpy.abs(u[1, t + 1] - u[1, t]) \u003C= DESIRED_CONTROL]\n\ncost += cvxpy.quad_form(xref[:, T] - x[:, T], Q)\n",[757],{"type":17,"tag":241,"props":758,"children":759},{},[760],{"type":17,"tag":233,"props":761,"children":762},{"__ignoreMap":7},[763,795,813,820,854,881,888,905,987,994,1036,1078,1158,1166],{"type":17,"tag":248,"props":764,"children":765},{"class":250,"line":251},[766,771,776,781,785,790],{"type":17,"tag":248,"props":767,"children":768},{"class":329},[769],{"type":23,"value":770},"for",{"type":17,"tag":248,"props":772,"children":773},{"class":261},[774],{"type":23,"value":775}," t ",{"type":17,"tag":248,"props":777,"children":778},{"class":329},[779],{"type":23,"value":780},"in",{"type":17,"tag":248,"props":782,"children":783},{"class":261},[784],{"type":23,"value":264},{"type":17,"tag":248,"props":786,"children":787},{"class":586},[788],{"type":23,"value":789},"range",{"type":17,"tag":248,"props":791,"children":792},{"class":261},[793],{"type":23,"value":794},"(T):\n",{"type":17,"tag":248,"props":796,"children":797},{"class":250,"line":350},[798,803,808],{"type":17,"tag":248,"props":799,"children":800},{"class":261},[801],{"type":23,"value":802},"    cost ",{"type":17,"tag":248,"props":804,"children":805},{"class":329},[806],{"type":23,"value":807},"+=",{"type":17,"tag":248,"props":809,"children":810},{"class":261},[811],{"type":23,"value":812}," cvxpy.quad_form(u[:, t], R)\n",{"type":17,"tag":248,"props":814,"children":815},{"class":250,"line":359},[816],{"type":17,"tag":248,"props":817,"children":818},{},[819],{"type":23,"value":356},{"type":17,"tag":248,"props":821,"children":822},{"class":250,"line":382},[823,827,832,836,841,845,850],{"type":17,"tag":248,"props":824,"children":825},{"class":261},[826],{"type":23,"value":396},{"type":17,"tag":248,"props":828,"children":829},{"class":329},[830],{"type":23,"value":831},"if",{"type":17,"tag":248,"props":833,"children":834},{"class":261},[835],{"type":23,"value":775},{"type":17,"tag":248,"props":837,"children":838},{"class":329},[839],{"type":23,"value":840},"!=",{"type":17,"tag":248,"props":842,"children":843},{"class":261},[844],{"type":23,"value":264},{"type":17,"tag":248,"props":846,"children":847},{"class":586},[848],{"type":23,"value":849},"0",{"type":17,"tag":248,"props":851,"children":852},{"class":261},[853],{"type":23,"value":379},{"type":17,"tag":248,"props":855,"children":856},{"class":250,"line":390},[857,862,866,871,876],{"type":17,"tag":248,"props":858,"children":859},{"class":261},[860],{"type":23,"value":861},"        cost ",{"type":17,"tag":248,"props":863,"children":864},{"class":329},[865],{"type":23,"value":807},{"type":17,"tag":248,"props":867,"children":868},{"class":261},[869],{"type":23,"value":870}," cvxpy.quad_form(x_ref[:, t] ",{"type":17,"tag":248,"props":872,"children":873},{"class":329},[874],{"type":23,"value":875},"-",{"type":17,"tag":248,"props":877,"children":878},{"class":261},[879],{"type":23,"value":880}," x[:, t], Q)\n",{"type":17,"tag":248,"props":882,"children":883},{"class":250,"line":418},[884],{"type":17,"tag":248,"props":885,"children":886},{},[887],{"type":23,"value":356},{"type":17,"tag":248,"props":889,"children":890},{"class":250,"line":447},[891,896,900],{"type":17,"tag":248,"props":892,"children":893},{"class":261},[894],{"type":23,"value":895},"    A, B, C ",{"type":17,"tag":248,"props":897,"children":898},{"class":329},[899],{"type":23,"value":429},{"type":17,"tag":248,"props":901,"children":902},{"class":261},[903],{"type":23,"value":904}," get_linear_model_matrix(x_ref, u_ref)\n",{"type":17,"tag":248,"props":906,"children":907},{"class":250,"line":473},[908,913,917,922,926,930,935,940,945,950,955,960,964,969,973,978,982],{"type":17,"tag":248,"props":909,"children":910},{"class":261},[911],{"type":23,"value":912},"    constraints ",{"type":17,"tag":248,"props":914,"children":915},{"class":329},[916],{"type":23,"value":807},{"type":17,"tag":248,"props":918,"children":919},{"class":261},[920],{"type":23,"value":921}," [x[:, t ",{"type":17,"tag":248,"props":923,"children":924},{"class":329},[925],{"type":23,"value":623},{"type":17,"tag":248,"props":927,"children":928},{"class":261},[929],{"type":23,"value":264},{"type":17,"tag":248,"props":931,"children":932},{"class":586},[933],{"type":23,"value":934},"1",{"type":17,"tag":248,"props":936,"children":937},{"class":261},[938],{"type":23,"value":939},"] ",{"type":17,"tag":248,"props":941,"children":942},{"class":329},[943],{"type":23,"value":944},"==",{"type":17,"tag":248,"props":946,"children":947},{"class":261},[948],{"type":23,"value":949}," A ",{"type":17,"tag":248,"props":951,"children":952},{"class":329},[953],{"type":23,"value":954},"@",{"type":17,"tag":248,"props":956,"children":957},{"class":261},[958],{"type":23,"value":959}," x[:, t] ",{"type":17,"tag":248,"props":961,"children":962},{"class":329},[963],{"type":23,"value":623},{"type":17,"tag":248,"props":965,"children":966},{"class":261},[967],{"type":23,"value":968}," B ",{"type":17,"tag":248,"props":970,"children":971},{"class":329},[972],{"type":23,"value":954},{"type":17,"tag":248,"props":974,"children":975},{"class":261},[976],{"type":23,"value":977}," u[:, t] ",{"type":17,"tag":248,"props":979,"children":980},{"class":329},[981],{"type":23,"value":623},{"type":17,"tag":248,"props":983,"children":984},{"class":261},[985],{"type":23,"value":986}," C]\n",{"type":17,"tag":248,"props":988,"children":989},{"class":250,"line":491},[990],{"type":17,"tag":248,"props":991,"children":992},{},[993],{"type":23,"value":356},{"type":17,"tag":248,"props":995,"children":996},{"class":250,"line":499},[997,1001,1005,1009,1014,1019,1023,1027,1031],{"type":17,"tag":248,"props":998,"children":999},{"class":261},[1000],{"type":23,"value":396},{"type":17,"tag":248,"props":1002,"children":1003},{"class":329},[1004],{"type":23,"value":831},{"type":17,"tag":248,"props":1006,"children":1007},{"class":261},[1008],{"type":23,"value":775},{"type":17,"tag":248,"props":1010,"children":1011},{"class":329},[1012],{"type":23,"value":1013},"\u003C",{"type":17,"tag":248,"props":1015,"children":1016},{"class":261},[1017],{"type":23,"value":1018}," (T ",{"type":17,"tag":248,"props":1020,"children":1021},{"class":329},[1022],{"type":23,"value":875},{"type":17,"tag":248,"props":1024,"children":1025},{"class":261},[1026],{"type":23,"value":264},{"type":17,"tag":248,"props":1028,"children":1029},{"class":586},[1030],{"type":23,"value":934},{"type":17,"tag":248,"props":1032,"children":1033},{"class":261},[1034],{"type":23,"value":1035},"):\n",{"type":17,"tag":248,"props":1037,"children":1039},{"class":250,"line":1038},11,[1040,1044,1048,1053,1057,1061,1065,1069,1073],{"type":17,"tag":248,"props":1041,"children":1042},{"class":261},[1043],{"type":23,"value":861},{"type":17,"tag":248,"props":1045,"children":1046},{"class":329},[1047],{"type":23,"value":807},{"type":17,"tag":248,"props":1049,"children":1050},{"class":261},[1051],{"type":23,"value":1052}," cvxpy.quad_form(u[:, t ",{"type":17,"tag":248,"props":1054,"children":1055},{"class":329},[1056],{"type":23,"value":623},{"type":17,"tag":248,"props":1058,"children":1059},{"class":261},[1060],{"type":23,"value":264},{"type":17,"tag":248,"props":1062,"children":1063},{"class":586},[1064],{"type":23,"value":934},{"type":17,"tag":248,"props":1066,"children":1067},{"class":261},[1068],{"type":23,"value":939},{"type":17,"tag":248,"props":1070,"children":1071},{"class":329},[1072],{"type":23,"value":875},{"type":17,"tag":248,"props":1074,"children":1075},{"class":261},[1076],{"type":23,"value":1077}," u[:, t], Rd)\n",{"type":17,"tag":248,"props":1079,"children":1081},{"class":250,"line":1080},12,[1082,1087,1091,1096,1100,1105,1109,1113,1117,1121,1125,1130,1134,1139,1144,1148,1153],{"type":17,"tag":248,"props":1083,"children":1084},{"class":261},[1085],{"type":23,"value":1086},"        constraints ",{"type":17,"tag":248,"props":1088,"children":1089},{"class":329},[1090],{"type":23,"value":807},{"type":17,"tag":248,"props":1092,"children":1093},{"class":261},[1094],{"type":23,"value":1095}," [cvxpy.abs(u[",{"type":17,"tag":248,"props":1097,"children":1098},{"class":586},[1099],{"type":23,"value":934},{"type":17,"tag":248,"props":1101,"children":1102},{"class":261},[1103],{"type":23,"value":1104},", t ",{"type":17,"tag":248,"props":1106,"children":1107},{"class":329},[1108],{"type":23,"value":623},{"type":17,"tag":248,"props":1110,"children":1111},{"class":261},[1112],{"type":23,"value":264},{"type":17,"tag":248,"props":1114,"children":1115},{"class":586},[1116],{"type":23,"value":934},{"type":17,"tag":248,"props":1118,"children":1119},{"class":261},[1120],{"type":23,"value":939},{"type":17,"tag":248,"props":1122,"children":1123},{"class":329},[1124],{"type":23,"value":875},{"type":17,"tag":248,"props":1126,"children":1127},{"class":261},[1128],{"type":23,"value":1129}," u[",{"type":17,"tag":248,"props":1131,"children":1132},{"class":586},[1133],{"type":23,"value":934},{"type":17,"tag":248,"props":1135,"children":1136},{"class":261},[1137],{"type":23,"value":1138},", t]) ",{"type":17,"tag":248,"props":1140,"children":1141},{"class":329},[1142],{"type":23,"value":1143},"\u003C=",{"type":17,"tag":248,"props":1145,"children":1146},{"class":261},[1147],{"type":23,"value":264},{"type":17,"tag":248,"props":1149,"children":1150},{"class":586},[1151],{"type":23,"value":1152},"DESIRED_CONTROL",{"type":17,"tag":248,"props":1154,"children":1155},{"class":261},[1156],{"type":23,"value":1157},"]\n",{"type":17,"tag":248,"props":1159,"children":1161},{"class":250,"line":1160},13,[1162],{"type":17,"tag":248,"props":1163,"children":1164},{},[1165],{"type":23,"value":356},{"type":17,"tag":248,"props":1167,"children":1169},{"class":250,"line":1168},14,[1170,1175,1179,1184,1188],{"type":17,"tag":248,"props":1171,"children":1172},{"class":261},[1173],{"type":23,"value":1174},"cost ",{"type":17,"tag":248,"props":1176,"children":1177},{"class":329},[1178],{"type":23,"value":807},{"type":17,"tag":248,"props":1180,"children":1181},{"class":261},[1182],{"type":23,"value":1183}," cvxpy.quad_form(xref[:, T] ",{"type":17,"tag":248,"props":1185,"children":1186},{"class":329},[1187],{"type":23,"value":875},{"type":17,"tag":248,"props":1189,"children":1190},{"class":261},[1191],{"type":23,"value":1192}," x[:, T], Q)",{"type":17,"tag":26,"props":1194,"children":1195},{},[1196,1198,1203,1205,1208],{"type":23,"value":1197},"The function ",{"type":17,"tag":522,"props":1199,"children":1200},{},[1201],{"type":23,"value":1202}," get_linear_model_matrix ",{"type":23,"value":1204}," would return the linearized model as the shown as the formula above. ",{"type":17,"tag":87,"props":1206,"children":1207},{},[],{"type":23,"value":1209},"\nWe can set more constraint by adding",{"type":17,"tag":233,"props":1211,"children":1214},{"className":1212,"code":1213,"language":316,"meta":7},[314],"  constraints += [x[:, 0] == x0]\n  constraints += [x[2, :] \u003C= MAX_SPEED]\n  constraints += [x[2, :] >= MIN_SPEED]\n  constraints += [cvxpy.abs(u[0, :]) \u003C= MAX_ACCEL]\n  constraints += [cvxpy.abs(u[1, :]) \u003C= MAX_STEER]\n",[1215],{"type":17,"tag":241,"props":1216,"children":1217},{},[1218],{"type":17,"tag":233,"props":1219,"children":1220},{"__ignoreMap":7},[1221,1255,1298,1339,1380],{"type":17,"tag":248,"props":1222,"children":1223},{"class":250,"line":251},[1224,1229,1233,1238,1242,1246,1250],{"type":17,"tag":248,"props":1225,"children":1226},{"class":261},[1227],{"type":23,"value":1228},"  constraints ",{"type":17,"tag":248,"props":1230,"children":1231},{"class":329},[1232],{"type":23,"value":807},{"type":17,"tag":248,"props":1234,"children":1235},{"class":261},[1236],{"type":23,"value":1237}," [x[:, ",{"type":17,"tag":248,"props":1239,"children":1240},{"class":586},[1241],{"type":23,"value":849},{"type":17,"tag":248,"props":1243,"children":1244},{"class":261},[1245],{"type":23,"value":939},{"type":17,"tag":248,"props":1247,"children":1248},{"class":329},[1249],{"type":23,"value":944},{"type":17,"tag":248,"props":1251,"children":1252},{"class":261},[1253],{"type":23,"value":1254}," x0]\n",{"type":17,"tag":248,"props":1256,"children":1257},{"class":250,"line":350},[1258,1262,1266,1271,1276,1281,1285,1289,1294],{"type":17,"tag":248,"props":1259,"children":1260},{"class":261},[1261],{"type":23,"value":1228},{"type":17,"tag":248,"props":1263,"children":1264},{"class":329},[1265],{"type":23,"value":807},{"type":17,"tag":248,"props":1267,"children":1268},{"class":261},[1269],{"type":23,"value":1270}," [x[",{"type":17,"tag":248,"props":1272,"children":1273},{"class":586},[1274],{"type":23,"value":1275},"2",{"type":17,"tag":248,"props":1277,"children":1278},{"class":261},[1279],{"type":23,"value":1280},", :] ",{"type":17,"tag":248,"props":1282,"children":1283},{"class":329},[1284],{"type":23,"value":1143},{"type":17,"tag":248,"props":1286,"children":1287},{"class":261},[1288],{"type":23,"value":264},{"type":17,"tag":248,"props":1290,"children":1291},{"class":586},[1292],{"type":23,"value":1293},"MAX_SPEED",{"type":17,"tag":248,"props":1295,"children":1296},{"class":261},[1297],{"type":23,"value":1157},{"type":17,"tag":248,"props":1299,"children":1300},{"class":250,"line":359},[1301,1305,1309,1313,1317,1321,1326,1330,1335],{"type":17,"tag":248,"props":1302,"children":1303},{"class":261},[1304],{"type":23,"value":1228},{"type":17,"tag":248,"props":1306,"children":1307},{"class":329},[1308],{"type":23,"value":807},{"type":17,"tag":248,"props":1310,"children":1311},{"class":261},[1312],{"type":23,"value":1270},{"type":17,"tag":248,"props":1314,"children":1315},{"class":586},[1316],{"type":23,"value":1275},{"type":17,"tag":248,"props":1318,"children":1319},{"class":261},[1320],{"type":23,"value":1280},{"type":17,"tag":248,"props":1322,"children":1323},{"class":329},[1324],{"type":23,"value":1325},">=",{"type":17,"tag":248,"props":1327,"children":1328},{"class":261},[1329],{"type":23,"value":264},{"type":17,"tag":248,"props":1331,"children":1332},{"class":586},[1333],{"type":23,"value":1334},"MIN_SPEED",{"type":17,"tag":248,"props":1336,"children":1337},{"class":261},[1338],{"type":23,"value":1157},{"type":17,"tag":248,"props":1340,"children":1341},{"class":250,"line":382},[1342,1346,1350,1354,1358,1363,1367,1371,1376],{"type":17,"tag":248,"props":1343,"children":1344},{"class":261},[1345],{"type":23,"value":1228},{"type":17,"tag":248,"props":1347,"children":1348},{"class":329},[1349],{"type":23,"value":807},{"type":17,"tag":248,"props":1351,"children":1352},{"class":261},[1353],{"type":23,"value":1095},{"type":17,"tag":248,"props":1355,"children":1356},{"class":586},[1357],{"type":23,"value":849},{"type":17,"tag":248,"props":1359,"children":1360},{"class":261},[1361],{"type":23,"value":1362},", :]) ",{"type":17,"tag":248,"props":1364,"children":1365},{"class":329},[1366],{"type":23,"value":1143},{"type":17,"tag":248,"props":1368,"children":1369},{"class":261},[1370],{"type":23,"value":264},{"type":17,"tag":248,"props":1372,"children":1373},{"class":586},[1374],{"type":23,"value":1375},"MAX_ACCEL",{"type":17,"tag":248,"props":1377,"children":1378},{"class":261},[1379],{"type":23,"value":1157},{"type":17,"tag":248,"props":1381,"children":1382},{"class":250,"line":390},[1383,1387,1391,1395,1399,1403,1407,1411,1416],{"type":17,"tag":248,"props":1384,"children":1385},{"class":261},[1386],{"type":23,"value":1228},{"type":17,"tag":248,"props":1388,"children":1389},{"class":329},[1390],{"type":23,"value":807},{"type":17,"tag":248,"props":1392,"children":1393},{"class":261},[1394],{"type":23,"value":1095},{"type":17,"tag":248,"props":1396,"children":1397},{"class":586},[1398],{"type":23,"value":934},{"type":17,"tag":248,"props":1400,"children":1401},{"class":261},[1402],{"type":23,"value":1362},{"type":17,"tag":248,"props":1404,"children":1405},{"class":329},[1406],{"type":23,"value":1143},{"type":17,"tag":248,"props":1408,"children":1409},{"class":261},[1410],{"type":23,"value":264},{"type":17,"tag":248,"props":1412,"children":1413},{"class":586},[1414],{"type":23,"value":1415},"MAX_STEER",{"type":17,"tag":248,"props":1417,"children":1418},{"class":261},[1419],{"type":23,"value":1420},"]",{"type":17,"tag":26,"props":1422,"children":1423},{},[1424],{"type":23,"value":1425},"Finally, we define the optimizer for our system by",{"type":17,"tag":233,"props":1427,"children":1430},{"className":1428,"code":1429,"language":316,"meta":7},[314],"prob = cvxpy.Problem(cvxpy.Minimize(cost), constraints)\nprob.solve(solver=cvxpy.ECOS, verbose=False)\n",[1431],{"type":17,"tag":241,"props":1432,"children":1433},{},[1434],{"type":17,"tag":233,"props":1435,"children":1436},{"__ignoreMap":7},[1437,1454],{"type":17,"tag":248,"props":1438,"children":1439},{"class":250,"line":251},[1440,1445,1449],{"type":17,"tag":248,"props":1441,"children":1442},{"class":261},[1443],{"type":23,"value":1444},"prob ",{"type":17,"tag":248,"props":1446,"children":1447},{"class":329},[1448],{"type":23,"value":429},{"type":17,"tag":248,"props":1450,"children":1451},{"class":261},[1452],{"type":23,"value":1453}," cvxpy.Problem(cvxpy.Minimize(cost), constraints)\n",{"type":17,"tag":248,"props":1455,"children":1456},{"class":250,"line":350},[1457,1462,1468,1472,1477,1482,1487,1492,1496,1501],{"type":17,"tag":248,"props":1458,"children":1459},{"class":261},[1460],{"type":23,"value":1461},"prob.solve(",{"type":17,"tag":248,"props":1463,"children":1465},{"class":1464},"ct-657843",[1466],{"type":23,"value":1467},"solver",{"type":17,"tag":248,"props":1469,"children":1470},{"class":329},[1471],{"type":23,"value":429},{"type":17,"tag":248,"props":1473,"children":1474},{"class":261},[1475],{"type":23,"value":1476},"cvxpy.",{"type":17,"tag":248,"props":1478,"children":1479},{"class":586},[1480],{"type":23,"value":1481},"ECOS",{"type":17,"tag":248,"props":1483,"children":1484},{"class":261},[1485],{"type":23,"value":1486},", ",{"type":17,"tag":248,"props":1488,"children":1489},{"class":1464},[1490],{"type":23,"value":1491},"verbose",{"type":17,"tag":248,"props":1493,"children":1494},{"class":329},[1495],{"type":23,"value":429},{"type":17,"tag":248,"props":1497,"children":1498},{"class":586},[1499],{"type":23,"value":1500},"False",{"type":17,"tag":248,"props":1502,"children":1503},{"class":261},[1504],{"type":23,"value":1505},")",{"type":17,"tag":26,"props":1507,"children":1508},{},[1509,1511],{"type":23,"value":1510},"For more detail about using CVXPY, here is the link ",{"type":17,"tag":206,"props":1512,"children":1515},{"href":1513,"rel":1514},"https://www.cvxpy.org",[210],[1516],{"type":23,"value":1517},"CVXPY",{"type":17,"tag":18,"props":1519,"children":1521},{"id":1520},"in-conclusion",[1522],{"type":23,"value":1523},"In conclusion",{"type":17,"tag":26,"props":1525,"children":1526},{},[1527],{"type":23,"value":1528},"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too. Next post, I will explain about Nonlinear Model Predictive Control by using Casadi framework for mathematical optimization.",{"type":17,"tag":18,"props":1530,"children":1532},{"id":1531},"reference",[1533],{"type":23,"value":1534},"Reference",{"type":17,"tag":1536,"props":1537,"children":1538},"ol",{},[1539,1550,1561],{"type":17,"tag":125,"props":1540,"children":1541},{},[1542,1544],{"type":23,"value":1543},"PythonRobotics: ",{"type":17,"tag":206,"props":1545,"children":1548},{"href":1546,"rel":1547},"https://github.com/AtsushiSakai/PythonRobotics/tree/master/PathTracking/model_predictive_speed_and_steer_control",[210],[1549],{"type":23,"value":1546},{"type":17,"tag":125,"props":1551,"children":1552},{},[1553,1555],{"type":23,"value":1554},"Implementation of Linear Model Predictive Control: ",{"type":17,"tag":206,"props":1556,"children":1559},{"href":1557,"rel":1558},"https://arxiv.org/abs/2109.11986",[210],[1560],{"type":23,"value":1557},{"type":17,"tag":125,"props":1562,"children":1563},{},[1564,1566],{"type":23,"value":1565},"CVXPY: ",{"type":17,"tag":206,"props":1567,"children":1570},{"href":1568,"rel":1569},"https://www.cvxpy.org/",[210],[1571],{"type":23,"value":1568},{"type":17,"tag":1573,"children":1574},"style",[1575],{"type":23,"value":1576},".ct-806137{color:#B392F0;}\n.ct-767297{color:#E1E4E8;}\n.ct-244866{color:#9ECBFF;}\n.ct-857441{color:#F97583;}\n.ct-533739{color:#79B8FF;}\n.ct-657843{color:#FFAB70;}",{"title":7,"searchDepth":350,"depth":350,"links":1578},[1579,1580,1581,1582,1583,1584,1585,1586],{"id":20,"depth":350,"text":24},{"id":67,"depth":350,"text":70},{"id":11,"depth":350,"text":80},{"id":102,"depth":350,"text":105},{"id":164,"depth":350,"text":167},{"id":196,"depth":350,"text":199},{"id":1520,"depth":350,"text":1523},{"id":1531,"depth":350,"text":1534},"markdown","content:topics:linear-mpc.md","content","topics/linear-mpc.md","md",1693576955385]