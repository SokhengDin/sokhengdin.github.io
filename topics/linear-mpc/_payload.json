[{"data":1,"prerenderedAt":1531},["Reactive",2],{"content-/topics/linear-mpc":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"_empty":6,"title":8,"description":9,"author":10,"slug":11,"tag":11,"body":12,"_type":1526,"_id":1527,"_source":1528,"_file":1529,"_extension":1530},"/topics/linear-mpc","topics",false,"","Linear Model Predictive Control","Introduction to Linear Model Predictive Control","Din Sokheng","linear-mpc",{"type":13,"children":14,"toc":1518},"root",[15,24,30,54,65,72,77,82,91,96,101,107,112,116,121,146,152,157,172,178,184,203,211,216,290,295,500,513,726,736,1177,1194,1405,1410,1490,1502,1508,1513],{"type":16,"tag":17,"props":18,"children":20},"element","h1",{"id":19},"what-is-model-predictive-control",[21],{"type":22,"value":23},"text","What is Model Predictive Control ?",{"type":16,"tag":25,"props":26,"children":27},"p",{},[28],{"type":22,"value":29},"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system.",{"type":16,"tag":31,"props":32,"children":39},"div",{"className":33},[34,35,36,37,38],"grid","grid-cols-2","space-x-10","justify-center","items-center",[40,49],{"type":16,"tag":41,"props":42,"children":48},"img",{"className":43,"src":45,"width":46,"height":47},[44],"mx-auto","/topics/nmpc/predict_horizon.png","600px","300px",[],{"type":16,"tag":41,"props":50,"children":53},{"className":51,"src":52,"width":46,"height":47},[44],"/topics/nmpc/set_points.png",[],{"type":16,"tag":55,"props":56,"children":62},"figcaption",{"className":57},[58,59,60,61],"text-center","text-sm","text-neutral-600","dark:text-neutral-400",[63],{"type":22,"value":64},"\n      A car with finite horizons prediction and set point prediction over finite horizons.\n",{"type":16,"tag":66,"props":67,"children":69},"h2",{"id":68},"how-it-work",[70],{"type":22,"value":71},"How it work ?",{"type":16,"tag":25,"props":73,"children":74},{},[75],{"type":22,"value":76},"It works by solving the cost function that is produced by the sum of quadratic costs. For example, imagine you are riding a bike, and you want to get an ice cream because it is summer, and it tastes good ðŸ˜†. So, to get the ice cream, you need to grab your bike and ride it to the mart to buy one. What does it take to get you from your home to the mart store? Of course, it must be the energy produced by your muscles to pedal the bike and move. Another way to think about it is the cost of how the system would react to the desired position or point that you want it to reach. MPC have two types, they are Linear MPC and Nonlinear MPC. In this blog, we will only talk about Linear MPC.",{"type":16,"tag":66,"props":78,"children":79},{"id":11},[80],{"type":22,"value":81},"Linear MPC",{"type":16,"tag":25,"props":83,"children":84},{},[85,87],{"type":22,"value":86},"Linear MPC or Linear Model Predictive Control is an optimal control method that use with the system that it behavors linearly. It means that we can easily control this system with lost cost computation of the optimization and also ensure the lower risk of the system too!. ",{"type":16,"tag":88,"props":89,"children":90},"br",{},[],{"type":16,"tag":25,"props":92,"children":93},{},[94],{"type":22,"value":95},"Here is the formulation of the linear discrete system.",{"type":16,"tag":97,"props":98,"children":100},"math-render",{"math-code":99},"\nX_{k+1}=AX_{k}+BU_{k}",[],{"type":16,"tag":66,"props":102,"children":104},{"id":103},"formulation",[105],{"type":22,"value":106},"Formulation",{"type":16,"tag":25,"props":108,"children":109},{},[110],{"type":22,"value":111},"As I mentioned, this is quadratic cost. It consists of summation of all the cost that was produced over the number of horizontal prediction.",{"type":16,"tag":97,"props":113,"children":115},{"math-code":114},"J(x,u) = \\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N}, U_{N})",[],{"type":16,"tag":25,"props":117,"children":118},{},[119],{"type":22,"value":120},"Notation",{"type":16,"tag":122,"props":123,"children":124},"ul",{},[125,131,136,141],{"type":16,"tag":126,"props":127,"children":128},"li",{},[129],{"type":22,"value":130},"X is the state of the system. This shall be obtained from the optimiztion problem",{"type":16,"tag":126,"props":132,"children":133},{},[134],{"type":22,"value":135},"X_ref is the reference state of the system or desired input state.",{"type":16,"tag":126,"props":137,"children":138},{},[139],{"type":22,"value":140},"U is the input control of the system. This is a solution obtained from the optimization problem.",{"type":16,"tag":126,"props":142,"children":143},{},[144],{"type":22,"value":145},"U_ref is the reference control of the system or desired input control.",{"type":16,"tag":66,"props":147,"children":149},{"id":148},"was-it-really-that-good",[150],{"type":22,"value":151},"Was it really that good ?",{"type":16,"tag":25,"props":153,"children":154},{},[155],{"type":22,"value":156},"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!.",{"type":16,"tag":158,"props":159,"children":164},"figure",{"className":160},[161,162,163],"mb-4","inline-block","max-w-sm",[165,167],{"type":22,"value":166},"\n  ",{"type":16,"tag":41,"props":168,"children":171},{"className":169,"src":170,"width":46,"height":47},[44],"/topics/nmpc/diff_mpc.png",[],{"type":16,"tag":55,"props":173,"children":175},{"className":174},[58,59,60,61],[176],{"type":22,"value":177},"\n    Plot of differential drive robot follow the circle trajectory !!!.\n",{"type":16,"tag":66,"props":179,"children":181},{"id":180},"how-to-implement-it-in-python",[182],{"type":22,"value":183},"How to implement it in Python?",{"type":16,"tag":25,"props":185,"children":186},{},[187,189,198,200],{"type":22,"value":188},"There are so many great way to implement this control everywhere with many mathematical optimization library!!!. But for the sake of god, I use Casadi and CVXPY which I think one of the most easy tool to use. I will draft some python code here, but I cannot include them all in this post. You can check it more on my github repository, I do open-source some of my work !!! ",{"type":16,"tag":190,"props":191,"children":195},"a",{"href":192,"rel":193},"https://github.com/SokhengDin/PathTracking",[194],"nofollow",[196],{"type":22,"value":197},"Github",{"type":22,"value":199},". ",{"type":16,"tag":88,"props":201,"children":202},{},[],{"type":16,"tag":25,"props":204,"children":205},{},[206,208],{"type":22,"value":207},"I recommend you guys to have your own virtual enviroment, so I would be easier to work with any other related project of control system. ",{"type":16,"tag":88,"props":209,"children":210},{},[],{"type":16,"tag":25,"props":212,"children":213},{},[214],{"type":22,"value":215},"Make sure that you have install",{"type":16,"tag":217,"props":218,"children":223},"code",{"className":219,"code":221,"language":222,"meta":7},[220],"language-bash","pip3 install casadi && pip3 install cvxpy\n","bash",[224],{"type":16,"tag":225,"props":226,"children":227},"pre",{},[228],{"type":16,"tag":217,"props":229,"children":230},{"__ignoreMap":7},[231],{"type":16,"tag":232,"props":233,"children":236},"span",{"class":234,"line":235},"line",1,[237,243,249,255,259,264,269,273,277,281,285],{"type":16,"tag":232,"props":238,"children":240},{"class":239},"ct-806137",[241],{"type":22,"value":242},"pip3",{"type":16,"tag":232,"props":244,"children":246},{"class":245},"ct-767297",[247],{"type":22,"value":248}," ",{"type":16,"tag":232,"props":250,"children":252},{"class":251},"ct-244866",[253],{"type":22,"value":254},"install",{"type":16,"tag":232,"props":256,"children":257},{"class":245},[258],{"type":22,"value":248},{"type":16,"tag":232,"props":260,"children":261},{"class":251},[262],{"type":22,"value":263},"casadi",{"type":16,"tag":232,"props":265,"children":266},{"class":245},[267],{"type":22,"value":268}," && ",{"type":16,"tag":232,"props":270,"children":271},{"class":239},[272],{"type":22,"value":242},{"type":16,"tag":232,"props":274,"children":275},{"class":245},[276],{"type":22,"value":248},{"type":16,"tag":232,"props":278,"children":279},{"class":251},[280],{"type":22,"value":254},{"type":16,"tag":232,"props":282,"children":283},{"class":245},[284],{"type":22,"value":248},{"type":16,"tag":232,"props":286,"children":287},{"class":251},[288],{"type":22,"value":289},"cvxpy",{"type":16,"tag":25,"props":291,"children":292},{},[293],{"type":22,"value":294},"It is a good idea to write your robot model as a class object in Python, because it can help handle the update state of your system. For me, I am gonna use Numpy for mathematical operation.",{"type":16,"tag":217,"props":296,"children":301},{"className":297,"code":299,"language":300,"meta":7},[298],"language-python","import numpy as np\n\nclass DifferentialDrive:\n\n    def forward_kinematic(self, yaw, v, omega):\n        vx = v * np.cos(yaw)\n        vy = v * np.sin(yaw)\n        vyaw = omega\n\n        return vx, vy, vyaw\n","python",[302],{"type":16,"tag":225,"props":303,"children":304},{},[305],{"type":16,"tag":217,"props":306,"children":307},{"__ignoreMap":7},[308,332,341,364,372,400,429,455,473,481],{"type":16,"tag":232,"props":309,"children":310},{"class":234,"line":235},[311,317,322,327],{"type":16,"tag":232,"props":312,"children":314},{"class":313},"ct-857441",[315],{"type":22,"value":316},"import",{"type":16,"tag":232,"props":318,"children":319},{"class":245},[320],{"type":22,"value":321}," numpy ",{"type":16,"tag":232,"props":323,"children":324},{"class":313},[325],{"type":22,"value":326},"as",{"type":16,"tag":232,"props":328,"children":329},{"class":245},[330],{"type":22,"value":331}," np\n",{"type":16,"tag":232,"props":333,"children":335},{"class":234,"line":334},2,[336],{"type":16,"tag":232,"props":337,"children":338},{},[339],{"type":22,"value":340},"\n",{"type":16,"tag":232,"props":342,"children":344},{"class":234,"line":343},3,[345,350,354,359],{"type":16,"tag":232,"props":346,"children":347},{"class":313},[348],{"type":22,"value":349},"class",{"type":16,"tag":232,"props":351,"children":352},{"class":245},[353],{"type":22,"value":248},{"type":16,"tag":232,"props":355,"children":356},{"class":239},[357],{"type":22,"value":358},"DifferentialDrive",{"type":16,"tag":232,"props":360,"children":361},{"class":245},[362],{"type":22,"value":363},":\n",{"type":16,"tag":232,"props":365,"children":367},{"class":234,"line":366},4,[368],{"type":16,"tag":232,"props":369,"children":370},{},[371],{"type":22,"value":340},{"type":16,"tag":232,"props":373,"children":375},{"class":234,"line":374},5,[376,381,386,390,395],{"type":16,"tag":232,"props":377,"children":378},{"class":245},[379],{"type":22,"value":380},"    ",{"type":16,"tag":232,"props":382,"children":383},{"class":313},[384],{"type":22,"value":385},"def",{"type":16,"tag":232,"props":387,"children":388},{"class":245},[389],{"type":22,"value":248},{"type":16,"tag":232,"props":391,"children":392},{"class":239},[393],{"type":22,"value":394},"forward_kinematic",{"type":16,"tag":232,"props":396,"children":397},{"class":245},[398],{"type":22,"value":399},"(self, yaw, v, omega):\n",{"type":16,"tag":232,"props":401,"children":403},{"class":234,"line":402},6,[404,409,414,419,424],{"type":16,"tag":232,"props":405,"children":406},{"class":245},[407],{"type":22,"value":408},"        vx ",{"type":16,"tag":232,"props":410,"children":411},{"class":313},[412],{"type":22,"value":413},"=",{"type":16,"tag":232,"props":415,"children":416},{"class":245},[417],{"type":22,"value":418}," v ",{"type":16,"tag":232,"props":420,"children":421},{"class":313},[422],{"type":22,"value":423},"*",{"type":16,"tag":232,"props":425,"children":426},{"class":245},[427],{"type":22,"value":428}," np.cos(yaw)\n",{"type":16,"tag":232,"props":430,"children":432},{"class":234,"line":431},7,[433,438,442,446,450],{"type":16,"tag":232,"props":434,"children":435},{"class":245},[436],{"type":22,"value":437},"        vy ",{"type":16,"tag":232,"props":439,"children":440},{"class":313},[441],{"type":22,"value":413},{"type":16,"tag":232,"props":443,"children":444},{"class":245},[445],{"type":22,"value":418},{"type":16,"tag":232,"props":447,"children":448},{"class":313},[449],{"type":22,"value":423},{"type":16,"tag":232,"props":451,"children":452},{"class":245},[453],{"type":22,"value":454}," np.sin(yaw)\n",{"type":16,"tag":232,"props":456,"children":458},{"class":234,"line":457},8,[459,464,468],{"type":16,"tag":232,"props":460,"children":461},{"class":245},[462],{"type":22,"value":463},"        vyaw ",{"type":16,"tag":232,"props":465,"children":466},{"class":313},[467],{"type":22,"value":413},{"type":16,"tag":232,"props":469,"children":470},{"class":245},[471],{"type":22,"value":472}," omega\n",{"type":16,"tag":232,"props":474,"children":476},{"class":234,"line":475},9,[477],{"type":16,"tag":232,"props":478,"children":479},{},[480],{"type":22,"value":340},{"type":16,"tag":232,"props":482,"children":484},{"class":234,"line":483},10,[485,490,495],{"type":16,"tag":232,"props":486,"children":487},{"class":245},[488],{"type":22,"value":489},"        ",{"type":16,"tag":232,"props":491,"children":492},{"class":313},[493],{"type":22,"value":494},"return",{"type":16,"tag":232,"props":496,"children":497},{"class":245},[498],{"type":22,"value":499}," vx, vy, vyaw",{"type":16,"tag":25,"props":501,"children":502},{},[503,505,511],{"type":22,"value":504},"Next add this update state function into our ",{"type":16,"tag":506,"props":507,"children":508},"strong",{},[509],{"type":22,"value":510},"DifferentialDrive ",{"type":22,"value":512}," class, by doing this we would have all the attribute of our robot system.",{"type":16,"tag":217,"props":514,"children":517},{"className":515,"code":516,"language":300,"meta":7},[298],"def update_state(self, x0, y0, yaw0, yaw, v, omega):\n\n  dx, dy, dyaw = self.robot_model.forward_kinematic(yaw, v, omega)\n\n  x_next = x0 + dx*self.dtau\n  y_next = y0 + dy*self.dtau\n  yaw_next = yaw0 + dyaw*self.dtau\n\n  return x_next, y_next, yaw_next\n",[518],{"type":16,"tag":225,"props":519,"children":520},{},[521],{"type":16,"tag":217,"props":522,"children":523},{"__ignoreMap":7},[524,545,552,579,586,626,664,702,709],{"type":16,"tag":232,"props":525,"children":526},{"class":234,"line":235},[527,531,535,540],{"type":16,"tag":232,"props":528,"children":529},{"class":313},[530],{"type":22,"value":385},{"type":16,"tag":232,"props":532,"children":533},{"class":245},[534],{"type":22,"value":248},{"type":16,"tag":232,"props":536,"children":537},{"class":239},[538],{"type":22,"value":539},"update_state",{"type":16,"tag":232,"props":541,"children":542},{"class":245},[543],{"type":22,"value":544},"(self, x0, y0, yaw0, yaw, v, omega):\n",{"type":16,"tag":232,"props":546,"children":547},{"class":234,"line":334},[548],{"type":16,"tag":232,"props":549,"children":550},{},[551],{"type":22,"value":340},{"type":16,"tag":232,"props":553,"children":554},{"class":234,"line":343},[555,560,564,568,574],{"type":16,"tag":232,"props":556,"children":557},{"class":245},[558],{"type":22,"value":559},"  dx, dy, dyaw ",{"type":16,"tag":232,"props":561,"children":562},{"class":313},[563],{"type":22,"value":413},{"type":16,"tag":232,"props":565,"children":566},{"class":245},[567],{"type":22,"value":248},{"type":16,"tag":232,"props":569,"children":571},{"class":570},"ct-533739",[572],{"type":22,"value":573},"self",{"type":16,"tag":232,"props":575,"children":576},{"class":245},[577],{"type":22,"value":578},".robot_model.forward_kinematic(yaw, v, omega)\n",{"type":16,"tag":232,"props":580,"children":581},{"class":234,"line":366},[582],{"type":16,"tag":232,"props":583,"children":584},{},[585],{"type":22,"value":340},{"type":16,"tag":232,"props":587,"children":588},{"class":234,"line":374},[589,594,598,603,608,613,617,621],{"type":16,"tag":232,"props":590,"children":591},{"class":245},[592],{"type":22,"value":593},"  x_next ",{"type":16,"tag":232,"props":595,"children":596},{"class":313},[597],{"type":22,"value":413},{"type":16,"tag":232,"props":599,"children":600},{"class":245},[601],{"type":22,"value":602}," x0 ",{"type":16,"tag":232,"props":604,"children":605},{"class":313},[606],{"type":22,"value":607},"+",{"type":16,"tag":232,"props":609,"children":610},{"class":245},[611],{"type":22,"value":612}," dx",{"type":16,"tag":232,"props":614,"children":615},{"class":313},[616],{"type":22,"value":423},{"type":16,"tag":232,"props":618,"children":619},{"class":570},[620],{"type":22,"value":573},{"type":16,"tag":232,"props":622,"children":623},{"class":245},[624],{"type":22,"value":625},".dtau\n",{"type":16,"tag":232,"props":627,"children":628},{"class":234,"line":402},[629,634,638,643,647,652,656,660],{"type":16,"tag":232,"props":630,"children":631},{"class":245},[632],{"type":22,"value":633},"  y_next ",{"type":16,"tag":232,"props":635,"children":636},{"class":313},[637],{"type":22,"value":413},{"type":16,"tag":232,"props":639,"children":640},{"class":245},[641],{"type":22,"value":642}," y0 ",{"type":16,"tag":232,"props":644,"children":645},{"class":313},[646],{"type":22,"value":607},{"type":16,"tag":232,"props":648,"children":649},{"class":245},[650],{"type":22,"value":651}," dy",{"type":16,"tag":232,"props":653,"children":654},{"class":313},[655],{"type":22,"value":423},{"type":16,"tag":232,"props":657,"children":658},{"class":570},[659],{"type":22,"value":573},{"type":16,"tag":232,"props":661,"children":662},{"class":245},[663],{"type":22,"value":625},{"type":16,"tag":232,"props":665,"children":666},{"class":234,"line":431},[667,672,676,681,685,690,694,698],{"type":16,"tag":232,"props":668,"children":669},{"class":245},[670],{"type":22,"value":671},"  yaw_next ",{"type":16,"tag":232,"props":673,"children":674},{"class":313},[675],{"type":22,"value":413},{"type":16,"tag":232,"props":677,"children":678},{"class":245},[679],{"type":22,"value":680}," yaw0 ",{"type":16,"tag":232,"props":682,"children":683},{"class":313},[684],{"type":22,"value":607},{"type":16,"tag":232,"props":686,"children":687},{"class":245},[688],{"type":22,"value":689}," dyaw",{"type":16,"tag":232,"props":691,"children":692},{"class":313},[693],{"type":22,"value":423},{"type":16,"tag":232,"props":695,"children":696},{"class":570},[697],{"type":22,"value":573},{"type":16,"tag":232,"props":699,"children":700},{"class":245},[701],{"type":22,"value":625},{"type":16,"tag":232,"props":703,"children":704},{"class":234,"line":457},[705],{"type":16,"tag":232,"props":706,"children":707},{},[708],{"type":22,"value":340},{"type":16,"tag":232,"props":710,"children":711},{"class":234,"line":475},[712,717,721],{"type":16,"tag":232,"props":713,"children":714},{"class":245},[715],{"type":22,"value":716},"  ",{"type":16,"tag":232,"props":718,"children":719},{"class":313},[720],{"type":22,"value":494},{"type":16,"tag":232,"props":722,"children":723},{"class":245},[724],{"type":22,"value":725}," x_next, y_next, yaw_next",{"type":16,"tag":25,"props":727,"children":728},{},[729,731,734],{"type":22,"value":730},"How to define the quadratic cost in Python with CVXPY ? and set the constraint for your system ? ",{"type":16,"tag":88,"props":732,"children":733},{},[],{"type":22,"value":735},"\nHere, how you would write it.",{"type":16,"tag":217,"props":737,"children":740},{"className":738,"code":739,"language":300,"meta":7},[298],"for t in range(T):\n    cost += cvxpy.quad_form(u[:, t], R)\n\n    if t != 0:\n        cost += cvxpy.quad_form(x_ref[:, t] - x[:, t], Q)\n\n    A, B, C = get_linear_model_matrix(x_ref, u_ref)\n    constraints += [x[:, t + 1] == A @ x[:, t] + B @ u[:, t] + C]\n\n    if t \u003C (T - 1):\n        cost += cvxpy.quad_form(u[:, t + 1] - u[:, t], Rd)\n        constraints += [cvxpy.abs(u[1, t + 1] - u[1, t]) \u003C= DESIRED_CONTROL]\n\ncost += cvxpy.quad_form(xref[:, T] - x[:, T], Q)\n",[741],{"type":16,"tag":225,"props":742,"children":743},{},[744],{"type":16,"tag":217,"props":745,"children":746},{"__ignoreMap":7},[747,779,797,804,838,865,872,889,971,978,1020,1062,1142,1150],{"type":16,"tag":232,"props":748,"children":749},{"class":234,"line":235},[750,755,760,765,769,774],{"type":16,"tag":232,"props":751,"children":752},{"class":313},[753],{"type":22,"value":754},"for",{"type":16,"tag":232,"props":756,"children":757},{"class":245},[758],{"type":22,"value":759}," t ",{"type":16,"tag":232,"props":761,"children":762},{"class":313},[763],{"type":22,"value":764},"in",{"type":16,"tag":232,"props":766,"children":767},{"class":245},[768],{"type":22,"value":248},{"type":16,"tag":232,"props":770,"children":771},{"class":570},[772],{"type":22,"value":773},"range",{"type":16,"tag":232,"props":775,"children":776},{"class":245},[777],{"type":22,"value":778},"(T):\n",{"type":16,"tag":232,"props":780,"children":781},{"class":234,"line":334},[782,787,792],{"type":16,"tag":232,"props":783,"children":784},{"class":245},[785],{"type":22,"value":786},"    cost ",{"type":16,"tag":232,"props":788,"children":789},{"class":313},[790],{"type":22,"value":791},"+=",{"type":16,"tag":232,"props":793,"children":794},{"class":245},[795],{"type":22,"value":796}," cvxpy.quad_form(u[:, t], R)\n",{"type":16,"tag":232,"props":798,"children":799},{"class":234,"line":343},[800],{"type":16,"tag":232,"props":801,"children":802},{},[803],{"type":22,"value":340},{"type":16,"tag":232,"props":805,"children":806},{"class":234,"line":366},[807,811,816,820,825,829,834],{"type":16,"tag":232,"props":808,"children":809},{"class":245},[810],{"type":22,"value":380},{"type":16,"tag":232,"props":812,"children":813},{"class":313},[814],{"type":22,"value":815},"if",{"type":16,"tag":232,"props":817,"children":818},{"class":245},[819],{"type":22,"value":759},{"type":16,"tag":232,"props":821,"children":822},{"class":313},[823],{"type":22,"value":824},"!=",{"type":16,"tag":232,"props":826,"children":827},{"class":245},[828],{"type":22,"value":248},{"type":16,"tag":232,"props":830,"children":831},{"class":570},[832],{"type":22,"value":833},"0",{"type":16,"tag":232,"props":835,"children":836},{"class":245},[837],{"type":22,"value":363},{"type":16,"tag":232,"props":839,"children":840},{"class":234,"line":374},[841,846,850,855,860],{"type":16,"tag":232,"props":842,"children":843},{"class":245},[844],{"type":22,"value":845},"        cost ",{"type":16,"tag":232,"props":847,"children":848},{"class":313},[849],{"type":22,"value":791},{"type":16,"tag":232,"props":851,"children":852},{"class":245},[853],{"type":22,"value":854}," cvxpy.quad_form(x_ref[:, t] ",{"type":16,"tag":232,"props":856,"children":857},{"class":313},[858],{"type":22,"value":859},"-",{"type":16,"tag":232,"props":861,"children":862},{"class":245},[863],{"type":22,"value":864}," x[:, t], Q)\n",{"type":16,"tag":232,"props":866,"children":867},{"class":234,"line":402},[868],{"type":16,"tag":232,"props":869,"children":870},{},[871],{"type":22,"value":340},{"type":16,"tag":232,"props":873,"children":874},{"class":234,"line":431},[875,880,884],{"type":16,"tag":232,"props":876,"children":877},{"class":245},[878],{"type":22,"value":879},"    A, B, C ",{"type":16,"tag":232,"props":881,"children":882},{"class":313},[883],{"type":22,"value":413},{"type":16,"tag":232,"props":885,"children":886},{"class":245},[887],{"type":22,"value":888}," get_linear_model_matrix(x_ref, u_ref)\n",{"type":16,"tag":232,"props":890,"children":891},{"class":234,"line":457},[892,897,901,906,910,914,919,924,929,934,939,944,948,953,957,962,966],{"type":16,"tag":232,"props":893,"children":894},{"class":245},[895],{"type":22,"value":896},"    constraints ",{"type":16,"tag":232,"props":898,"children":899},{"class":313},[900],{"type":22,"value":791},{"type":16,"tag":232,"props":902,"children":903},{"class":245},[904],{"type":22,"value":905}," [x[:, t ",{"type":16,"tag":232,"props":907,"children":908},{"class":313},[909],{"type":22,"value":607},{"type":16,"tag":232,"props":911,"children":912},{"class":245},[913],{"type":22,"value":248},{"type":16,"tag":232,"props":915,"children":916},{"class":570},[917],{"type":22,"value":918},"1",{"type":16,"tag":232,"props":920,"children":921},{"class":245},[922],{"type":22,"value":923},"] ",{"type":16,"tag":232,"props":925,"children":926},{"class":313},[927],{"type":22,"value":928},"==",{"type":16,"tag":232,"props":930,"children":931},{"class":245},[932],{"type":22,"value":933}," A ",{"type":16,"tag":232,"props":935,"children":936},{"class":313},[937],{"type":22,"value":938},"@",{"type":16,"tag":232,"props":940,"children":941},{"class":245},[942],{"type":22,"value":943}," x[:, t] ",{"type":16,"tag":232,"props":945,"children":946},{"class":313},[947],{"type":22,"value":607},{"type":16,"tag":232,"props":949,"children":950},{"class":245},[951],{"type":22,"value":952}," B ",{"type":16,"tag":232,"props":954,"children":955},{"class":313},[956],{"type":22,"value":938},{"type":16,"tag":232,"props":958,"children":959},{"class":245},[960],{"type":22,"value":961}," u[:, t] ",{"type":16,"tag":232,"props":963,"children":964},{"class":313},[965],{"type":22,"value":607},{"type":16,"tag":232,"props":967,"children":968},{"class":245},[969],{"type":22,"value":970}," C]\n",{"type":16,"tag":232,"props":972,"children":973},{"class":234,"line":475},[974],{"type":16,"tag":232,"props":975,"children":976},{},[977],{"type":22,"value":340},{"type":16,"tag":232,"props":979,"children":980},{"class":234,"line":483},[981,985,989,993,998,1003,1007,1011,1015],{"type":16,"tag":232,"props":982,"children":983},{"class":245},[984],{"type":22,"value":380},{"type":16,"tag":232,"props":986,"children":987},{"class":313},[988],{"type":22,"value":815},{"type":16,"tag":232,"props":990,"children":991},{"class":245},[992],{"type":22,"value":759},{"type":16,"tag":232,"props":994,"children":995},{"class":313},[996],{"type":22,"value":997},"\u003C",{"type":16,"tag":232,"props":999,"children":1000},{"class":245},[1001],{"type":22,"value":1002}," (T ",{"type":16,"tag":232,"props":1004,"children":1005},{"class":313},[1006],{"type":22,"value":859},{"type":16,"tag":232,"props":1008,"children":1009},{"class":245},[1010],{"type":22,"value":248},{"type":16,"tag":232,"props":1012,"children":1013},{"class":570},[1014],{"type":22,"value":918},{"type":16,"tag":232,"props":1016,"children":1017},{"class":245},[1018],{"type":22,"value":1019},"):\n",{"type":16,"tag":232,"props":1021,"children":1023},{"class":234,"line":1022},11,[1024,1028,1032,1037,1041,1045,1049,1053,1057],{"type":16,"tag":232,"props":1025,"children":1026},{"class":245},[1027],{"type":22,"value":845},{"type":16,"tag":232,"props":1029,"children":1030},{"class":313},[1031],{"type":22,"value":791},{"type":16,"tag":232,"props":1033,"children":1034},{"class":245},[1035],{"type":22,"value":1036}," cvxpy.quad_form(u[:, t ",{"type":16,"tag":232,"props":1038,"children":1039},{"class":313},[1040],{"type":22,"value":607},{"type":16,"tag":232,"props":1042,"children":1043},{"class":245},[1044],{"type":22,"value":248},{"type":16,"tag":232,"props":1046,"children":1047},{"class":570},[1048],{"type":22,"value":918},{"type":16,"tag":232,"props":1050,"children":1051},{"class":245},[1052],{"type":22,"value":923},{"type":16,"tag":232,"props":1054,"children":1055},{"class":313},[1056],{"type":22,"value":859},{"type":16,"tag":232,"props":1058,"children":1059},{"class":245},[1060],{"type":22,"value":1061}," u[:, t], Rd)\n",{"type":16,"tag":232,"props":1063,"children":1065},{"class":234,"line":1064},12,[1066,1071,1075,1080,1084,1089,1093,1097,1101,1105,1109,1114,1118,1123,1128,1132,1137],{"type":16,"tag":232,"props":1067,"children":1068},{"class":245},[1069],{"type":22,"value":1070},"        constraints ",{"type":16,"tag":232,"props":1072,"children":1073},{"class":313},[1074],{"type":22,"value":791},{"type":16,"tag":232,"props":1076,"children":1077},{"class":245},[1078],{"type":22,"value":1079}," [cvxpy.abs(u[",{"type":16,"tag":232,"props":1081,"children":1082},{"class":570},[1083],{"type":22,"value":918},{"type":16,"tag":232,"props":1085,"children":1086},{"class":245},[1087],{"type":22,"value":1088},", t ",{"type":16,"tag":232,"props":1090,"children":1091},{"class":313},[1092],{"type":22,"value":607},{"type":16,"tag":232,"props":1094,"children":1095},{"class":245},[1096],{"type":22,"value":248},{"type":16,"tag":232,"props":1098,"children":1099},{"class":570},[1100],{"type":22,"value":918},{"type":16,"tag":232,"props":1102,"children":1103},{"class":245},[1104],{"type":22,"value":923},{"type":16,"tag":232,"props":1106,"children":1107},{"class":313},[1108],{"type":22,"value":859},{"type":16,"tag":232,"props":1110,"children":1111},{"class":245},[1112],{"type":22,"value":1113}," u[",{"type":16,"tag":232,"props":1115,"children":1116},{"class":570},[1117],{"type":22,"value":918},{"type":16,"tag":232,"props":1119,"children":1120},{"class":245},[1121],{"type":22,"value":1122},", t]) ",{"type":16,"tag":232,"props":1124,"children":1125},{"class":313},[1126],{"type":22,"value":1127},"\u003C=",{"type":16,"tag":232,"props":1129,"children":1130},{"class":245},[1131],{"type":22,"value":248},{"type":16,"tag":232,"props":1133,"children":1134},{"class":570},[1135],{"type":22,"value":1136},"DESIRED_CONTROL",{"type":16,"tag":232,"props":1138,"children":1139},{"class":245},[1140],{"type":22,"value":1141},"]\n",{"type":16,"tag":232,"props":1143,"children":1145},{"class":234,"line":1144},13,[1146],{"type":16,"tag":232,"props":1147,"children":1148},{},[1149],{"type":22,"value":340},{"type":16,"tag":232,"props":1151,"children":1153},{"class":234,"line":1152},14,[1154,1159,1163,1168,1172],{"type":16,"tag":232,"props":1155,"children":1156},{"class":245},[1157],{"type":22,"value":1158},"cost ",{"type":16,"tag":232,"props":1160,"children":1161},{"class":313},[1162],{"type":22,"value":791},{"type":16,"tag":232,"props":1164,"children":1165},{"class":245},[1166],{"type":22,"value":1167}," cvxpy.quad_form(xref[:, T] ",{"type":16,"tag":232,"props":1169,"children":1170},{"class":313},[1171],{"type":22,"value":859},{"type":16,"tag":232,"props":1173,"children":1174},{"class":245},[1175],{"type":22,"value":1176}," x[:, T], Q)",{"type":16,"tag":25,"props":1178,"children":1179},{},[1180,1182,1187,1189,1192],{"type":22,"value":1181},"The function ",{"type":16,"tag":506,"props":1183,"children":1184},{},[1185],{"type":22,"value":1186}," get_linear_model_matrix ",{"type":22,"value":1188}," would return the linearized model as the shown as the formula above. ",{"type":16,"tag":88,"props":1190,"children":1191},{},[],{"type":22,"value":1193},"\nWe can set more constraint by adding",{"type":16,"tag":217,"props":1195,"children":1198},{"className":1196,"code":1197,"language":300,"meta":7},[298],"  constraints += [x[:, 0] == x0]\n  constraints += [x[2, :] \u003C= MAX_SPEED]\n  constraints += [x[2, :] >= MIN_SPEED]\n  constraints += [cvxpy.abs(u[0, :]) \u003C= MAX_ACCEL]\n  constraints += [cvxpy.abs(u[1, :]) \u003C= MAX_STEER]\n",[1199],{"type":16,"tag":225,"props":1200,"children":1201},{},[1202],{"type":16,"tag":217,"props":1203,"children":1204},{"__ignoreMap":7},[1205,1239,1282,1323,1364],{"type":16,"tag":232,"props":1206,"children":1207},{"class":234,"line":235},[1208,1213,1217,1222,1226,1230,1234],{"type":16,"tag":232,"props":1209,"children":1210},{"class":245},[1211],{"type":22,"value":1212},"  constraints ",{"type":16,"tag":232,"props":1214,"children":1215},{"class":313},[1216],{"type":22,"value":791},{"type":16,"tag":232,"props":1218,"children":1219},{"class":245},[1220],{"type":22,"value":1221}," [x[:, ",{"type":16,"tag":232,"props":1223,"children":1224},{"class":570},[1225],{"type":22,"value":833},{"type":16,"tag":232,"props":1227,"children":1228},{"class":245},[1229],{"type":22,"value":923},{"type":16,"tag":232,"props":1231,"children":1232},{"class":313},[1233],{"type":22,"value":928},{"type":16,"tag":232,"props":1235,"children":1236},{"class":245},[1237],{"type":22,"value":1238}," x0]\n",{"type":16,"tag":232,"props":1240,"children":1241},{"class":234,"line":334},[1242,1246,1250,1255,1260,1265,1269,1273,1278],{"type":16,"tag":232,"props":1243,"children":1244},{"class":245},[1245],{"type":22,"value":1212},{"type":16,"tag":232,"props":1247,"children":1248},{"class":313},[1249],{"type":22,"value":791},{"type":16,"tag":232,"props":1251,"children":1252},{"class":245},[1253],{"type":22,"value":1254}," [x[",{"type":16,"tag":232,"props":1256,"children":1257},{"class":570},[1258],{"type":22,"value":1259},"2",{"type":16,"tag":232,"props":1261,"children":1262},{"class":245},[1263],{"type":22,"value":1264},", :] ",{"type":16,"tag":232,"props":1266,"children":1267},{"class":313},[1268],{"type":22,"value":1127},{"type":16,"tag":232,"props":1270,"children":1271},{"class":245},[1272],{"type":22,"value":248},{"type":16,"tag":232,"props":1274,"children":1275},{"class":570},[1276],{"type":22,"value":1277},"MAX_SPEED",{"type":16,"tag":232,"props":1279,"children":1280},{"class":245},[1281],{"type":22,"value":1141},{"type":16,"tag":232,"props":1283,"children":1284},{"class":234,"line":343},[1285,1289,1293,1297,1301,1305,1310,1314,1319],{"type":16,"tag":232,"props":1286,"children":1287},{"class":245},[1288],{"type":22,"value":1212},{"type":16,"tag":232,"props":1290,"children":1291},{"class":313},[1292],{"type":22,"value":791},{"type":16,"tag":232,"props":1294,"children":1295},{"class":245},[1296],{"type":22,"value":1254},{"type":16,"tag":232,"props":1298,"children":1299},{"class":570},[1300],{"type":22,"value":1259},{"type":16,"tag":232,"props":1302,"children":1303},{"class":245},[1304],{"type":22,"value":1264},{"type":16,"tag":232,"props":1306,"children":1307},{"class":313},[1308],{"type":22,"value":1309},">=",{"type":16,"tag":232,"props":1311,"children":1312},{"class":245},[1313],{"type":22,"value":248},{"type":16,"tag":232,"props":1315,"children":1316},{"class":570},[1317],{"type":22,"value":1318},"MIN_SPEED",{"type":16,"tag":232,"props":1320,"children":1321},{"class":245},[1322],{"type":22,"value":1141},{"type":16,"tag":232,"props":1324,"children":1325},{"class":234,"line":366},[1326,1330,1334,1338,1342,1347,1351,1355,1360],{"type":16,"tag":232,"props":1327,"children":1328},{"class":245},[1329],{"type":22,"value":1212},{"type":16,"tag":232,"props":1331,"children":1332},{"class":313},[1333],{"type":22,"value":791},{"type":16,"tag":232,"props":1335,"children":1336},{"class":245},[1337],{"type":22,"value":1079},{"type":16,"tag":232,"props":1339,"children":1340},{"class":570},[1341],{"type":22,"value":833},{"type":16,"tag":232,"props":1343,"children":1344},{"class":245},[1345],{"type":22,"value":1346},", :]) ",{"type":16,"tag":232,"props":1348,"children":1349},{"class":313},[1350],{"type":22,"value":1127},{"type":16,"tag":232,"props":1352,"children":1353},{"class":245},[1354],{"type":22,"value":248},{"type":16,"tag":232,"props":1356,"children":1357},{"class":570},[1358],{"type":22,"value":1359},"MAX_ACCEL",{"type":16,"tag":232,"props":1361,"children":1362},{"class":245},[1363],{"type":22,"value":1141},{"type":16,"tag":232,"props":1365,"children":1366},{"class":234,"line":374},[1367,1371,1375,1379,1383,1387,1391,1395,1400],{"type":16,"tag":232,"props":1368,"children":1369},{"class":245},[1370],{"type":22,"value":1212},{"type":16,"tag":232,"props":1372,"children":1373},{"class":313},[1374],{"type":22,"value":791},{"type":16,"tag":232,"props":1376,"children":1377},{"class":245},[1378],{"type":22,"value":1079},{"type":16,"tag":232,"props":1380,"children":1381},{"class":570},[1382],{"type":22,"value":918},{"type":16,"tag":232,"props":1384,"children":1385},{"class":245},[1386],{"type":22,"value":1346},{"type":16,"tag":232,"props":1388,"children":1389},{"class":313},[1390],{"type":22,"value":1127},{"type":16,"tag":232,"props":1392,"children":1393},{"class":245},[1394],{"type":22,"value":248},{"type":16,"tag":232,"props":1396,"children":1397},{"class":570},[1398],{"type":22,"value":1399},"MAX_STEER",{"type":16,"tag":232,"props":1401,"children":1402},{"class":245},[1403],{"type":22,"value":1404},"]",{"type":16,"tag":25,"props":1406,"children":1407},{},[1408],{"type":22,"value":1409},"Finally, we define the optimizer for our system by",{"type":16,"tag":217,"props":1411,"children":1414},{"className":1412,"code":1413,"language":300,"meta":7},[298],"prob = cvxpy.Problem(cvxpy.Minimize(cost), constraints)\nprob.solve(solver=cvxpy.ECOS, verbose=False)\n",[1415],{"type":16,"tag":225,"props":1416,"children":1417},{},[1418],{"type":16,"tag":217,"props":1419,"children":1420},{"__ignoreMap":7},[1421,1438],{"type":16,"tag":232,"props":1422,"children":1423},{"class":234,"line":235},[1424,1429,1433],{"type":16,"tag":232,"props":1425,"children":1426},{"class":245},[1427],{"type":22,"value":1428},"prob ",{"type":16,"tag":232,"props":1430,"children":1431},{"class":313},[1432],{"type":22,"value":413},{"type":16,"tag":232,"props":1434,"children":1435},{"class":245},[1436],{"type":22,"value":1437}," cvxpy.Problem(cvxpy.Minimize(cost), constraints)\n",{"type":16,"tag":232,"props":1439,"children":1440},{"class":234,"line":334},[1441,1446,1452,1456,1461,1466,1471,1476,1480,1485],{"type":16,"tag":232,"props":1442,"children":1443},{"class":245},[1444],{"type":22,"value":1445},"prob.solve(",{"type":16,"tag":232,"props":1447,"children":1449},{"class":1448},"ct-657843",[1450],{"type":22,"value":1451},"solver",{"type":16,"tag":232,"props":1453,"children":1454},{"class":313},[1455],{"type":22,"value":413},{"type":16,"tag":232,"props":1457,"children":1458},{"class":245},[1459],{"type":22,"value":1460},"cvxpy.",{"type":16,"tag":232,"props":1462,"children":1463},{"class":570},[1464],{"type":22,"value":1465},"ECOS",{"type":16,"tag":232,"props":1467,"children":1468},{"class":245},[1469],{"type":22,"value":1470},", ",{"type":16,"tag":232,"props":1472,"children":1473},{"class":1448},[1474],{"type":22,"value":1475},"verbose",{"type":16,"tag":232,"props":1477,"children":1478},{"class":313},[1479],{"type":22,"value":413},{"type":16,"tag":232,"props":1481,"children":1482},{"class":570},[1483],{"type":22,"value":1484},"False",{"type":16,"tag":232,"props":1486,"children":1487},{"class":245},[1488],{"type":22,"value":1489},")",{"type":16,"tag":25,"props":1491,"children":1492},{},[1493,1495],{"type":22,"value":1494},"For more detail about using CVXPY, here is the link ",{"type":16,"tag":190,"props":1496,"children":1499},{"href":1497,"rel":1498},"https://www.cvxpy.org",[194],[1500],{"type":22,"value":1501},"CVXPY",{"type":16,"tag":66,"props":1503,"children":1505},{"id":1504},"in-conclusion",[1506],{"type":22,"value":1507},"In conclusion",{"type":16,"tag":25,"props":1509,"children":1510},{},[1511],{"type":22,"value":1512},"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too. Next post, I will explain about Nonlinear Model Predictive Control by using Casadi framework for mathematical optimization.",{"type":16,"tag":1514,"children":1515},"style",[1516],{"type":22,"value":1517},".ct-806137{color:#B392F0;}\n.ct-767297{color:#E1E4E8;}\n.ct-244866{color:#9ECBFF;}\n.ct-857441{color:#F97583;}\n.ct-533739{color:#79B8FF;}\n.ct-657843{color:#FFAB70;}",{"title":7,"searchDepth":334,"depth":334,"links":1519},[1520,1521,1522,1523,1524,1525],{"id":68,"depth":334,"text":71},{"id":11,"depth":334,"text":81},{"id":103,"depth":334,"text":106},{"id":148,"depth":334,"text":151},{"id":180,"depth":334,"text":183},{"id":1504,"depth":334,"text":1507},"markdown","content:topics:linear-mpc.md","content","topics/linear-mpc.md","md",1693413191130]