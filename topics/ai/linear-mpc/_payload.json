[{"data":1,"prerenderedAt":1575},["Reactive",2],{"content-/topics/ai/linear-mpc":3},{"_path":4,"_dir":5,"_draft":6,"_partial":6,"_locale":7,"_empty":6,"title":8,"description":9,"author":10,"slug":11,"tag":11,"img":12,"body":13,"_type":1570,"_id":1571,"_source":1572,"_file":1573,"_extension":1574},"/topics/ai/linear-mpc","ai",false,"","Linear Model Predictive Control","Introduction to Linear Model Predictive Control","Din Sokheng","linear-mpc","/topics/robotics/nmpc/predict_horizon.png",{"type":14,"children":15,"toc":1560},"root",[16,25,31,54,65,71,76,81,90,95,101,107,112,116,121,163,169,174,189,195,201,220,228,233,307,312,517,530,743,753,1194,1211,1422,1427,1507,1519,1525,1530,1536,1555],{"type":17,"tag":18,"props":19,"children":21},"element","h2",{"id":20},"what-is-model-predictive-control",[22],{"type":23,"value":24},"text","What is Model Predictive Control ?",{"type":17,"tag":26,"props":27,"children":28},"p",{},[29],{"type":23,"value":30},"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system.",{"type":17,"tag":32,"props":33,"children":40},"div",{"className":34},[35,36,37,38,39],"grid","grid-cols-2","space-x-10","justify-center","items-center",[41,49],{"type":17,"tag":42,"props":43,"children":48},"img",{"className":44,"src":12,"width":46,"height":47},[45],"mx-auto","600px","300px",[],{"type":17,"tag":42,"props":50,"children":53},{"className":51,"src":52,"width":46,"height":47},[45],"/topics/robotics/nmpc/set_points.png",[],{"type":17,"tag":55,"props":56,"children":62},"figcaption",{"className":57},[58,59,60,61],"text-center","text-sm","text-neutral-600","dark:text-neutral-400",[63],{"type":23,"value":64},"\n      A car with finite horizons prediction and set point prediction over finite horizons.\n",{"type":17,"tag":18,"props":66,"children":68},{"id":67},"how-it-works",[69],{"type":23,"value":70},"How it works ?",{"type":17,"tag":26,"props":72,"children":73},{},[74],{"type":23,"value":75},"It works by solving the cost function that is produced by the sum of quadratic costs. For example, imagine you are riding a bike, and you want to get an ice cream because it is summer, and it tastes good ðŸ˜†. So, to get the ice cream, you need to grab your bike and ride it to the mart to buy one. What does it take to get you from your home to the mart store? Of course, it must be the energy produced by your muscles to pedal the bike and move. Another way to think about it is the cost of how the system would react to the desired position or point that you want it to reach. MPC have two types, they are Linear MPC and Nonlinear MPC. In this blog, we will only talk about Linear MPC.",{"type":17,"tag":18,"props":77,"children":78},{"id":11},[79],{"type":23,"value":80},"Linear MPC",{"type":17,"tag":26,"props":82,"children":83},{},[84,86],{"type":23,"value":85},"Linear MPC or Linear Model Predictive Control is an optimal control method that use with the system that it behavors linearly. It means that we can easily control this system with lost cost computation of the optimization and also ensure the lower risk of the system too!. ",{"type":17,"tag":87,"props":88,"children":89},"br",{},[],{"type":17,"tag":26,"props":91,"children":92},{},[93],{"type":23,"value":94},"Here is the formulation of the linear discrete system.",{"type":17,"tag":96,"props":97,"children":100},"math-render",{":dist-cond":98,":latex-express":99,":styles":58},"true"," \\begin{equation*} X_{k+1}=AX_{k}+BU_{k} \\end{equation*}",[],{"type":17,"tag":18,"props":102,"children":104},{"id":103},"formulation",[105],{"type":23,"value":106},"Formulation",{"type":17,"tag":26,"props":108,"children":109},{},[110],{"type":23,"value":111},"As I mentioned, this is quadratic cost. It consists of summation of all the cost that was produced over the number of horizontal prediction.",{"type":17,"tag":96,"props":113,"children":115},{"latex-express":114,"styles":58},"J(x,u) = \\displaystyle\\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N}, U_{N})",[],{"type":17,"tag":26,"props":117,"children":118},{},[119],{"type":23,"value":120},"Notation",{"type":17,"tag":122,"props":123,"children":124},"ul",{},[125,136,145,154],{"type":17,"tag":126,"props":127,"children":128},"li",{},[129,134],{"type":17,"tag":96,"props":130,"children":133},{"latex-express":131,"styles":132},"X","inline-flex space-x-3",[],{"type":23,"value":135}," is the state of the system. This shall be obtained from the optimiztion problem",{"type":17,"tag":126,"props":137,"children":138},{},[139,143],{"type":17,"tag":96,"props":140,"children":142},{"latex-express":141,"styles":132},"X_{ref}",[],{"type":23,"value":144}," is the reference state of the system or desired input state.",{"type":17,"tag":126,"props":146,"children":147},{},[148,152],{"type":17,"tag":96,"props":149,"children":151},{"latex-express":150,"styles":132},"U",[],{"type":23,"value":153}," is the input control of the system. This is a solution obtained from the optimization problem.",{"type":17,"tag":126,"props":155,"children":156},{},[157,161],{"type":17,"tag":96,"props":158,"children":160},{"latex-express":159,"styles":132},"U_{ref}",[],{"type":23,"value":162}," is the reference control of the system or desired input control.",{"type":17,"tag":18,"props":164,"children":166},{"id":165},"was-it-really-that-good",[167],{"type":23,"value":168},"Was it really that good ?",{"type":17,"tag":26,"props":170,"children":171},{},[172],{"type":23,"value":173},"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!.",{"type":17,"tag":175,"props":176,"children":181},"figure",{"className":177},[178,179,180],"mb-4","inline-block","max-w-sm",[182,184],{"type":23,"value":183},"\n  ",{"type":17,"tag":42,"props":185,"children":188},{"className":186,"src":187,"width":46,"height":47},[45],"/topics/robotics/nmpc/diff_mpc.png",[],{"type":17,"tag":55,"props":190,"children":192},{"className":191},[58,59,60,61],[193],{"type":23,"value":194},"\n    Plot of differential drive robot follow the circle trajectory !!!.\n",{"type":17,"tag":18,"props":196,"children":198},{"id":197},"how-to-implement-it-in-python",[199],{"type":23,"value":200},"How to implement it in Python?",{"type":17,"tag":26,"props":202,"children":203},{},[204,206,215,217],{"type":23,"value":205},"There are so many great way to implement this control everywhere with many mathematical optimization library!!!. But for the sake of god, I use Casadi and CVXPY which I think one of the most easy tool to use. I will draft some python code here, but I cannot include them all in this post. You can check it more on my github repository, I do open-source some of my work !!! ",{"type":17,"tag":207,"props":208,"children":212},"a",{"href":209,"rel":210},"https://github.com/SokhengDin/PathTracking",[211],"nofollow",[213],{"type":23,"value":214},"Github",{"type":23,"value":216},". ",{"type":17,"tag":87,"props":218,"children":219},{},[],{"type":17,"tag":26,"props":221,"children":222},{},[223,225],{"type":23,"value":224},"I recommend you guys to have your own virtual enviroment, so I would be easier to work with any other related project of control system. ",{"type":17,"tag":87,"props":226,"children":227},{},[],{"type":17,"tag":26,"props":229,"children":230},{},[231],{"type":23,"value":232},"Make sure that you have install.",{"type":17,"tag":234,"props":235,"children":240},"code",{"className":236,"code":238,"language":239,"meta":7},[237],"language-bash","pip3 install casadi && pip3 install cvxpy\n","bash",[241],{"type":17,"tag":242,"props":243,"children":244},"pre",{},[245],{"type":17,"tag":234,"props":246,"children":247},{"__ignoreMap":7},[248],{"type":17,"tag":249,"props":250,"children":253},"span",{"class":251,"line":252},"line",1,[254,260,266,272,276,281,286,290,294,298,302],{"type":17,"tag":249,"props":255,"children":257},{"class":256},"ct-806137",[258],{"type":23,"value":259},"pip3",{"type":17,"tag":249,"props":261,"children":263},{"class":262},"ct-767297",[264],{"type":23,"value":265}," ",{"type":17,"tag":249,"props":267,"children":269},{"class":268},"ct-244866",[270],{"type":23,"value":271},"install",{"type":17,"tag":249,"props":273,"children":274},{"class":262},[275],{"type":23,"value":265},{"type":17,"tag":249,"props":277,"children":278},{"class":268},[279],{"type":23,"value":280},"casadi",{"type":17,"tag":249,"props":282,"children":283},{"class":262},[284],{"type":23,"value":285}," && ",{"type":17,"tag":249,"props":287,"children":288},{"class":256},[289],{"type":23,"value":259},{"type":17,"tag":249,"props":291,"children":292},{"class":262},[293],{"type":23,"value":265},{"type":17,"tag":249,"props":295,"children":296},{"class":268},[297],{"type":23,"value":271},{"type":17,"tag":249,"props":299,"children":300},{"class":262},[301],{"type":23,"value":265},{"type":17,"tag":249,"props":303,"children":304},{"class":268},[305],{"type":23,"value":306},"cvxpy",{"type":17,"tag":26,"props":308,"children":309},{},[310],{"type":23,"value":311},"It is a good idea to write your robot model as a class object in Python, because it can help handle the update state of your system. For me, I am gonna use Numpy for mathematical operation.",{"type":17,"tag":234,"props":313,"children":318},{"className":314,"code":316,"language":317,"meta":7},[315],"language-python","import numpy as np\n\nclass DifferentialDrive:\n\n    def forward_kinematic(self, yaw, v, omega):\n        vx = v * np.cos(yaw)\n        vy = v * np.sin(yaw)\n        vyaw = omega\n\n        return vx, vy, vyaw\n","python",[319],{"type":17,"tag":242,"props":320,"children":321},{},[322],{"type":17,"tag":234,"props":323,"children":324},{"__ignoreMap":7},[325,349,358,381,389,417,446,472,490,498],{"type":17,"tag":249,"props":326,"children":327},{"class":251,"line":252},[328,334,339,344],{"type":17,"tag":249,"props":329,"children":331},{"class":330},"ct-857441",[332],{"type":23,"value":333},"import",{"type":17,"tag":249,"props":335,"children":336},{"class":262},[337],{"type":23,"value":338}," numpy ",{"type":17,"tag":249,"props":340,"children":341},{"class":330},[342],{"type":23,"value":343},"as",{"type":17,"tag":249,"props":345,"children":346},{"class":262},[347],{"type":23,"value":348}," np\n",{"type":17,"tag":249,"props":350,"children":352},{"class":251,"line":351},2,[353],{"type":17,"tag":249,"props":354,"children":355},{},[356],{"type":23,"value":357},"\n",{"type":17,"tag":249,"props":359,"children":361},{"class":251,"line":360},3,[362,367,371,376],{"type":17,"tag":249,"props":363,"children":364},{"class":330},[365],{"type":23,"value":366},"class",{"type":17,"tag":249,"props":368,"children":369},{"class":262},[370],{"type":23,"value":265},{"type":17,"tag":249,"props":372,"children":373},{"class":256},[374],{"type":23,"value":375},"DifferentialDrive",{"type":17,"tag":249,"props":377,"children":378},{"class":262},[379],{"type":23,"value":380},":\n",{"type":17,"tag":249,"props":382,"children":384},{"class":251,"line":383},4,[385],{"type":17,"tag":249,"props":386,"children":387},{},[388],{"type":23,"value":357},{"type":17,"tag":249,"props":390,"children":392},{"class":251,"line":391},5,[393,398,403,407,412],{"type":17,"tag":249,"props":394,"children":395},{"class":262},[396],{"type":23,"value":397},"    ",{"type":17,"tag":249,"props":399,"children":400},{"class":330},[401],{"type":23,"value":402},"def",{"type":17,"tag":249,"props":404,"children":405},{"class":262},[406],{"type":23,"value":265},{"type":17,"tag":249,"props":408,"children":409},{"class":256},[410],{"type":23,"value":411},"forward_kinematic",{"type":17,"tag":249,"props":413,"children":414},{"class":262},[415],{"type":23,"value":416},"(self, yaw, v, omega):\n",{"type":17,"tag":249,"props":418,"children":420},{"class":251,"line":419},6,[421,426,431,436,441],{"type":17,"tag":249,"props":422,"children":423},{"class":262},[424],{"type":23,"value":425},"        vx ",{"type":17,"tag":249,"props":427,"children":428},{"class":330},[429],{"type":23,"value":430},"=",{"type":17,"tag":249,"props":432,"children":433},{"class":262},[434],{"type":23,"value":435}," v ",{"type":17,"tag":249,"props":437,"children":438},{"class":330},[439],{"type":23,"value":440},"*",{"type":17,"tag":249,"props":442,"children":443},{"class":262},[444],{"type":23,"value":445}," np.cos(yaw)\n",{"type":17,"tag":249,"props":447,"children":449},{"class":251,"line":448},7,[450,455,459,463,467],{"type":17,"tag":249,"props":451,"children":452},{"class":262},[453],{"type":23,"value":454},"        vy ",{"type":17,"tag":249,"props":456,"children":457},{"class":330},[458],{"type":23,"value":430},{"type":17,"tag":249,"props":460,"children":461},{"class":262},[462],{"type":23,"value":435},{"type":17,"tag":249,"props":464,"children":465},{"class":330},[466],{"type":23,"value":440},{"type":17,"tag":249,"props":468,"children":469},{"class":262},[470],{"type":23,"value":471}," np.sin(yaw)\n",{"type":17,"tag":249,"props":473,"children":475},{"class":251,"line":474},8,[476,481,485],{"type":17,"tag":249,"props":477,"children":478},{"class":262},[479],{"type":23,"value":480},"        vyaw ",{"type":17,"tag":249,"props":482,"children":483},{"class":330},[484],{"type":23,"value":430},{"type":17,"tag":249,"props":486,"children":487},{"class":262},[488],{"type":23,"value":489}," omega\n",{"type":17,"tag":249,"props":491,"children":493},{"class":251,"line":492},9,[494],{"type":17,"tag":249,"props":495,"children":496},{},[497],{"type":23,"value":357},{"type":17,"tag":249,"props":499,"children":501},{"class":251,"line":500},10,[502,507,512],{"type":17,"tag":249,"props":503,"children":504},{"class":262},[505],{"type":23,"value":506},"        ",{"type":17,"tag":249,"props":508,"children":509},{"class":330},[510],{"type":23,"value":511},"return",{"type":17,"tag":249,"props":513,"children":514},{"class":262},[515],{"type":23,"value":516}," vx, vy, vyaw",{"type":17,"tag":26,"props":518,"children":519},{},[520,522,528],{"type":23,"value":521},"Next add this update state function into our ",{"type":17,"tag":523,"props":524,"children":525},"strong",{},[526],{"type":23,"value":527},"DifferentialDrive ",{"type":23,"value":529}," class, by doing this we would have all the attribute of our robot system.",{"type":17,"tag":234,"props":531,"children":534},{"className":532,"code":533,"language":317,"meta":7},[315],"def update_state(self, x0, y0, yaw0, yaw, v, omega):\n\n  dx, dy, dyaw = self.robot_model.forward_kinematic(yaw, v, omega)\n\n  x_next = x0 + dx*self.dtau\n  y_next = y0 + dy*self.dtau\n  yaw_next = yaw0 + dyaw*self.dtau\n\n  return x_next, y_next, yaw_next\n",[535],{"type":17,"tag":242,"props":536,"children":537},{},[538],{"type":17,"tag":234,"props":539,"children":540},{"__ignoreMap":7},[541,562,569,596,603,643,681,719,726],{"type":17,"tag":249,"props":542,"children":543},{"class":251,"line":252},[544,548,552,557],{"type":17,"tag":249,"props":545,"children":546},{"class":330},[547],{"type":23,"value":402},{"type":17,"tag":249,"props":549,"children":550},{"class":262},[551],{"type":23,"value":265},{"type":17,"tag":249,"props":553,"children":554},{"class":256},[555],{"type":23,"value":556},"update_state",{"type":17,"tag":249,"props":558,"children":559},{"class":262},[560],{"type":23,"value":561},"(self, x0, y0, yaw0, yaw, v, omega):\n",{"type":17,"tag":249,"props":563,"children":564},{"class":251,"line":351},[565],{"type":17,"tag":249,"props":566,"children":567},{},[568],{"type":23,"value":357},{"type":17,"tag":249,"props":570,"children":571},{"class":251,"line":360},[572,577,581,585,591],{"type":17,"tag":249,"props":573,"children":574},{"class":262},[575],{"type":23,"value":576},"  dx, dy, dyaw ",{"type":17,"tag":249,"props":578,"children":579},{"class":330},[580],{"type":23,"value":430},{"type":17,"tag":249,"props":582,"children":583},{"class":262},[584],{"type":23,"value":265},{"type":17,"tag":249,"props":586,"children":588},{"class":587},"ct-533739",[589],{"type":23,"value":590},"self",{"type":17,"tag":249,"props":592,"children":593},{"class":262},[594],{"type":23,"value":595},".robot_model.forward_kinematic(yaw, v, omega)\n",{"type":17,"tag":249,"props":597,"children":598},{"class":251,"line":383},[599],{"type":17,"tag":249,"props":600,"children":601},{},[602],{"type":23,"value":357},{"type":17,"tag":249,"props":604,"children":605},{"class":251,"line":391},[606,611,615,620,625,630,634,638],{"type":17,"tag":249,"props":607,"children":608},{"class":262},[609],{"type":23,"value":610},"  x_next ",{"type":17,"tag":249,"props":612,"children":613},{"class":330},[614],{"type":23,"value":430},{"type":17,"tag":249,"props":616,"children":617},{"class":262},[618],{"type":23,"value":619}," x0 ",{"type":17,"tag":249,"props":621,"children":622},{"class":330},[623],{"type":23,"value":624},"+",{"type":17,"tag":249,"props":626,"children":627},{"class":262},[628],{"type":23,"value":629}," dx",{"type":17,"tag":249,"props":631,"children":632},{"class":330},[633],{"type":23,"value":440},{"type":17,"tag":249,"props":635,"children":636},{"class":587},[637],{"type":23,"value":590},{"type":17,"tag":249,"props":639,"children":640},{"class":262},[641],{"type":23,"value":642},".dtau\n",{"type":17,"tag":249,"props":644,"children":645},{"class":251,"line":419},[646,651,655,660,664,669,673,677],{"type":17,"tag":249,"props":647,"children":648},{"class":262},[649],{"type":23,"value":650},"  y_next ",{"type":17,"tag":249,"props":652,"children":653},{"class":330},[654],{"type":23,"value":430},{"type":17,"tag":249,"props":656,"children":657},{"class":262},[658],{"type":23,"value":659}," y0 ",{"type":17,"tag":249,"props":661,"children":662},{"class":330},[663],{"type":23,"value":624},{"type":17,"tag":249,"props":665,"children":666},{"class":262},[667],{"type":23,"value":668}," dy",{"type":17,"tag":249,"props":670,"children":671},{"class":330},[672],{"type":23,"value":440},{"type":17,"tag":249,"props":674,"children":675},{"class":587},[676],{"type":23,"value":590},{"type":17,"tag":249,"props":678,"children":679},{"class":262},[680],{"type":23,"value":642},{"type":17,"tag":249,"props":682,"children":683},{"class":251,"line":448},[684,689,693,698,702,707,711,715],{"type":17,"tag":249,"props":685,"children":686},{"class":262},[687],{"type":23,"value":688},"  yaw_next ",{"type":17,"tag":249,"props":690,"children":691},{"class":330},[692],{"type":23,"value":430},{"type":17,"tag":249,"props":694,"children":695},{"class":262},[696],{"type":23,"value":697}," yaw0 ",{"type":17,"tag":249,"props":699,"children":700},{"class":330},[701],{"type":23,"value":624},{"type":17,"tag":249,"props":703,"children":704},{"class":262},[705],{"type":23,"value":706}," dyaw",{"type":17,"tag":249,"props":708,"children":709},{"class":330},[710],{"type":23,"value":440},{"type":17,"tag":249,"props":712,"children":713},{"class":587},[714],{"type":23,"value":590},{"type":17,"tag":249,"props":716,"children":717},{"class":262},[718],{"type":23,"value":642},{"type":17,"tag":249,"props":720,"children":721},{"class":251,"line":474},[722],{"type":17,"tag":249,"props":723,"children":724},{},[725],{"type":23,"value":357},{"type":17,"tag":249,"props":727,"children":728},{"class":251,"line":492},[729,734,738],{"type":17,"tag":249,"props":730,"children":731},{"class":262},[732],{"type":23,"value":733},"  ",{"type":17,"tag":249,"props":735,"children":736},{"class":330},[737],{"type":23,"value":511},{"type":17,"tag":249,"props":739,"children":740},{"class":262},[741],{"type":23,"value":742}," x_next, y_next, yaw_next",{"type":17,"tag":26,"props":744,"children":745},{},[746,748,751],{"type":23,"value":747},"How to define the quadratic cost in Python with CVXPY ? and set the constraint for your system ? ",{"type":17,"tag":87,"props":749,"children":750},{},[],{"type":23,"value":752},"\nHere, how you would write it.",{"type":17,"tag":234,"props":754,"children":757},{"className":755,"code":756,"language":317,"meta":7},[315],"for t in range(T):\n    cost += cvxpy.quad_form(u[:, t], R)\n\n    if t != 0:\n        cost += cvxpy.quad_form(x_ref[:, t] - x[:, t], Q)\n\n    A, B, C = get_linear_model_matrix(x_ref, u_ref)\n    constraints += [x[:, t + 1] == A @ x[:, t] + B @ u[:, t] + C]\n\n    if t \u003C (T - 1):\n        cost += cvxpy.quad_form(u[:, t + 1] - u[:, t], Rd)\n        constraints += [cvxpy.abs(u[1, t + 1] - u[1, t]) \u003C= DESIRED_CONTROL]\n\ncost += cvxpy.quad_form(xref[:, T] - x[:, T], Q)\n",[758],{"type":17,"tag":242,"props":759,"children":760},{},[761],{"type":17,"tag":234,"props":762,"children":763},{"__ignoreMap":7},[764,796,814,821,855,882,889,906,988,995,1037,1079,1159,1167],{"type":17,"tag":249,"props":765,"children":766},{"class":251,"line":252},[767,772,777,782,786,791],{"type":17,"tag":249,"props":768,"children":769},{"class":330},[770],{"type":23,"value":771},"for",{"type":17,"tag":249,"props":773,"children":774},{"class":262},[775],{"type":23,"value":776}," t ",{"type":17,"tag":249,"props":778,"children":779},{"class":330},[780],{"type":23,"value":781},"in",{"type":17,"tag":249,"props":783,"children":784},{"class":262},[785],{"type":23,"value":265},{"type":17,"tag":249,"props":787,"children":788},{"class":587},[789],{"type":23,"value":790},"range",{"type":17,"tag":249,"props":792,"children":793},{"class":262},[794],{"type":23,"value":795},"(T):\n",{"type":17,"tag":249,"props":797,"children":798},{"class":251,"line":351},[799,804,809],{"type":17,"tag":249,"props":800,"children":801},{"class":262},[802],{"type":23,"value":803},"    cost ",{"type":17,"tag":249,"props":805,"children":806},{"class":330},[807],{"type":23,"value":808},"+=",{"type":17,"tag":249,"props":810,"children":811},{"class":262},[812],{"type":23,"value":813}," cvxpy.quad_form(u[:, t], R)\n",{"type":17,"tag":249,"props":815,"children":816},{"class":251,"line":360},[817],{"type":17,"tag":249,"props":818,"children":819},{},[820],{"type":23,"value":357},{"type":17,"tag":249,"props":822,"children":823},{"class":251,"line":383},[824,828,833,837,842,846,851],{"type":17,"tag":249,"props":825,"children":826},{"class":262},[827],{"type":23,"value":397},{"type":17,"tag":249,"props":829,"children":830},{"class":330},[831],{"type":23,"value":832},"if",{"type":17,"tag":249,"props":834,"children":835},{"class":262},[836],{"type":23,"value":776},{"type":17,"tag":249,"props":838,"children":839},{"class":330},[840],{"type":23,"value":841},"!=",{"type":17,"tag":249,"props":843,"children":844},{"class":262},[845],{"type":23,"value":265},{"type":17,"tag":249,"props":847,"children":848},{"class":587},[849],{"type":23,"value":850},"0",{"type":17,"tag":249,"props":852,"children":853},{"class":262},[854],{"type":23,"value":380},{"type":17,"tag":249,"props":856,"children":857},{"class":251,"line":391},[858,863,867,872,877],{"type":17,"tag":249,"props":859,"children":860},{"class":262},[861],{"type":23,"value":862},"        cost ",{"type":17,"tag":249,"props":864,"children":865},{"class":330},[866],{"type":23,"value":808},{"type":17,"tag":249,"props":868,"children":869},{"class":262},[870],{"type":23,"value":871}," cvxpy.quad_form(x_ref[:, t] ",{"type":17,"tag":249,"props":873,"children":874},{"class":330},[875],{"type":23,"value":876},"-",{"type":17,"tag":249,"props":878,"children":879},{"class":262},[880],{"type":23,"value":881}," x[:, t], Q)\n",{"type":17,"tag":249,"props":883,"children":884},{"class":251,"line":419},[885],{"type":17,"tag":249,"props":886,"children":887},{},[888],{"type":23,"value":357},{"type":17,"tag":249,"props":890,"children":891},{"class":251,"line":448},[892,897,901],{"type":17,"tag":249,"props":893,"children":894},{"class":262},[895],{"type":23,"value":896},"    A, B, C ",{"type":17,"tag":249,"props":898,"children":899},{"class":330},[900],{"type":23,"value":430},{"type":17,"tag":249,"props":902,"children":903},{"class":262},[904],{"type":23,"value":905}," get_linear_model_matrix(x_ref, u_ref)\n",{"type":17,"tag":249,"props":907,"children":908},{"class":251,"line":474},[909,914,918,923,927,931,936,941,946,951,956,961,965,970,974,979,983],{"type":17,"tag":249,"props":910,"children":911},{"class":262},[912],{"type":23,"value":913},"    constraints ",{"type":17,"tag":249,"props":915,"children":916},{"class":330},[917],{"type":23,"value":808},{"type":17,"tag":249,"props":919,"children":920},{"class":262},[921],{"type":23,"value":922}," [x[:, t ",{"type":17,"tag":249,"props":924,"children":925},{"class":330},[926],{"type":23,"value":624},{"type":17,"tag":249,"props":928,"children":929},{"class":262},[930],{"type":23,"value":265},{"type":17,"tag":249,"props":932,"children":933},{"class":587},[934],{"type":23,"value":935},"1",{"type":17,"tag":249,"props":937,"children":938},{"class":262},[939],{"type":23,"value":940},"] ",{"type":17,"tag":249,"props":942,"children":943},{"class":330},[944],{"type":23,"value":945},"==",{"type":17,"tag":249,"props":947,"children":948},{"class":262},[949],{"type":23,"value":950}," A ",{"type":17,"tag":249,"props":952,"children":953},{"class":330},[954],{"type":23,"value":955},"@",{"type":17,"tag":249,"props":957,"children":958},{"class":262},[959],{"type":23,"value":960}," x[:, t] ",{"type":17,"tag":249,"props":962,"children":963},{"class":330},[964],{"type":23,"value":624},{"type":17,"tag":249,"props":966,"children":967},{"class":262},[968],{"type":23,"value":969}," B ",{"type":17,"tag":249,"props":971,"children":972},{"class":330},[973],{"type":23,"value":955},{"type":17,"tag":249,"props":975,"children":976},{"class":262},[977],{"type":23,"value":978}," u[:, t] ",{"type":17,"tag":249,"props":980,"children":981},{"class":330},[982],{"type":23,"value":624},{"type":17,"tag":249,"props":984,"children":985},{"class":262},[986],{"type":23,"value":987}," C]\n",{"type":17,"tag":249,"props":989,"children":990},{"class":251,"line":492},[991],{"type":17,"tag":249,"props":992,"children":993},{},[994],{"type":23,"value":357},{"type":17,"tag":249,"props":996,"children":997},{"class":251,"line":500},[998,1002,1006,1010,1015,1020,1024,1028,1032],{"type":17,"tag":249,"props":999,"children":1000},{"class":262},[1001],{"type":23,"value":397},{"type":17,"tag":249,"props":1003,"children":1004},{"class":330},[1005],{"type":23,"value":832},{"type":17,"tag":249,"props":1007,"children":1008},{"class":262},[1009],{"type":23,"value":776},{"type":17,"tag":249,"props":1011,"children":1012},{"class":330},[1013],{"type":23,"value":1014},"\u003C",{"type":17,"tag":249,"props":1016,"children":1017},{"class":262},[1018],{"type":23,"value":1019}," (T ",{"type":17,"tag":249,"props":1021,"children":1022},{"class":330},[1023],{"type":23,"value":876},{"type":17,"tag":249,"props":1025,"children":1026},{"class":262},[1027],{"type":23,"value":265},{"type":17,"tag":249,"props":1029,"children":1030},{"class":587},[1031],{"type":23,"value":935},{"type":17,"tag":249,"props":1033,"children":1034},{"class":262},[1035],{"type":23,"value":1036},"):\n",{"type":17,"tag":249,"props":1038,"children":1040},{"class":251,"line":1039},11,[1041,1045,1049,1054,1058,1062,1066,1070,1074],{"type":17,"tag":249,"props":1042,"children":1043},{"class":262},[1044],{"type":23,"value":862},{"type":17,"tag":249,"props":1046,"children":1047},{"class":330},[1048],{"type":23,"value":808},{"type":17,"tag":249,"props":1050,"children":1051},{"class":262},[1052],{"type":23,"value":1053}," cvxpy.quad_form(u[:, t ",{"type":17,"tag":249,"props":1055,"children":1056},{"class":330},[1057],{"type":23,"value":624},{"type":17,"tag":249,"props":1059,"children":1060},{"class":262},[1061],{"type":23,"value":265},{"type":17,"tag":249,"props":1063,"children":1064},{"class":587},[1065],{"type":23,"value":935},{"type":17,"tag":249,"props":1067,"children":1068},{"class":262},[1069],{"type":23,"value":940},{"type":17,"tag":249,"props":1071,"children":1072},{"class":330},[1073],{"type":23,"value":876},{"type":17,"tag":249,"props":1075,"children":1076},{"class":262},[1077],{"type":23,"value":1078}," u[:, t], Rd)\n",{"type":17,"tag":249,"props":1080,"children":1082},{"class":251,"line":1081},12,[1083,1088,1092,1097,1101,1106,1110,1114,1118,1122,1126,1131,1135,1140,1145,1149,1154],{"type":17,"tag":249,"props":1084,"children":1085},{"class":262},[1086],{"type":23,"value":1087},"        constraints ",{"type":17,"tag":249,"props":1089,"children":1090},{"class":330},[1091],{"type":23,"value":808},{"type":17,"tag":249,"props":1093,"children":1094},{"class":262},[1095],{"type":23,"value":1096}," [cvxpy.abs(u[",{"type":17,"tag":249,"props":1098,"children":1099},{"class":587},[1100],{"type":23,"value":935},{"type":17,"tag":249,"props":1102,"children":1103},{"class":262},[1104],{"type":23,"value":1105},", t ",{"type":17,"tag":249,"props":1107,"children":1108},{"class":330},[1109],{"type":23,"value":624},{"type":17,"tag":249,"props":1111,"children":1112},{"class":262},[1113],{"type":23,"value":265},{"type":17,"tag":249,"props":1115,"children":1116},{"class":587},[1117],{"type":23,"value":935},{"type":17,"tag":249,"props":1119,"children":1120},{"class":262},[1121],{"type":23,"value":940},{"type":17,"tag":249,"props":1123,"children":1124},{"class":330},[1125],{"type":23,"value":876},{"type":17,"tag":249,"props":1127,"children":1128},{"class":262},[1129],{"type":23,"value":1130}," u[",{"type":17,"tag":249,"props":1132,"children":1133},{"class":587},[1134],{"type":23,"value":935},{"type":17,"tag":249,"props":1136,"children":1137},{"class":262},[1138],{"type":23,"value":1139},", t]) ",{"type":17,"tag":249,"props":1141,"children":1142},{"class":330},[1143],{"type":23,"value":1144},"\u003C=",{"type":17,"tag":249,"props":1146,"children":1147},{"class":262},[1148],{"type":23,"value":265},{"type":17,"tag":249,"props":1150,"children":1151},{"class":587},[1152],{"type":23,"value":1153},"DESIRED_CONTROL",{"type":17,"tag":249,"props":1155,"children":1156},{"class":262},[1157],{"type":23,"value":1158},"]\n",{"type":17,"tag":249,"props":1160,"children":1162},{"class":251,"line":1161},13,[1163],{"type":17,"tag":249,"props":1164,"children":1165},{},[1166],{"type":23,"value":357},{"type":17,"tag":249,"props":1168,"children":1170},{"class":251,"line":1169},14,[1171,1176,1180,1185,1189],{"type":17,"tag":249,"props":1172,"children":1173},{"class":262},[1174],{"type":23,"value":1175},"cost ",{"type":17,"tag":249,"props":1177,"children":1178},{"class":330},[1179],{"type":23,"value":808},{"type":17,"tag":249,"props":1181,"children":1182},{"class":262},[1183],{"type":23,"value":1184}," cvxpy.quad_form(xref[:, T] ",{"type":17,"tag":249,"props":1186,"children":1187},{"class":330},[1188],{"type":23,"value":876},{"type":17,"tag":249,"props":1190,"children":1191},{"class":262},[1192],{"type":23,"value":1193}," x[:, T], Q)",{"type":17,"tag":26,"props":1195,"children":1196},{},[1197,1199,1204,1206,1209],{"type":23,"value":1198},"The function ",{"type":17,"tag":523,"props":1200,"children":1201},{},[1202],{"type":23,"value":1203}," get_linear_model_matrix ",{"type":23,"value":1205}," would return the linearized model as the shown as the formula above. ",{"type":17,"tag":87,"props":1207,"children":1208},{},[],{"type":23,"value":1210},"\nWe can set more constraint by adding",{"type":17,"tag":234,"props":1212,"children":1215},{"className":1213,"code":1214,"language":317,"meta":7},[315],"  constraints += [x[:, 0] == x0]\n  constraints += [x[2, :] \u003C= MAX_SPEED]\n  constraints += [x[2, :] >= MIN_SPEED]\n  constraints += [cvxpy.abs(u[0, :]) \u003C= MAX_ACCEL]\n  constraints += [cvxpy.abs(u[1, :]) \u003C= MAX_STEER]\n",[1216],{"type":17,"tag":242,"props":1217,"children":1218},{},[1219],{"type":17,"tag":234,"props":1220,"children":1221},{"__ignoreMap":7},[1222,1256,1299,1340,1381],{"type":17,"tag":249,"props":1223,"children":1224},{"class":251,"line":252},[1225,1230,1234,1239,1243,1247,1251],{"type":17,"tag":249,"props":1226,"children":1227},{"class":262},[1228],{"type":23,"value":1229},"  constraints ",{"type":17,"tag":249,"props":1231,"children":1232},{"class":330},[1233],{"type":23,"value":808},{"type":17,"tag":249,"props":1235,"children":1236},{"class":262},[1237],{"type":23,"value":1238}," [x[:, ",{"type":17,"tag":249,"props":1240,"children":1241},{"class":587},[1242],{"type":23,"value":850},{"type":17,"tag":249,"props":1244,"children":1245},{"class":262},[1246],{"type":23,"value":940},{"type":17,"tag":249,"props":1248,"children":1249},{"class":330},[1250],{"type":23,"value":945},{"type":17,"tag":249,"props":1252,"children":1253},{"class":262},[1254],{"type":23,"value":1255}," x0]\n",{"type":17,"tag":249,"props":1257,"children":1258},{"class":251,"line":351},[1259,1263,1267,1272,1277,1282,1286,1290,1295],{"type":17,"tag":249,"props":1260,"children":1261},{"class":262},[1262],{"type":23,"value":1229},{"type":17,"tag":249,"props":1264,"children":1265},{"class":330},[1266],{"type":23,"value":808},{"type":17,"tag":249,"props":1268,"children":1269},{"class":262},[1270],{"type":23,"value":1271}," [x[",{"type":17,"tag":249,"props":1273,"children":1274},{"class":587},[1275],{"type":23,"value":1276},"2",{"type":17,"tag":249,"props":1278,"children":1279},{"class":262},[1280],{"type":23,"value":1281},", :] ",{"type":17,"tag":249,"props":1283,"children":1284},{"class":330},[1285],{"type":23,"value":1144},{"type":17,"tag":249,"props":1287,"children":1288},{"class":262},[1289],{"type":23,"value":265},{"type":17,"tag":249,"props":1291,"children":1292},{"class":587},[1293],{"type":23,"value":1294},"MAX_SPEED",{"type":17,"tag":249,"props":1296,"children":1297},{"class":262},[1298],{"type":23,"value":1158},{"type":17,"tag":249,"props":1300,"children":1301},{"class":251,"line":360},[1302,1306,1310,1314,1318,1322,1327,1331,1336],{"type":17,"tag":249,"props":1303,"children":1304},{"class":262},[1305],{"type":23,"value":1229},{"type":17,"tag":249,"props":1307,"children":1308},{"class":330},[1309],{"type":23,"value":808},{"type":17,"tag":249,"props":1311,"children":1312},{"class":262},[1313],{"type":23,"value":1271},{"type":17,"tag":249,"props":1315,"children":1316},{"class":587},[1317],{"type":23,"value":1276},{"type":17,"tag":249,"props":1319,"children":1320},{"class":262},[1321],{"type":23,"value":1281},{"type":17,"tag":249,"props":1323,"children":1324},{"class":330},[1325],{"type":23,"value":1326},">=",{"type":17,"tag":249,"props":1328,"children":1329},{"class":262},[1330],{"type":23,"value":265},{"type":17,"tag":249,"props":1332,"children":1333},{"class":587},[1334],{"type":23,"value":1335},"MIN_SPEED",{"type":17,"tag":249,"props":1337,"children":1338},{"class":262},[1339],{"type":23,"value":1158},{"type":17,"tag":249,"props":1341,"children":1342},{"class":251,"line":383},[1343,1347,1351,1355,1359,1364,1368,1372,1377],{"type":17,"tag":249,"props":1344,"children":1345},{"class":262},[1346],{"type":23,"value":1229},{"type":17,"tag":249,"props":1348,"children":1349},{"class":330},[1350],{"type":23,"value":808},{"type":17,"tag":249,"props":1352,"children":1353},{"class":262},[1354],{"type":23,"value":1096},{"type":17,"tag":249,"props":1356,"children":1357},{"class":587},[1358],{"type":23,"value":850},{"type":17,"tag":249,"props":1360,"children":1361},{"class":262},[1362],{"type":23,"value":1363},", :]) ",{"type":17,"tag":249,"props":1365,"children":1366},{"class":330},[1367],{"type":23,"value":1144},{"type":17,"tag":249,"props":1369,"children":1370},{"class":262},[1371],{"type":23,"value":265},{"type":17,"tag":249,"props":1373,"children":1374},{"class":587},[1375],{"type":23,"value":1376},"MAX_ACCEL",{"type":17,"tag":249,"props":1378,"children":1379},{"class":262},[1380],{"type":23,"value":1158},{"type":17,"tag":249,"props":1382,"children":1383},{"class":251,"line":391},[1384,1388,1392,1396,1400,1404,1408,1412,1417],{"type":17,"tag":249,"props":1385,"children":1386},{"class":262},[1387],{"type":23,"value":1229},{"type":17,"tag":249,"props":1389,"children":1390},{"class":330},[1391],{"type":23,"value":808},{"type":17,"tag":249,"props":1393,"children":1394},{"class":262},[1395],{"type":23,"value":1096},{"type":17,"tag":249,"props":1397,"children":1398},{"class":587},[1399],{"type":23,"value":935},{"type":17,"tag":249,"props":1401,"children":1402},{"class":262},[1403],{"type":23,"value":1363},{"type":17,"tag":249,"props":1405,"children":1406},{"class":330},[1407],{"type":23,"value":1144},{"type":17,"tag":249,"props":1409,"children":1410},{"class":262},[1411],{"type":23,"value":265},{"type":17,"tag":249,"props":1413,"children":1414},{"class":587},[1415],{"type":23,"value":1416},"MAX_STEER",{"type":17,"tag":249,"props":1418,"children":1419},{"class":262},[1420],{"type":23,"value":1421},"]",{"type":17,"tag":26,"props":1423,"children":1424},{},[1425],{"type":23,"value":1426},"Finally, we define the optimizer for our system by",{"type":17,"tag":234,"props":1428,"children":1431},{"className":1429,"code":1430,"language":317,"meta":7},[315],"prob = cvxpy.Problem(cvxpy.Minimize(cost), constraints)\nprob.solve(solver=cvxpy.ECOS, verbose=False)\n",[1432],{"type":17,"tag":242,"props":1433,"children":1434},{},[1435],{"type":17,"tag":234,"props":1436,"children":1437},{"__ignoreMap":7},[1438,1455],{"type":17,"tag":249,"props":1439,"children":1440},{"class":251,"line":252},[1441,1446,1450],{"type":17,"tag":249,"props":1442,"children":1443},{"class":262},[1444],{"type":23,"value":1445},"prob ",{"type":17,"tag":249,"props":1447,"children":1448},{"class":330},[1449],{"type":23,"value":430},{"type":17,"tag":249,"props":1451,"children":1452},{"class":262},[1453],{"type":23,"value":1454}," cvxpy.Problem(cvxpy.Minimize(cost), constraints)\n",{"type":17,"tag":249,"props":1456,"children":1457},{"class":251,"line":351},[1458,1463,1469,1473,1478,1483,1488,1493,1497,1502],{"type":17,"tag":249,"props":1459,"children":1460},{"class":262},[1461],{"type":23,"value":1462},"prob.solve(",{"type":17,"tag":249,"props":1464,"children":1466},{"class":1465},"ct-657843",[1467],{"type":23,"value":1468},"solver",{"type":17,"tag":249,"props":1470,"children":1471},{"class":330},[1472],{"type":23,"value":430},{"type":17,"tag":249,"props":1474,"children":1475},{"class":262},[1476],{"type":23,"value":1477},"cvxpy.",{"type":17,"tag":249,"props":1479,"children":1480},{"class":587},[1481],{"type":23,"value":1482},"ECOS",{"type":17,"tag":249,"props":1484,"children":1485},{"class":262},[1486],{"type":23,"value":1487},", ",{"type":17,"tag":249,"props":1489,"children":1490},{"class":1465},[1491],{"type":23,"value":1492},"verbose",{"type":17,"tag":249,"props":1494,"children":1495},{"class":330},[1496],{"type":23,"value":430},{"type":17,"tag":249,"props":1498,"children":1499},{"class":587},[1500],{"type":23,"value":1501},"False",{"type":17,"tag":249,"props":1503,"children":1504},{"class":262},[1505],{"type":23,"value":1506},")",{"type":17,"tag":26,"props":1508,"children":1509},{},[1510,1512],{"type":23,"value":1511},"For more detail about using CVXPY, here is the link ",{"type":17,"tag":207,"props":1513,"children":1516},{"href":1514,"rel":1515},"https://www.cvxpy.org",[211],[1517],{"type":23,"value":1518},"CVXPY",{"type":17,"tag":18,"props":1520,"children":1522},{"id":1521},"in-conclusion",[1523],{"type":23,"value":1524},"In conclusion",{"type":17,"tag":26,"props":1526,"children":1527},{},[1528],{"type":23,"value":1529},"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too. Next post, I will explain about Nonlinear Model Predictive Control by using Casadi framework for mathematical optimization.",{"type":17,"tag":18,"props":1531,"children":1533},{"id":1532},"reference",[1534],{"type":23,"value":1535},"Reference",{"type":17,"tag":1537,"props":1538,"children":1539},"ol",{},[1540,1545,1550],{"type":17,"tag":126,"props":1541,"children":1542},{},[1543],{"type":23,"value":1544},"PythonRobotics: https://github.com/AtsushiSakai/PythonRobotics/tree/master/PathTracking/model_predictive_speed_and_steer_control",{"type":17,"tag":126,"props":1546,"children":1547},{},[1548],{"type":23,"value":1549},"Implementation of Linear Model Predictive Control: https://arxiv.org/abs/2109.11986",{"type":17,"tag":126,"props":1551,"children":1552},{},[1553],{"type":23,"value":1554},"CVXPY: https://www.cvxpy.org/",{"type":17,"tag":1556,"children":1557},"style",[1558],{"type":23,"value":1559},".ct-806137{color:#B392F0;}\n.ct-767297{color:#E1E4E8;}\n.ct-244866{color:#9ECBFF;}\n.ct-857441{color:#F97583;}\n.ct-533739{color:#79B8FF;}\n.ct-657843{color:#FFAB70;}",{"title":7,"searchDepth":351,"depth":351,"links":1561},[1562,1563,1564,1565,1566,1567,1568,1569],{"id":20,"depth":351,"text":24},{"id":67,"depth":351,"text":70},{"id":11,"depth":351,"text":80},{"id":103,"depth":351,"text":106},{"id":165,"depth":351,"text":168},{"id":197,"depth":351,"text":200},{"id":1521,"depth":351,"text":1524},{"id":1532,"depth":351,"text":1535},"markdown","content:topics:ai:linear-mpc.md","content","topics/ai/linear-mpc.md","md",1697043610500]