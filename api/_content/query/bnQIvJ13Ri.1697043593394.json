{"_path":"/topics/robotics/nonlinear-mpc","_dir":"robotics","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Nonlinear Model Predictive Control","description":"Introduction to Nonlinear Model Predictive Control","author":"Din Sokheng","slug":"nonlinear-mpc","tag":"nonlinear-mpc","img":"/topics/robotics/nmpc/predict_horizon.png","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"what-is-model-predictive-control"},"children":[{"type":"text","value":"What is Model Predictive Control ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system."}]},{"type":"element","tag":"div","props":{"className":["grid","grid-cols-2","space-x-10","justify-center","items-center"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/predict_horizon.png","width":600,"height":300},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/set_points.png","width":600,"height":300},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n  A car with finite horizons prediction and set point prediction over finite horizons.\n"}]},{"type":"element","tag":"h2","props":{"id":"nonlinear-model-predictive-control"},"children":[{"type":"text","value":"Nonlinear Model Predictive Control ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nonlinear Model Predictive Control has the same basic core of its control algorithms. The different is about the mathematical solving over the system. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIn the real-life application, most of the system certainly nonlinear and it's more complex than linear model. Linear systems are mostly time-invariant, meaning that the response of the system input is time-independent. Nonlinear systems are time-varying meaning that the response of the system to any input is time-dependent."},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The system model can be represent as state-space model"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"$$ \\dot{X} = f(X,U) $$"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nonlinear Model Predictive Control also works by solving the quardratic cost subject to the nonlinear function over a future finite horizons. The quadractic cost can be define as"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"J(x,u) = \\displaystyle\\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N})","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Notation"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"X","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the state of the system. This shall be obtained from the optimiztion problem."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"X_{ref}","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the reference state of the system or desired input state."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"U","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the input control of the system. This is a solution obtained from the optimization problem."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"U_{ref}","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the reference control of the system or desired input control."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Rewrite the optimization of NMPC problem."}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            \\min_{u_{0}, u_{1}, ..., u_{N-1} } \\quad \\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}&Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N})\\\\\n            \\text{subject to} \\quad & x_{k+1} = f(x_k, u_k) \\quad \\text{(System dynamics)} \\\\\n            & g(x_k, x_k) \\leq 0 \\quad \\text{(State constraints)} \\\\\n            & h(x_k, x_k) \\leq 0 \\quad \\text{(Input constraints)} \\\\\n            & p(x_k) \\leq 0 \\quad \\text{(Path constraints)} \\\\\n            & x_0=x(0)  \\quad \\text{(Initial condition)}\n      \\end{align*}\n            ","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which,"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"f","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the system dynamics model."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"g","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the state constraints of the system."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"h","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the input constraints of the system."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"p","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the path constraint, it help to ensure the safety following path of our system."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\phi(X_{N})","styles":"inline-flex","dist-cond":"false"},"children":[]},{"type":"text","value":" is the terminal cost of the system."}]}]},{"type":"element","tag":"h2","props":{"id":"discretize-the-system-model-with-runge-kutta-4th-order"},"children":[{"type":"text","value":"Discretize the system model with Runge-Kutta 4th order"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I will choose a simple system mode robot "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" DifferentialDrive "}]},{"type":"text","value":".\nThe forward kinematic equation"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{bmatrix} v_{x} \\\\ v_{y} \\\\ v_{\\theta} \\end{bmatrix} = \\begin{bmatrix} v\\sin{(\\theta)} \\\\ v\\cos{(\\theta)} \\\\ \\omega \\end{bmatrix}\n ","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"State constraints are the restriction imposed on the state variable of the system. It helps our optimizer not to obtain the solution that is outside the boundary region and also ensure the system to always perform the minimal action control in any critical condition."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We, then can do the approximation"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n    \\begin{align*}\n        k_{1} &= f(x^{*}, u^{*}) \\\\\n        k_{2} &= f(x^{*}+k_{1}\\frac{dt}{2}, u^{*}) \\\\ \n        k_{3} &= f(x^{*}+k_{2}\\frac{dt}{2}, u^{*}) \\\\\n        k_{4} &= f(x^{*}+k_{3}dt, u^{*}) \\\\ \n        \\Rightarrow{x_{k+1} } &= x_{k} + (k_{1}+2k_{2}+2k_{3}+k_{4})\\frac{dt}{6}\n    \\end{align*}\n","styles":"text-center","dist-cond":"true"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's evaluate it with our model."}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n        k_{1} &= \\begin{bmatrix} v^{*}\\cos{(\\theta)} \\\\ v^{*}\\sin{(\\theta)} \\\\ \\omega^{*}  \\end{bmatrix} \\\\\n        k_{2} &= \\begin{bmatrix} v^{*}\\cos{(\\theta + \\frac{dt}{2} \\times k_{1})} \\\\ v^{*}\\sin{(\\theta+ \\frac{dt}{2}\\times k_{1})} \\\\ \\omega^{*} \\end{bmatrix} \\\\\n        k_{3} &= \\begin{bmatrix} v^{*}\\cos{(\\theta + \\frac{dt}{2} \\times k_{2})} \\\\ v^{*}\\sin{(\\theta+ \\frac{dt}{2}\\times k_{2})} \\\\ \\omega^{*} \\end{bmatrix} \\\\\n        k_{4} &= \\begin{bmatrix} v^{*}\\cos{(\\theta + dt \\times k_{3})} \\\\ v^{*}\\sin{(\\theta+ dt\\times k_{3})} \\\\ \\omega^{*}  \\end{bmatrix} \\\\\n    \\end{align*}\n      ","styles":"text-center"},"children":[]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\Rightarrow{x_{k+1} } = x_{k} + \\left( \\begin{bmatrix} v^{*}\\cos{(\\theta)} \\\\ v^{*}\\sin{(\\theta)} \\\\ \\omega^{*}  \\end{bmatrix} + 2 \\times \\begin{bmatrix} v^{*}\\cos{(\\theta + \\frac{dt}{2} \\times k_{1})} \\\\ v^{*}\\sin{(\\theta+ \\frac{dt}{2}\\times k_{1})} \\\\ \\omega^{*} \\end{bmatrix} + 2 \\times \\begin{bmatrix} v^{*}\\cos{(\\theta + \\frac{dt}{2} \\times k_{2})} \\\\ v^{*}\\sin{(\\theta+ \\frac{dt}{2}\\times k_{2})} \\\\ \\omega^{*} \\end{bmatrix} + \\begin{bmatrix} v^{*}\\cos{(\\theta + dt \\times k_{3})} \\\\ v^{*}\\sin{(\\theta+ dt\\times k_{3})} \\\\ \\omega^{*}  \\end{bmatrix}   \\right) \\frac{dt}{6}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How to implement it in Python ???"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"import numpy as np\n\n## Define sampling time dt 100Hz\ndt = 0.01\n## Define the num steps for function approximation \nnum_steps = 100\n## Define initial states\nx = 0.0\ny = 0.0\nyaw = 0.0\n## Define input control\nv = 1.5 #m/s\nomega = 1.57 #rad/s\n## Define state represent model\n### define lambda function take variable x\nf = lambda x, u :  np.array([\n      [u[0]*np.cos(x[2])],\n      [u[0]*np.sin(x[2])],\n      [u[1]]\n])\n\nfor _ in range(num_steps):\n    k1 = f([x, y, yaw], [v, omega])\n    k2 = f([x + (dt / 2) * k1[0], y + (dt / 2) * k1[1], yaw + (dt / 2) * k1[2]], [v, omega])\n    k3 = f([x + (dt / 2) * k2[0], y + (dt / 2) * k2[1], yaw + (dt / 2) * k2[2]], [v, omega])\n    k4 = f([x + dt * k3[0], y + dt * k3[1], yaw + dt * k3[2]], [v, omega])\n\n    # Update state of the robot\n    x += (k1[0] + 2 * k2[0] + 2 * k3[0] + k4[0]) * dt / 6\n    y += (k1[1] + 2 * k2[1] + 2 * k3[1] + k4[1]) * dt / 6\n    yaw += (k1[2] + 2 * k2[2] + 2 * k3[2] + k4[2]) * dt / 6\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" numpy "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define sampling time dt 100Hz\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.01\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define the num steps for function approximation \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"num_steps "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"100\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define initial states\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"yaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define input control\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"v "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1.5"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"#m/s\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"omega "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1.57"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"#rad/s\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define state represent model\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### define lambda function take variable x\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"f "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"lambda"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x, u :  np.array([\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"      [u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.cos(x["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"      [u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.sin(x["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"      [u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" _ "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(num_steps):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    k1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" f([x, y, yaw], [v, omega])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    k2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" f([x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], yaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]], [v, omega])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    k3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" f([x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], yaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]], [v, omega])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    k4 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" f([x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], yaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]], [v, omega])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Update state of the robot\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k4["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"6\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k4["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"6\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    yaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (k1["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k2["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k3["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k4["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"6"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"single-shooting-method"},"children":[{"type":"text","value":"Single Shooting Method"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Single Shooting Method is a method that we transform the optimal control problem to the nonlinear programming problem with just one decision variable."}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            \\text{Problem Decision Variable} \\\\\n            w = \\left [ u_{0}, ..., u_{N-1}\\right]\n        \\end{align*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            x_{u} &= F(w,x_{0},t_{k}) \\\\\n            F(w,x_{0},t_{0}) &= x_{0} \\\\\n        \\end{align*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then solve the NLP"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            \\min_{w}\\Phi(F(w,x_{0},t_{k}), w) \\\\ \n            \\text{Subject to} \\hspace{1cm}  g_{1}(F(w,x_{0},t_{k}),w) \\leq{0}\n        \\end{align*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"h2","props":{"id":"multiple-shooting-method"},"children":[{"type":"text","value":"Multiple Shooting Method"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Multiple Shooting Method is a method that consist of transforming of optimal control problem to the nonlinear programming problem with multiple decision variables."}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            \\text{Problem Decision Variable} \\\\\n            w = \\left [ u_{0}, ..., u_{N-1}, x_{0}, ..., x_{N}\\right]\n        \\end{align*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"X","styles":"inline-flex"},"children":[]},{"type":"text","value":" becoming decision variable in the opimization problem as well as u"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"We apply path constraint at each iteration step"}]}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{equation*}\n                x_{k+1}-f(x_{k},u_{k}) = 0\n            \\end{equation*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then solve the NLP"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n      \\begin{align*}\n            \\min_{w}  \\Phi(F(w,x_{0},t_{k}),& w) \\\\ \n            \\text{s.t}\\hspace{0.5cm}  g_{1}(F(w,x_{0},t_{k}),w) &\\leq{0} \\\\ \n                               g_{2}(w) = \\begin{bmatrix}\n                                  \\bar{x}_{0}-x_{0} \\\\\n                                  f(x_{0},u_{0})-x_{1} \\\\ \n                                  \\vdots \\\\\n                                  f(x_{N-1}, u_{N-1}-x_{N})\n                              \\end{bmatrix} &= 0\n        \\end{align*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"h2","props":{"id":"full-implement-in-python"},"children":[{"type":"text","value":"Full Implement in Python"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We will use "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Casadi"}]},{"type":"text","value":" as a numerical optimization framework."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"import casadi as ca\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" casadi "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Define state representation and input control of our nonlinear model."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"# Symbolic Variables\n## States\nx = ca.SX.sym(\"x\")\ny = ca.SX.sym(\"y\")\ntheta = ca.SX.sym(\"theta\")\nstates = ca.vertcat(x, y, theta)\nnum_states = states.numel()\n\n## Control\nu1 = ca.SX.sym(\"u1\")\nu2 = ca.SX.sym(\"u2\")\ncontrols = ca.vertcat(u1, u2)\nnum_controls = controls.numel()\n\n# Define Nonlinear model\n## Rotation Matrix\nrot_mat = ca.vertcat(\n    ca.horzcat(ca.cos(theta), ca.sin(theta), 0),\n    ca.horzcat(-ca.sin(theta), ca.cos(theta), 0),\n    ca.horzcat(0, 0, 1)\n)\n\nvx = u1 * ca.cos(theta)\nvy = u1 * ca.sin(theta)\nvyaw = u2\n\nrhs = ca.vertcat(vx, vy, vyaw)\n## Define mapped nonlinear function f(x,u) -> rhs\nf = ca.Function('f', [states, controls], [rhs])\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Symbolic Variables\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## States\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"\"x\""}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"\"y\""}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"theta "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"\"theta\""}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.vertcat(x, y, theta)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" states.numel()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Control\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"\"u1\""}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"\"u2\""}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.vertcat(u1, u2)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" controls.numel()\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Define Nonlinear model\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Rotation Matrix\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"rot_mat "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.vertcat(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    ca.horzcat(ca.cos(theta), ca.sin(theta), "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    ca.horzcat("}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ca.sin(theta), ca.cos(theta), "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    ca.horzcat("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"vx "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.cos(theta)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"vy "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.sin(theta)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"vyaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"rhs "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.vertcat(vx, vy, vyaw)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Define mapped nonlinear function f(x,u) -> rhs\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"f "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.Function("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'f'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", [states, controls], [rhs])"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Declare symbolic matrix"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"X = ca.SX.sym('X', num_states, prediction_horizons + 1)\nX_ref = ca.SX.sym('X_ref', num_states, prediction_horizons + 1)\nU = ca.SX.sym('U', num_controls, prediction_horizons)\nU_ref = ca.SX.sym('U_ref', num_controls, prediction_horizons)\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"X "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'X'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", num_states, prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"X_ref "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'X_ref'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", num_states, prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'U'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", num_controls, prediction_horizons)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"U_ref "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"SX"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".sym("}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'U_ref'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", num_controls, prediction_horizons)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Define nonlinear programming and options for "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"Casadi"}]}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"nlp_prob = {\n    'f': cost_fn,\n    'x': opt_var,\n    'p': opt_dec,\n    'g': g\n}\n\nnlp_opts = {\n    'ipopt.max_iter': 5000,\n    'ipopt.print_level': 0,\n    'ipopt.acceptable_tol': 1e-6,\n    'ipopt.acceptable_obj_change_tol': 1e-4,\n    'print_time': 0\n}\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"nlp_prob "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'f'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": cost_fn,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'x'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": opt_var,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'p'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": opt_dec,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'g'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": g\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"}\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"nlp_opts "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ipopt.max_iter'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"5000"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ipopt.print_level'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ipopt.acceptable_tol'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1e-6"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ipopt.acceptable_obj_change_tol'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1e-4"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'print_time'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Determine boundary and constraint for our optimizer"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"lbx = ca.DM.zeros((num_states * (prediction_horizons + 1) + num_controls * prediction_horizons, 1))\nubx = ca.DM.zeros((num_states * (prediction_horizons + 1) + num_controls * prediction_horizons, 1))\n\nlbx[0: num_states * (prediction_horizons + 1): num_states] = x_min\nlbx[1: num_states * (prediction_horizons + 1): num_states] = y_min\nlbx[2: num_states * (prediction_horizons + 1): num_states] = theta_min\n\nubx[0: num_states * (prediction_horizons + 1): num_states] = x_max\nubx[1: num_states * (prediction_horizons + 1): num_states] = y_max\nubx[2: num_states * (prediction_horizons + 1): num_states] = theta_max\n\nlbx[num_states * (prediction_horizons + 1): num_states * (prediction_horizons + 1) + num_controls * prediction_horizons: num_controls] = u_min\nlbx[num_states * (prediction_horizons + 1) + 1: num_states * (prediction_horizons + 1) + num_controls * prediction_horizons: num_controls] = u_min\n\nubx[num_states * (prediction_horizons + 1): num_states * (prediction_horizons + 1) + num_controls * prediction_horizons: num_controls] = u_max\nubx[num_states * (prediction_horizons + 1) + 1: num_states * (prediction_horizons + 1) + num_controls * prediction_horizons: num_controls] = u_max\n\nargs = {\n    'lbg': ca.DM.zeros((num_states * (prediction_horizons + 1), 1)),\n    'ubg': ca.DM.zeros((num_states * (prediction_horizons + 1), 1)),\n    'lbx': lbx,\n    'ubx': ubx\n}\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"DM"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeros((num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"DM"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeros((num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x_min\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" y_min\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" theta_min\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x_max\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" y_max\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" theta_max\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx[num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons: num_controls] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_min\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lbx[num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons: num_controls] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_min\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx[num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"): num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons: num_controls] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_max\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"ubx[num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" num_controls "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" prediction_horizons: num_controls] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_max\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'lbg'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"DM"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeros((num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ubg'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": ca."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"DM"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeros((num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"), "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")),\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'lbx'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": lbx,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ubx'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":": ubx\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"}"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Obtain the solution from the solver at each iteration"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"sol = solver(\n            x0=args['x0'],\n            p=args['p'],\n            lbx=args['lbx'],\n            ubx=args['ubx'],\n            lbg=args['lbg'],\n            ubg=args['ubg'],\n        )\n\n        sol_x = ca.reshape(sol['x'][:num_states * (prediction_horizons + 1)], 3, prediction_horizons + 1)\n        sol_u = ca.reshape(sol['x'][num_states * (prediction_horizons + 1):], 2, prediction_horizons)\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"sol "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" solver(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"x0"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'x0'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"p"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'p'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"lbx"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'lbx'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"ubx"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ubx'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"lbg"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'lbg'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"ubg"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"args["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'ubg'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        )\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        sol_x "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.reshape(sol["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'x'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"][:num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        sol_u "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ca.reshape(sol["}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'x'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"][num_states "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (prediction_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"):], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", prediction_horizons)"}]}]}]}]}]},{"type":"element","tag":"h2","props":{"id":"result"},"children":[{"type":"text","value":"Result"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!."}]},{"type":"element","tag":"figure","props":{"className":["mb-4","inline-block","max-w-sm"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/diff_mpc.png","width":600,"height":300},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n    Plot of differential drive robot follow the circle trajectory !!!.\n"}]},{"type":"element","tag":"h2","props":{"id":"in-conclusion"},"children":[{"type":"text","value":"In conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too."}]},{"type":"element","tag":"h2","props":{"id":"reference"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/MMehrez/MPC-and-MHE-implementation-in-MATLAB-using-Casadi","rel":["nofollow"]},"children":[{"type":"text","value":"MPC-and-MHE-implementation-in-MATLAB-using-Casadi"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://web.casadi.org","rel":["nofollow"]},"children":[{"type":"text","value":"CasAdi"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/SokhengDin/PathTracking","rel":["nofollow"]},"children":[{"type":"text","value":"Path-Tracking"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-857441{color:#F97583;}\n.ct-767297{color:#E1E4E8;}\n.ct-326375{color:#6A737D;}\n.ct-533739{color:#79B8FF;}\n.ct-244866{color:#9ECBFF;}\n.ct-657843{color:#FFAB70;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"what-is-model-predictive-control","depth":2,"text":"What is Model Predictive Control ?"},{"id":"nonlinear-model-predictive-control","depth":2,"text":"Nonlinear Model Predictive Control ?"},{"id":"discretize-the-system-model-with-runge-kutta-4th-order","depth":2,"text":"Discretize the system model with Runge-Kutta 4th order"},{"id":"single-shooting-method","depth":2,"text":"Single Shooting Method"},{"id":"multiple-shooting-method","depth":2,"text":"Multiple Shooting Method"},{"id":"full-implement-in-python","depth":2,"text":"Full Implement in Python"},{"id":"result","depth":2,"text":"Result"},{"id":"in-conclusion","depth":2,"text":"In conclusion"},{"id":"reference","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:topics:robotics:nonlinear-mpc.md","_source":"content","_file":"topics/robotics/nonlinear-mpc.md","_extension":"md"}