{"_path":"/topics/robotics/nmpc-cgmres","_dir":"robotics","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Nonlinear Model Predictive Control with C/GMRES","description":"Optimal Control theory","author":"Din Sokheng","slug":"nmpc-cgmres","tag":"nmpc-cgmres","img":"/topics/robotics/nmpc/nmpc_cgmres.gif","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"the-optimal-control-theory-in-control-system"},"children":[{"type":"text","value":"The Optimal Control Theory in Control System"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Optimal Control is a branch of control theory in control system, the theory works by solving the optimization problem of the dynamical system in order to find the optimal solution for the system"}]},{"type":"element","tag":"h3","props":{"id":"what-is-model-predictive-control"},"children":[{"type":"text","value":"What is Model Predictive Control ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system."}]},{"type":"element","tag":"h3","props":{"id":"hamilton-jacobian-bellman-equation-hjbe"},"children":[{"type":"text","value":"Hamilton Jacobian Bellman Equation (HJBE)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Actually, the HJBE is a nonlinear partial differential equation that it consists necessary conditions for optimality of control by minimizing the loss function of the system. "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We have the Hamiltonian Jacobian Bellman Equation"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation*}\n    H(x,u,\\lambda,\\mu) = \\sum_{k=0}^{N-1}(x_{k}-x_{k,ref})^{T} Q(x_{k}-x_{k,ref}) + (u_{k}-u_{k,ref})^{T}R(u_{k}-u_{k,ref}) + \n                         \\phi(x) + \\lambda^{T}f(x,u) + \\mu^{T}C(x,u)\n\\end{equation*}","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"N","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the number of prediction future horizons or shooting node."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"x_{k}","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the state of the system at shooting node "},{"type":"element","tag":"math-render","props":{"latex-express":"k","styles":"inline-flex"},"children":[]},{"type":"text","value":" ."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"u_{k}","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the input control of the system at shooting node "},{"type":"element","tag":"math-render","props":{"latex-express":"k","styles":"inline-flex"},"children":[]},{"type":"text","value":" ."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"Q, R","styles":"inline-flex"},"children":[]},{"type":"text","value":" are diagonal matrix which helps the optimization solving the nlp problem."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"f(x,u)","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the state representation of the system."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"C(x,u)","styles":"inline-flex"},"children":[]},{"type":"text","value":"  is the constraint of the system."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\lambda","styles":"inline-flex"},"children":[]},{"type":"text","value":"  is the costate vector for state representation."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\mu","styles":"inline-flex"},"children":[]},{"type":"text","value":"  is the Lagrange multiplier vector for the equality constraint."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nonlinear Model Predictive Control has multiples solving method, but in this demonstration I will stick with the Continuation/GMRES method proposed by professor "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" Toshiyuki Ohtsuka "}]},{"type":"text","value":". "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Supposed we want to obtain solution vector "},{"type":"element","tag":"math-render","props":{"latex-express":"U(t) = [ u_{0}^{*}, \\mu_{0}^{*}, \\cdots, u_{N-1}^{*}, \\mu_{N-1}^{*} ]","styles":"inline-flex"},"children":[]},{"type":"text","value":"   at sampling time $t$, we then define the discretization of "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" Euler Lagrangian Equation (ELE) "}]},{"type":"text","value":"."}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{align}\n    x_{i+1}^{*}(t) &= x_{i}^{*}(t) + f(x_{i}^{*}(t), u_{i}^{*}(t))  \\\\\n    \\lambda_{i}^{*}(t) &= \\lambda_{i+1}^{*}(t) + \\frac{\\partial H}{\\partial x}\\left( x_{i}^{*}, u_{i}^{*}(t), \\lambda_{i+1}^{*}(t), \\mu_{i}^{*}(t) \\right) \\\\\n    \\lambda_{N}^{*}(t) &= \\frac{\\partial \\phi(x)}{\\partial x} \\\\\n    \\frac{\\partial H}{\\partial u} &\\left( x_{i}^{*}, u_{i}^{*}(t), \\lambda_{i+1}^{*}(t), \\mu_{i}^{*}(t) \\right) = 0 \\\\\n    C&(x_{i}^{*}(t),u_{i}^{*}(t)) = 0\n\\end{align}\n","style":"text-ceneter"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"To solve this nonlinear problem iteratively, we use Newton's method "},{"type":"element","tag":"math-render","props":{"latex-express":"F(x,u)=0","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation*}\n    F(x,u) = \\begin{bmatrix}\n        \\frac{\\partial H}{\\partial u} \\left( x_{0}^{*}, u_{0}^{*}(t), \\lambda_{1}^{*}(t), \\mu_{0}^{*}(t) \\right) \\\\\n        C(x_{0}^{*}(t),u_{0}^{*}(t))  \\\\\n        \\vdots \\\\\n        \\frac{\\partial H}{\\partial u} \\left( x_{N-1}^{*}, u_{N-1}^{*}(t), \\lambda_{N}^{*}(t), \\mu_{N-1}^{*}(t) \\right) \\\\\n        C(x_{N-1}^{*}(t),u_{N-1}^{*}(t)) \\\\\n    \\end{bmatrix} = 0\n\\end{equation*}","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Solving this problem directly will caused big computational complexity, hence we use Continuation to reduce the complexity of the "},{"type":"element","tag":"math-render","props":{"latex-express":"F(x,u)","styles":"inline-flex"},"children":[]},{"type":"text","value":" function and then solve it by using GMRES method."}]},{"type":"element","tag":"h3","props":{"id":"continuation"},"children":[{"type":"text","value":"Continuation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Denote  "},{"type":"element","tag":"math-render","props":{"latex-express":"\\zeta, \\alpha, h \\in{\\mathbb{R} }","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation}\n    \\frac{\\partial F}{\\partial u}(x,u) \\dot{u}(t) = -\\zeta F(x,u)(t)-\\frac{\\partial F}{\\partial x}(x,u)(t)\\dot{x}-\\frac{\\partial F}{\\partial t}(x,u)(t) \n\\end{equation}","styles":"text-center"},"children":[]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation}\n    \\frac{F(x(t)+h\\dot{x}(t),u(t)+h\\dot{u}(t),t+h)-F(x+h\\dot{x}(t),u(t),t+h)}{h} = -\\zeta F(x(t),u(t), t) - \\frac{F(x+h\\dot{x}(t), u(t),t+h)-F(x(t), u(t), t)}{h}\n\\end{equation}","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let "},{"type":"element","tag":"math-render-b","props":{"latex-express":"right=\\frac{F(x(t)+h\\dot{x}(t),u(t)+h\\dot{u}(t),t+h)-F(x+h\\dot{x}(t),u(t),t+h)}{h}","styles":"text-center"},"children":[]},{"type":"text","value":" and "},{"type":"element","tag":"math-render-b","props":{"latex-express":"left =  -\\zeta F(x(t),u(t), t) - \\frac{F(x+h\\dot{x}(t), u(t),t+h)-F(x(t), u(t), t)}{h}","styles":"text-center"},"children":[]}]},{"type":"element","tag":"h3","props":{"id":"generalized-minimal-residue-method-gmres"},"children":[{"type":"text","value":"Generalized Minimal Residue Method (GMRES)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The Generalized Minimal Residual (GMRES) algorithm is an iterative method for solving linear systems of equations. It is often used for large sparse linear systems."}]},{"type":"element","tag":"h4","props":{"id":"algorithm-description"},"children":[{"type":"text","value":"Algorithm Description"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Initialize"}]},{"type":"text","value":":"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Choose an initial guess for the solution, denoted as "},{"type":"element","tag":"math-render","props":{"latex-express":"x_{0}","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Set the residual vector "},{"type":"element","tag":"math-render","props":{"latex-express":"r_{0}=\\left\\| Ax_{0}-b \\right\\|","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Set "},{"type":"element","tag":"math-render","props":{"latex-express":"v_{1}=\\frac{r_{0} }{\\left\\| r_{0} \\right\\|}","styles":"inline-flex"},"children":[]},{"type":"text","value":", where "},{"type":"element","tag":"math-render","props":{"latex-express":"\\left\\| r_{0} \\right\\|","styles":"inline-flex"},"children":[]},{"type":"text","value":"  is the norm of "},{"type":"element","tag":"math-render","props":{"latex-express":"r_{0}","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Iterative Process"}]},{"type":"text","value":":"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Choose a vector "},{"type":"element","tag":"math-render","props":{"latex-express":"v_{1}","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"For "},{"type":"element","tag":"math-render","props":{"latex-express":"k=0","styles":"inline-flex"},"children":[]},{"type":"text","value":" to "},{"type":"element","tag":"math-render","props":{"latex-express":"maxiteration","styles":"inline-flex"},"children":[]},{"type":"text","value":":"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Arnoldi process:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"h_{i,j} = \\left(Av_{j}, v_{i} \\right)","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\hat{v}_{j+1} = Av_{j} - \\sum_{i=1}^{j}h_{i,j}v_{i}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"h_{j+1,j} = \\left \\| \\hat{v}_{j+1}  \\right\\|_{2}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"v_{j+1} = \\frac{\\hat{v}_{j+1} }{h_{j+1,j} }","styles":"inline-flex"},"children":[]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Check for convergence:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If "},{"type":"element","tag":"math-render","props":{"latex-express":"||r_k|| < tolerance","styles":"inline-flex"},"children":[]},{"type":"text","value":", exit the loop."}]}]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"If no convergence is achieved after "},{"type":"element","tag":"math-render","props":{"latex-express":"maxiterations","styles":"inline-flex"},"children":[]},{"type":"text","value":", exit with an error message."}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Find "},{"type":"element","tag":"math-render","props":{"latex-express":"y","styles":"inline-flex"},"children":[]}]},{"type":"text","value":": which minimize "},{"type":"element","tag":"math-render","props":{"latex-express":"\\left\\| r_{0}e_{1}-\\hat{H}_{m}y \\right \\|_{2}","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"Compute"}]},{"type":"text","value":": "},{"type":"element","tag":"math-render","props":{"latex-express":"x_{m} = x_{0}+V_{m}y_{m}","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For example differential model, let "},{"type":"element","tag":"math-render","props":{"latex-express":"x, y, \\phi","styles":"inline-flex"},"children":[]},{"type":"text","value":" is the state presentation of the model\n$$ \\dot{x} = f(x,u) $$"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then the HJBE defined as"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation*}\n    H(x,u,\\lambda,\\mu) = \\sum_{k=0}^{N-1}(x_{k}-x_{k,ref})^{T}Q(x_{k}-x_{k,ref}) + (u_{k}-u_{k,ref})^{T}R(u_{k}-u_{k,ref}) + \n                         \\phi(x) + \\lambda^{T}f(x,u) + \\mu^{T}C(x,u)\n\\end{equation*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Which"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"f(x,u) = \\begin{bmatrix} u_{1}*\\cos{(\\phi)} \\\\ u_{1}*\\sin{(\\phi)} \\\\ u_{2} \\end{bmatrix}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"C(x,u) = \\begin{bmatrix} \\left(u_{1}-\\frac{u_{1max}+u_{1min}}{2}\\right)^{2}+u_{1dummy}^{2}-(\\frac{u_{1max}-u_{1min} }{2})^{2} \\\\\n          \\left(u_{2}-\\frac{u_{2max}+u_{2min}}{2}\\right)^{2}+u_{2dummy}^{2}-(\\frac{u_{2max}-u_{2min}}{2})^{2}\n\\end{bmatrix}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\phi(x) = (x_{N}-x_{N,ref})^{T}Q(x_{N}-x_{N,ref})","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"\\lambda = \\begin{bmatrix} \\lambda_{1} & \\lambda_{2} & \\lambda_{3} \\end{bmatrix}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\mu = \\begin{bmatrix} \\mu_{1} & \\mu_{2} \\end{bmatrix}","styles":"inline-flex"},"children":[]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Subtitute all of these term into HJBE"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{align*}\nH(x,u,\\lambda,\\mu) &= \\sum_{k=0}^{N-1}(x_{k}-x_{k,ref})^{T}Q(x_{k}-x_{k,ref}) + (u_{k}-u_{k,ref})^{T}R(u_{k}-u_{k,ref})\n                     + (x_{N-1}-x_{N-1,ref})^{T}Q(x_{N-1}-x_{N-1,ref}) \\\\ & + \\begin{bmatrix} \\lambda_{1} \\\\ \\lambda_{2} \\\\ \\lambda_{3} \\end{bmatrix}^{T} \\begin{bmatrix} u_{1}*\\cos(\\phi) \\\\ u_{1}*\\sin(\\phi) \\\\ u_{2} \\end{bmatrix}\n                     + \\begin{bmatrix} \\mu_{1} \\\\ \\mu_{2} \\end{bmatrix}^{T} \\begin{bmatrix} \\left(u_{1}+\\frac{u_{1max}+u_{1min}}{2}\\right)^{2}+u_{1dummy}^{2}-(\\frac{u_{1max}-u_{1min}}{2})^{2} \\\\\n            \\left(u_{2}+\\frac{u_{2max}+u_{2min}}{2}\\right)^{2}+u_{2dummy}^{2}-(\\frac{u_{2max}-u_{2min}}{2})^{2} \n\\end{bmatrix}\n\\end{align*}","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"By doing partial derivative of HJBE, we get"}]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation*}\n    \\frac{\\partial H}{\\partial x} = \\begin{bmatrix}\n     (x-x_{ref})q_{1} \\\\\n     (y-y_{ref})q_{2} \\\\ \n     (\\phi-\\phi_{ref})q_{3} - \\lambda_{1}\\sin{(\\phi)}u_{1} + \\lambda_{2}\\cos{(\\phi)}u_{1}\n     \\end{bmatrix}\n\\end{equation*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"math-render-b","props":{"latex-express":"\n\\begin{equation*}\n    \\frac{\\partial H}{\\partial u} = \\begin{bmatrix}\n      (u_{1}-u_{1,ref})r_{1}+\\lambda_{1}\\cos{(\\phi)}+\\lambda_{2}\\sin{(\\phi)} \\\\ \n      (u_{2}-u_{2,ref})r_{2}+\\lambda_{3}\n     \\end{bmatrix}\n\\end{equation*}\n","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I know this is quite complicated, this is just only input control without constraint and solver with single shooting method."}]},{"type":"element","tag":"h2","props":{"id":"implementing-in-python"},"children":[{"type":"text","value":"Implementing in Python"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is safe to say that you will need to start from basic first. Like creating class for model representation, but for now I will just go with CGMRES implementing only, since I have done many demonstration of how to create class for model. "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Let's create class for "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" Hamiltion Jacobian Bellman Equation "}]},{"type":"text","value":" which we already derived from above equation."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"class HJBEquation:\n\n    def __init__(self, q1, q2, q3, r1, r2, u_max, u_min):\n\n        self.q1 = q1\n        self.q2 = q2\n        self.q3 = q3\n\n        self.r1 = r1\n        self.r2 = r2\n\n        self.u1_min = u_min[0]\n        self.u2_min = u_min[0]\n\n        self.u1_max = u_max[0]\n        self.u2_max = u_max[1]\n\n    def dhdx(self, x, y, yaw, x_r, y_r, yaw_r, u1, lam1, lam2):\n\n        dhdx1 = (x-x_r)*self.q1\n        dhdx2 = (y-y_r)*self.q2\n        dhdx3 = (yaw-yaw_r)*self.q3-u1*lam1*np.sin(yaw)+u1*lam2*np.cos(yaw)\n\n        return dhdx1, dhdx2, dhdx3\n\n    def dhdu(self, yaw, u1, u2, u1_r, u2_r, lam1, lam2, lam3, mu1, mu2):\n\n        dhdu1 = self.r1*(u1-u1_r)+lam1*np.cos(yaw)+lam2*np.sin(yaw)+2*mu1*u1*(u1+(self.u1_max+self.u1_min)/2)\n        dhdu2 = self.r2*(u2-u2_r)+lam3+2*mu2*(u2+(self.u2_max+self.u2_min)/2)\n\n        return dhdu1, dhdu2\n\n    def dphidx(self, x, y, yaw, x_r, y_r, yaw_r):\n        dphidx1 = self.q1*(x-x_r)\n        dphidx2 = self.q2*(y-y_r)\n        dphidx3 = self.q3*(yaw-yaw_r)\n\n        return dphidx1, dphidx2, dphidx3\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"HJBEquation"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"__init__"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, q1, q2, q3, r1, r2, u_max, u_min):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" q1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" q2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" q3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" r1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" r2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u1_min "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_min["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u2_min "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_min["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u1_max "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_max["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u2_max "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u_max["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"dhdx"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, x, y, yaw, x_r, y_r, yaw_r, u1, lam1, lam2):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dhdx1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (x"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"x_r)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dhdx2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (y"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"y_r)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dhdx3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (yaw"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"yaw_r)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q3"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lam1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.sin(yaw)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lam2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.cos(yaw)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdx1, dhdx2, dhdx3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"dhdu"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, yaw, u1, u2, u1_r, u2_r, lam1, lam2, lam3, mu1, mu2):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dhdu1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(u1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u1_r)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lam1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.cos(yaw)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lam2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.sin(yaw)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"mu1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(u1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u1_max"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u1_min)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dhdu2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(u2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"u2_r)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"lam3"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"mu2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(u2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u2_max"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u2_min)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdu1, dhdu2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"dphidx"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, x, y, yaw, x_r, y_r, yaw_r):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dphidx1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(x"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"x_r)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dphidx2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q2"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(y"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"y_r)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dphidx3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q3"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(yaw"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"yaw_r)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dphidx1, dphidx2, dphidx3"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here, I suggest that you should understand the mathematics equations above that I try to explain. It is easy to do it in Python programming language if you already understand its expression. Now I created another class for "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" NMPC with CGMRES "}]},{"type":"text","value":". "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"class NMPCCGMRES:\n\n    def __init__(self):\n\n        ## NMPC params\n        self.x_dim = 3\n        self.u_dim = 2\n        self.c_dim = 2\n        self.pred_horizons = 10\n\n        ### Continuations Params\n        self.ht = 1e-5\n        self.zeta = 1/self.ht\n        self.alpha = 0.5\n        self.tf = 1.0\n\n        ### Matrix\n\n        self.q1 = 1\n        self.q2 = 6\n        self.q3 = 1\n        self.r1 = 1\n        self.r2 = 0.1\n\n        ### Constraint\n        self.u_min = [ 0,  0]\n        self.u_max = [ 2,  1.57]\n        self.u_dummy = [0.01, 0.01]\n\n        ### Initialize matrix solution\n        self.dU = np.zeros((self.u_dim, self.pred_horizons))\n\n        ### Reference point\n        self.X_r = [3, 2, 0.0]\n        self.U_r = [0, 0]\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"NMPCCGMRES"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"__init__"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## NMPC params\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".x_dim "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"3\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".c_dim "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"10\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### Continuations Params\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1e-5\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeta "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".alpha "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.5\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".tf "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### Matrix\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"6\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".q3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".r2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### Constraint\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_min "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",  "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_max "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [ "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":",  "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1.57"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dummy "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.01"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.01"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### Initialize matrix solution\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dU "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros(("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"### Reference point\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"3"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".U_r "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These are just for tuning parameters and initialize parameters, let's focus on CGMRES method. As the expression above at equation (1).\nLet's denote that"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"X = np.zeros((x_dim, pred_horizons+1))      ## State for N-prediction+1\nU = np.zeros((u_dim, pred_horizons))        ## Input Control for N-prediction\nLambda = np.zeros((x_dim, pred_horizons+1)) ## Costate vector for N-prediction+1\ndt = 0.01                                   ## Sampling Time\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"X "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((x_dim, pred_horizons"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))      "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## State for N-prediction+1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((u_dim, pred_horizons))        "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Input Control for N-prediction\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Lambda "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((x_dim, pred_horizons"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")) "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Costate vector for N-prediction+1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0.01"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                                   "}]},{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"## Sampling Time"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Then, we can perform equation (1) as"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"def calc_state(self, X, U, dt):\n\n        for i in range(self.pred_horizons):\n            x_dot, y_dot, yaw_dot = self.robot_model.forward_kinematic(X[2, i], U[0, i], U[1, i])\n            \n            X[0, i+1] = X[0, i] + x_dot * dt\n            X[1, i+1] = X[1, i] + y_dot * dt\n            X[2, i+1] = X[2, i] + yaw_dot * dt\n\n        return X\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"calc_state"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, X, U, dt):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            x_dot, y_dot, yaw_dot "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".robot_model.forward_kinematic(X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x_dot "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" y_dot "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" yaw_dot "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" X"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next we calculating costate, we are going in backward direction"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"def calc_costate(self, X, U, Lambda, dt):\n\n        x_N, y_N, yaw_N = self.hjb_equation.dphidx(X[0, -1], X[1, -1], X[2, -1],\n                                                   self.X_r[0], self.X_r[1], self.X_r[2])\n        Lambda[0, -1] = x_N\n        Lambda[1, -1] = y_N\n        Lambda[2, -1] = yaw_N\n\n\n        for i in reversed(range(1, self.pred_horizons)):\n\n            dhdx1, dhdx2, dhdx3 = self.hjb_equation.dhdx(\n                X[0, i], X[1, i], X[2, i],\n                self.X_r[0], self.X_r[1], self.X_r[2],\n                U[0, i], Lambda[0, i+1], Lambda[1, i+1]\n            )\n\n            Lambda[0, i] = Lambda[0, i+1] + dhdx1 * dt\n            Lambda[1, i] = Lambda[1, i+1] + dhdx2 * dt\n            Lambda[2, i] = Lambda[2, i+1] + dhdx3 * dt\n    \n\n        return Lambda\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"calc_costate"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, X, U, Lambda, dt):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        x_N, y_N, yaw_N "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".hjb_equation.dphidx(X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                                                   "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x_N\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" y_N\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" yaw_N\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"reversed"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons)):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            dhdx1, dhdx2, dhdx3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".hjb_equation.dhdx(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".X_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            )\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdx1 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdx2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Lambda["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdx3 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Lambda"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And finally, calculating Newton F Function"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"def calc_f(self, X, U, Lambda, Mu, dt):\n\n        X_new = self.calc_state(X, U, dt)\n\n        Lambda_new = self.calc_costate(X_new, U, Lambda, dt)\n\n        F = np.zeros((self.u_dim, self.pred_horizons))\n\n        for i in range(self.pred_horizons):\n            dhdu1, dhdu2 = self.hjb_equation.dhdu(X_new[2, i], U[0, i], U[1, i],\n                                                  self.U_r[0], self.U_r[1],\n                                                  Lambda_new[0, i+1], Lambda_new[1, i+1], Lambda_new[2, i+1],\n                                                  Mu[0, i], Mu[1, i])\n            F[0, i] = dhdu1\n            F[1, i] = dhdu2\n            \n        F = F.T.ravel().reshape(-1, 1)\n\n        return F\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"calc_f"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, X, U, Lambda, Mu, dt):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        X_new "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_state(X, U, dt)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Lambda_new "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_costate(X_new, U, Lambda, dt)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        F "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros(("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            dhdu1, dhdu2 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".hjb_equation.dhdu(X_new["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                                                  "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".U_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".U_r["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                                                  Lambda_new["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], Lambda_new["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], Lambda_new["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"],\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"                                                  Mu["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i], Mu["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            F["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdu1\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            F["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dhdu2\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"            \n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        F "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F.T.ravel().reshape("}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now let's introduce Continuation method for Function "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"F"}]},{"type":"text","value":", you can look at the "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" Continuation "}]},{"type":"text","value":" part."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"# Time step horizons\ndt = self.tf * (1-np.exp(-self.alpha*time)) / self.pred_horizons\n# F(x,u,t+h)\nF = self.calc_f(X, U, Lambda, Mu, dt)\n# F(x+hdx,u,t+h)\nx_dot, y_dot, yaw_dot = self.robot_model.forward_kinematic(X[2, 0], U[0, 0], U[1, 0])\nX[:, 0] = X[:, 0] + np.array([x_dot, y_dot, yaw_dot]) * self.ht\nFxt = self.calc_f(X, U, Lambda, Mu, dt)\n# F(x+hdx,u+hdx,t+h)\nFuxt = self.calc_f(X, U + self.dU*self.ht, Lambda, Mu , dt)\n\n# Define right-left handside equation\nleft = (Fuxt - Fxt) / self.ht\nright = -self.zeta * F - (Fxt - F)/self.ht\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Time step horizons\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"dt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".tf "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"np.exp("}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".alpha"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"time)) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# F(x,u,t+h)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"F "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_f(X, U, Lambda, Mu, dt)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# F(x+hdx,u,t+h)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"x_dot, y_dot, yaw_dot "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".robot_model.forward_kinematic(X["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"], U["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"X[:, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" X[:, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.array([x_dot, y_dot, yaw_dot]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Fxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_f(X, U, Lambda, Mu, dt)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# F(x+hdx,u+hdx,t+h)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Fuxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_f(X, U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dU"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht, Lambda, Mu , dt)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Define right-left handside equation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"left "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (Fuxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Fxt) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"right "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeta "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (Fxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here is the crucial part, we need to implement GMRES solver for our "},{"type":"element","tag":"code-inline","props":{},"children":[{"type":"text","value":"F"}]},{"type":"text","value":" function to obtain solution vector."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"# Define right-left handside equation\nleft = (Fuxt - Fxt) / self.ht\nright = -self.zeta * F - (Fxt - F)/self.ht\n\n# Define iterations\nm = (self.u_dim ) * self.pred_horizons\n# Define r0\nr0 = right - left\n# print(r0)\n\n# GMRES\nVm = np.zeros((m, m+1))\nVm[:, 0:1] = r0 / np.linalg.norm(r0)\n# print(\"Vm\", Vm[:, 0])\nHm = np.zeros((m+1, m))\n# print(Vm[:, 0])\n\n\nfor i in range(m):\n    Fuxt = self.calc_f(\n        X, U + Vm[:, i:i+1].reshape(self.u_dim, self.pred_horizons, order='F') * self.ht,\n        Lambda, Mu,\n        dt\n    )\n\n    Av = (Fuxt - Fxt) / self.ht\n\n    for k in range(i+1):\n        Hm[k, i] = np.dot(Av.T, Vm[:, k:k+1])\n\n    temp_vec = np.zeros((m, 1))\n\n    for k in range(i+1):\n        temp_vec = temp_vec + np.dot(Hm[k, i], Vm[:, k:k+1])\n\n    v_hat = Av - temp_vec\n\n    Hm[i+1, i] = np.linalg.norm(v_hat)\n\n    Vm[:,i+1:i+2] = v_hat/Hm[i+1, i]\n\ne = np.zeros((m+1, 1))\ne[0, 0] = 1.0\ngm = np.linalg.norm(r0) * e\n# print(gm)\n\nUTMat, gm = self.ToUTMat(Hm, gm, m)\n\nmin_y = np.zeros((m, 1))\n\nfor i in range(m):\n    min_y[i][0] = (gm[i, 0] - np.dot(UTMat[i:i+1 ,:] ,min_y))/UTMat[i, i]\n\ndU_new = self.dU + np.dot(Vm[:, 0:m], min_y).reshape(self.u_dim, self.pred_horizons, order='F')\n\nself.dU = dU_new\n\nU = U + self.dU * self.ht\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Define right-left handside equation\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"left "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (Fuxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Fxt) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"right "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".zeta "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (Fxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" F)"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Define iterations\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"m "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim ) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# Define r0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"r0 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" right "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" left\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# print(r0)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# GMRES\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Vm "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((m, m"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Vm[:, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" r0 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.linalg.norm(r0)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# print(\"Vm\", Vm[:, 0])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":15},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Hm "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((m"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", m))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":16},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# print(Vm[:, 0])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":17},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":18},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":19},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(m):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":20},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    Fuxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".calc_f(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":21},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        X, U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Vm[:, i:i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"].reshape("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons, "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"order"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'F'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":") "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":22},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Lambda, Mu,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":23},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        dt\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":24},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    )\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":25},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":26},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    Av "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (Fuxt "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Fxt) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":27},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":28},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":29},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        Hm[k, i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.dot(Av.T, Vm[:, k:k"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":30},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":31},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    temp_vec "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((m, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":32},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":33},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" k "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":34},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        temp_vec "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" temp_vec "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.dot(Hm[k, i], Vm[:, k:k"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"])\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":35},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":36},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    v_hat "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" Av "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" temp_vec\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":37},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":38},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    Hm[i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.linalg.norm(v_hat)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":39},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":40},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    Vm[:,i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" v_hat"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"Hm[i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", i]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":41},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":42},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"e "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((m"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":43},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"e["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1.0\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":44},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"gm "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.linalg.norm(r0) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" e\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":45},"children":[{"type":"element","tag":"span","props":{"class":"ct-326375"},"children":[{"type":"text","value":"# print(gm)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":46},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":47},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"UTMat, gm "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ToUTMat(Hm, gm, m)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":48},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":49},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"min_y "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.zeros((m, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"))\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":50},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":51},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" i "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(m):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":52},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    min_y[i]["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (gm[i, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.dot(UTMat[i:i"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" ,:] ,min_y))"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"/"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"UTMat[i, i]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":53},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":54},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"dU_new "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dU "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.dot(Vm[:, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":m], min_y).reshape("}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".u_dim, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".pred_horizons, "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"order"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"'F'"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":55},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":56},"children":[{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dU "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dU_new\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":57},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":58},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" U "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dU "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".ht"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can look in my code inside function "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" solve_nmpc "}]},{"type":"text","value":"."}]},{"type":"element","tag":"h2","props":{"id":"experiment-in-python"},"children":[{"type":"text","value":"Experiment in Python"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"GMRES was consider one of the fastest solver for sparse linear algebra problem, so I will include the link for the GMRES algorithms. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nIn my experiment, I use differential drive robot. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nConsider as our state representation "},{"type":"element","tag":"math-render","props":{"latex-express":" x = \\begin{bmatrix} x \\\\ y \\\\ \\phi \\end{bmatrix} ","styles":"inline-flex"},"children":[]},{"type":"text","value":" and of course setting initialization "},{"type":"element","tag":"math-render","props":{"latex-express":" x_{0} = [0.0, 0.0, 0.0] ","styles":"inline-flex"},"children":[]},{"type":"text","value":", also "},{"type":"element","tag":"math-render","props":{"latex-express":" u_{0} = [0.0, 0.0] ","styles":"inline-flex"},"children":[]},{"type":"text","value":"."}]},{"type":"element","tag":"figure","props":{"className":["mb-4","inline-block","max-w-sm"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/nmpc_cgmres.gif","width":700,"height":350},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n    Animation of Differential Drive robot on optimal trajectory !!!\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"And here are the optimal data for all state and input control."}]},{"type":"element","tag":"figure","props":{"className":["mb-4","inline-block","max-w-sm"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/cgmreDat1.png","width":600,"height":300},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n    All data obtained after simulation.\n"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can find all the code of NMPC even with CasAdi and CGMRES here in my github: "},{"type":"element","tag":"a","props":{"href":"https://github.com/SokhengDin/Path-Tracking/tree/main","rel":["nofollow"]},"children":[{"type":"text","value":"Path-Tracking"}]}]},{"type":"element","tag":"h2","props":{"id":"in-conclusion"},"children":[{"type":"text","value":"In Conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Nonlinear Model Predictive Control with CGMRES is one of the great NMPC method that you should try, since it provides a very fast numerical calculation thank to the GMRES algorithms with Given Rotation method. Even though compare to another NMPC solver, NMPC with CGMRES sometime is hard for finding the optimal parameters in order to not cause unstable numerical calculation. Next time, I will bring the multiple shooting method which is consider in the promise of more robust numerical stability tha single shooting method."}]},{"type":"element","tag":"h2","props":{"id":"references"},"children":[{"type":"text","value":"References"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.researchgate.net/publication/228007717_A_real-time_algorithm_for_nonlinear_receding_horizon_control_using_multiple_shooting_and_continuationKrylov_method","rel":["nofollow"]},"children":[{"type":"text","value":"A real‐time algorithm for nonlinear receding horizon control using multiple shooting and continuation/Krylov method"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://github.com/AtsushiSakai/PythonRobotics/tree/master/PathTracking/cgmres_nmpc","rel":["nofollow"]},"children":[{"type":"text","value":"Nonlinear Model Predictive Control with CGMRES of Steering Car "}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://qiita.com/PozihameBaystar/items/650cc839da5d9c974f5d","rel":["nofollow"]},"children":[{"type":"text","value":"C/GMRESシミュレーションを3つの言語で作ったので比較してみた"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://qiita.com/opticont/items/b3518b470d9e327144be","rel":["nofollow"]},"children":[{"type":"text","value":"Krylov部分空間とGMRES法について"}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"a","props":{"href":"https://www.sciencedirect.com/science/article/pii/S2405896318326727","rel":["nofollow"]},"children":[{"type":"text","value":"Nonlinear Model Predictive Control of Position and Attitude in a Hexacopter with Three Failed Rotors"}]}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-857441{color:#F97583;}\n.ct-767297{color:#E1E4E8;}\n.ct-806137{color:#B392F0;}\n.ct-533739{color:#79B8FF;}\n.ct-326375{color:#6A737D;}\n.ct-657843{color:#FFAB70;}\n.ct-244866{color:#9ECBFF;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"the-optimal-control-theory-in-control-system","depth":2,"text":"The Optimal Control Theory in Control System","children":[{"id":"what-is-model-predictive-control","depth":3,"text":"What is Model Predictive Control ?"},{"id":"hamilton-jacobian-bellman-equation-hjbe","depth":3,"text":"Hamilton Jacobian Bellman Equation (HJBE)"},{"id":"continuation","depth":3,"text":"Continuation"},{"id":"generalized-minimal-residue-method-gmres","depth":3,"text":"Generalized Minimal Residue Method (GMRES)"}]},{"id":"implementing-in-python","depth":2,"text":"Implementing in Python"},{"id":"experiment-in-python","depth":2,"text":"Experiment in Python"},{"id":"in-conclusion","depth":2,"text":"In Conclusion"},{"id":"references","depth":2,"text":"References"}]}},"_type":"markdown","_id":"content:topics:robotics:nmpc-cgmres.md","_source":"content","_file":"topics/robotics/nmpc-cgmres.md","_extension":"md"}