[{"_path":"/topics/ai/cnn","_dir":"ai","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Convolutional Neural Network","description":"How Convolution Neural Network works.","author":"Din Sokheng","slug":"ai-cnn","tag":"ai-cnn","img":"/topics/ai/figure-dnn.png","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"convolutional-neural-network-cnn"},"children":[{"type":"text","value":"Convolutional Neural Network (CNN)"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Convolutional Neural Networks (CNNs) are a class of deep learning models primarily used for image and video analysis. They have revolutionized computer vision tasks such as image classification, object detection, and image segmentation. CNNs are designed to automatically learn hierarchical features from input data, which makes them particularly effective for tasks where the spatial relationships in data are essential, like recognizing patterns in images."}]},{"type":"element","tag":"h2","props":{"id":"forward-propagation"},"children":[{"type":"text","value":"Forward Propagation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In the forward propagation phase of a CNN, the input image is convolved with learnable filters, followed by non-linear activation functions like ReLU (Rectified Linear Unit). The output of this convolutional layer is then pooled to reduce dimensionality and make the network translation-invariant. These operations are typically represented mathematically as:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Convolution: "},{"type":"element","tag":"math-render","props":{"latex-express":" Z^{[l]} = (W^{[l]} * A^{[l-1]}) + b^{[l]}","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Activation: "},{"type":"element","tag":"math-render","props":{"latex-express":"A^{[l]} = \\text{ReLU}(Z^{[l]})","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pooling: "},{"type":"element","tag":"math-render","props":{"latex-express":"A^{[l]} = \\text{MaxPooling}(A^{[l-1]})","styles":"inline-flex"},"children":[]}]}]},{"type":"element","tag":"h2","props":{"id":"backward-propagation"},"children":[{"type":"text","value":"Backward Propagation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Backward propagation is the process of computing gradients with respect to the loss function, which allows the network to update its parameters during training. The gradients are computed using the chain rule of calculus and are used to adjust the convolutional filter weights and biases. The formulas for backward propagation are as follows:"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Convolutional Layer Backpropagation:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\frac{\\partial \\mathcal{L}}{\\partial W^{[l]}} = dZ^{[l]} * A^{[l-1]T}  ","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\frac{\\partial \\mathcal{L}}{\\partial b^{[l]}} = \\sum dZ^{[l]} ","styles":"inline-flex"},"children":[]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\frac{\\partial \\mathcal{L}}{\\partial A^{[l-1]}} = W^{[l]T} * dZ^{[l]} ","styles":"inline-flex"},"children":[]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Activation Layer Backpropagation (ReLU):"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\frac{\\partial \\mathcal{L}}{\\partial Z^{[l]}} = dA^{[l]} \\odot \\text{ReLU}'(Z^{[l]})","styles":"inline-flex"},"children":[]}]}]}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Pooling Layer Backpropagation:"},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":" \\frac{\\partial \\mathcal{L}}{\\partial A^{[l-1]}} = \\text{upsample}(dA^{[l]})","styles":"inline-flex"},"children":[]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"These gradients are then used to update the network's parameters via optimization algorithms like gradient descent, enabling the CNN to learn and improve its performance over time through the training process."}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"forward-propagation","depth":2,"text":"Forward Propagation"},{"id":"backward-propagation","depth":2,"text":"Backward Propagation"}]}},"_type":"markdown","_id":"content:topics:ai:cnn.md","_source":"content","_file":"topics/ai/cnn.md","_extension":"md"},{"_path":"/topics/ai/linear-mpc","_dir":"ai","_draft":false,"_partial":false,"_locale":"","_empty":false,"title":"Linear Model Predictive Control","description":"Introduction to Linear Model Predictive Control","author":"Din Sokheng","slug":"linear-mpc","tag":"linear-mpc","img":"/topics/robotics/nmpc/predict_horizon.png","body":{"type":"root","children":[{"type":"element","tag":"h2","props":{"id":"what-is-model-predictive-control"},"children":[{"type":"text","value":"What is Model Predictive Control ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Model Predictive Control (MPC) is the optimal control method that use optimization algorithms to solve the cost function the occurs from the desired input and obtain back the optimal input control over the finite and infinite horizons. Recently, MPC is hyping up among the control system researcher, since it is fast, efficiency and robustness for any high complex system."}]},{"type":"element","tag":"div","props":{"className":["grid","grid-cols-2","space-x-10","justify-center","items-center"]},"children":[{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/predict_horizon.png","width":"600px","height":"300px"},"children":[]},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/set_points.png","width":"600px","height":"300px"},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n      A car with finite horizons prediction and set point prediction over finite horizons.\n"}]},{"type":"element","tag":"h2","props":{"id":"how-it-works"},"children":[{"type":"text","value":"How it works ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It works by solving the cost function that is produced by the sum of quadratic costs. For example, imagine you are riding a bike, and you want to get an ice cream because it is summer, and it tastes good ðŸ˜†. So, to get the ice cream, you need to grab your bike and ride it to the mart to buy one. What does it take to get you from your home to the mart store? Of course, it must be the energy produced by your muscles to pedal the bike and move. Another way to think about it is the cost of how the system would react to the desired position or point that you want it to reach. MPC have two types, they are Linear MPC and Nonlinear MPC. In this blog, we will only talk about Linear MPC."}]},{"type":"element","tag":"h2","props":{"id":"linear-mpc"},"children":[{"type":"text","value":"Linear MPC"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Linear MPC or Linear Model Predictive Control is an optimal control method that use with the system that it behavors linearly. It means that we can easily control this system with lost cost computation of the optimization and also ensure the lower risk of the system too!. "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Here is the formulation of the linear discrete system."}]},{"type":"element","tag":"math-render","props":{":dist-cond":"true",":latex-express":" \\begin{equation*} X_{k+1}=AX_{k}+BU_{k} \\end{equation*}",":styles":"text-center"},"children":[]},{"type":"element","tag":"h2","props":{"id":"formulation"},"children":[{"type":"text","value":"Formulation"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"As I mentioned, this is quadratic cost. It consists of summation of all the cost that was produced over the number of horizontal prediction."}]},{"type":"element","tag":"math-render","props":{"latex-express":"J(x,u) = \\displaystyle\\sum_{k=0}^{N-1}(X_{k, ref}-X_{k})^{T}Q(X_{k, ref}-X_{k})+(U_{k,ref}-U_{k})^{T}R(U_{k,ref}-U_{k}) + \\phi(X_{N}, U_{N})","styles":"text-center"},"children":[]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Notation"}]},{"type":"element","tag":"ul","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"X","styles":"inline-flex space-x-3"},"children":[]},{"type":"text","value":" is the state of the system. This shall be obtained from the optimiztion problem"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"X_{ref}","styles":"inline-flex space-x-3"},"children":[]},{"type":"text","value":" is the reference state of the system or desired input state."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"U","styles":"inline-flex space-x-3"},"children":[]},{"type":"text","value":" is the input control of the system. This is a solution obtained from the optimization problem."}]},{"type":"element","tag":"li","props":{},"children":[{"type":"element","tag":"math-render","props":{"latex-express":"U_{ref}","styles":"inline-flex space-x-3"},"children":[]},{"type":"text","value":" is the reference control of the system or desired input control."}]}]},{"type":"element","tag":"h2","props":{"id":"was-it-really-that-good"},"children":[{"type":"text","value":"Was it really that good ?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I use MPC to control the differential drive robot to move from it zero position the the desired postion that I want to follow !.\nI generate a circle trajectory and I fit this curve into my beautiful and robustness cost and then volia !!!."}]},{"type":"element","tag":"figure","props":{"className":["mb-4","inline-block","max-w-sm"]},"children":[{"type":"text","value":"\n  "},{"type":"element","tag":"img","props":{"className":["mx-auto"],"src":"/topics/robotics/nmpc/diff_mpc.png","width":"600px","height":"300px"},"children":[]}]},{"type":"element","tag":"figcaption","props":{"className":["text-center","text-sm","text-neutral-600","dark:text-neutral-400"]},"children":[{"type":"text","value":"\n    Plot of differential drive robot follow the circle trajectory !!!.\n"}]},{"type":"element","tag":"h2","props":{"id":"how-to-implement-it-in-python"},"children":[{"type":"text","value":"How to implement it in Python?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"There are so many great way to implement this control everywhere with many mathematical optimization library!!!. But for the sake of god, I use Casadi and CVXPY which I think one of the most easy tool to use. I will draft some python code here, but I cannot include them all in this post. You can check it more on my github repository, I do open-source some of my work !!! "},{"type":"element","tag":"a","props":{"href":"https://github.com/SokhengDin/PathTracking","rel":["nofollow"]},"children":[{"type":"text","value":"Github"}]},{"type":"text","value":". "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"I recommend you guys to have your own virtual enviroment, so I would be easier to work with any other related project of control system. "},{"type":"element","tag":"br","props":{},"children":[]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Make sure that you have install."}]},{"type":"element","tag":"code","props":{"className":["language-bash"],"code":"pip3 install casadi && pip3 install cvxpy\n","language":"bash","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"pip3"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"casadi"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" && "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"pip3"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"install"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-244866"},"children":[{"type":"text","value":"cvxpy"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"It is a good idea to write your robot model as a class object in Python, because it can help handle the update state of your system. For me, I am gonna use Numpy for mathematical operation."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"import numpy as np\n\nclass DifferentialDrive:\n\n    def forward_kinematic(self, yaw, v, omega):\n        vx = v * np.cos(yaw)\n        vy = v * np.sin(yaw)\n        vyaw = omega\n\n        return vx, vy, vyaw\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"import"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" numpy "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"as"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"class"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"DifferentialDrive"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"forward_kinematic"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, yaw, v, omega):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        vx "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" v "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.cos(yaw)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        vy "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" v "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" np.sin(yaw)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        vyaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" omega\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" vx, vy, vyaw"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Next add this update state function into our "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":"DifferentialDrive "}]},{"type":"text","value":" class, by doing this we would have all the attribute of our robot system."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"def update_state(self, x0, y0, yaw0, yaw, v, omega):\n\n  dx, dy, dyaw = self.robot_model.forward_kinematic(yaw, v, omega)\n\n  x_next = x0 + dx*self.dtau\n  y_next = y0 + dy*self.dtau\n  yaw_next = yaw0 + dyaw*self.dtau\n\n  return x_next, y_next, yaw_next\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"def"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-806137"},"children":[{"type":"text","value":"update_state"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(self, x0, y0, yaw0, yaw, v, omega):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  dx, dy, dyaw "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".robot_model.forward_kinematic(yaw, v, omega)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  x_next "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x0 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dx"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dtau\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  y_next "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" y0 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dy"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dtau\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  yaw_next "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" yaw0 "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" dyaw"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"*"}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"self"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":".dtau\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"return"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x_next, y_next, yaw_next"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"How to define the quadratic cost in Python with CVXPY ? and set the constraint for your system ? "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nHere, how you would write it."}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"for t in range(T):\n    cost += cvxpy.quad_form(u[:, t], R)\n\n    if t != 0:\n        cost += cvxpy.quad_form(x_ref[:, t] - x[:, t], Q)\n\n    A, B, C = get_linear_model_matrix(x_ref, u_ref)\n    constraints += [x[:, t + 1] == A @ x[:, t] + B @ u[:, t] + C]\n\n    if t < (T - 1):\n        cost += cvxpy.quad_form(u[:, t + 1] - u[:, t], Rd)\n        constraints += [cvxpy.abs(u[1, t + 1] - u[1, t]) <= DESIRED_CONTROL]\n\ncost += cvxpy.quad_form(xref[:, T] - x[:, T], Q)\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"for"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"in"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"range"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"(T):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    cost "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" cvxpy.quad_form(u[:, t], R)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"!="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":":\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        cost "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" cvxpy.quad_form(x_ref[:, t] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x[:, t], Q)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    A, B, C "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" get_linear_model_matrix(x_ref, u_ref)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [x[:, t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" A "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x[:, t] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" B "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"@"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u[:, t] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" C]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"    "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"if"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"<"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" (T "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"):\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":11},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        cost "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" cvxpy.quad_form(u[:, t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u[:, t], Rd)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":12},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"        constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [cvxpy.abs(u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", t "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", t]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"DESIRED_CONTROL"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":13},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":14},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"cost "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" cvxpy.quad_form(xref[:, T] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"-"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x[:, T], Q)"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"The function "},{"type":"element","tag":"strong","props":{},"children":[{"type":"text","value":" get_linear_model_matrix "}]},{"type":"text","value":" would return the linearized model as the shown as the formula above. "},{"type":"element","tag":"br","props":{},"children":[]},{"type":"text","value":"\nWe can set more constraint by adding"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"  constraints += [x[:, 0] == x0]\n  constraints += [x[2, :] <= MAX_SPEED]\n  constraints += [x[2, :] >= MIN_SPEED]\n  constraints += [cvxpy.abs(u[0, :]) <= MAX_ACCEL]\n  constraints += [cvxpy.abs(u[1, :]) <= MAX_STEER]\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [x[:, "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" x0]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [x["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", :] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"MAX_SPEED"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [x["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"2"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", :] "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":">="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"MIN_SPEED"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [cvxpy.abs(u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"0"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", :]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"MAX_ACCEL"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"  constraints "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"+="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" [cvxpy.abs(u["}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", :]) "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"<="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" "}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"MAX_STEER"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"]"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Finally, we define the optimizer for our system by"}]},{"type":"element","tag":"code","props":{"className":["language-python"],"code":"prob = cvxpy.Problem(cvxpy.Minimize(cost), constraints)\nprob.solve(solver=cvxpy.ECOS, verbose=False)\n","language":"python","meta":""},"children":[{"type":"element","tag":"pre","props":{},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"prob "}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":" cvxpy.Problem(cvxpy.Minimize(cost), constraints)\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"prob.solve("}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"solver"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":"cvxpy."}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"ECOS"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":", "}]},{"type":"element","tag":"span","props":{"class":"ct-657843"},"children":[{"type":"text","value":"verbose"}]},{"type":"element","tag":"span","props":{"class":"ct-857441"},"children":[{"type":"text","value":"="}]},{"type":"element","tag":"span","props":{"class":"ct-533739"},"children":[{"type":"text","value":"False"}]},{"type":"element","tag":"span","props":{"class":"ct-767297"},"children":[{"type":"text","value":")"}]}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"For more detail about using CVXPY, here is the link "},{"type":"element","tag":"a","props":{"href":"https://www.cvxpy.org","rel":["nofollow"]},"children":[{"type":"text","value":"CVXPY"}]}]},{"type":"element","tag":"h2","props":{"id":"in-conclusion"},"children":[{"type":"text","value":"In conclusion"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"In my opinion, I think MPC is suitable for the control system, since it can provide the significant control input that was predicted over the finite future of time. This can ensure the safety of the system and also can provide a quick look or reaction to the control action of the system too. Next post, I will explain about Nonlinear Model Predictive Control by using Casadi framework for mathematical optimization."}]},{"type":"element","tag":"h2","props":{"id":"reference"},"children":[{"type":"text","value":"Reference"}]},{"type":"element","tag":"ol","props":{},"children":[{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"PythonRobotics: https://github.com/AtsushiSakai/PythonRobotics/tree/master/PathTracking/model_predictive_speed_and_steer_control"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"Implementation of Linear Model Predictive Control: https://arxiv.org/abs/2109.11986"}]},{"type":"element","tag":"li","props":{},"children":[{"type":"text","value":"CVXPY: https://www.cvxpy.org/"}]}]},{"type":"element","tag":"style","children":[{"type":"text","value":".ct-806137{color:#B392F0;}\n.ct-767297{color:#E1E4E8;}\n.ct-244866{color:#9ECBFF;}\n.ct-857441{color:#F97583;}\n.ct-533739{color:#79B8FF;}\n.ct-657843{color:#FFAB70;}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"what-is-model-predictive-control","depth":2,"text":"What is Model Predictive Control ?"},{"id":"how-it-works","depth":2,"text":"How it works ?"},{"id":"linear-mpc","depth":2,"text":"Linear MPC"},{"id":"formulation","depth":2,"text":"Formulation"},{"id":"was-it-really-that-good","depth":2,"text":"Was it really that good ?"},{"id":"how-to-implement-it-in-python","depth":2,"text":"How to implement it in Python?"},{"id":"in-conclusion","depth":2,"text":"In conclusion"},{"id":"reference","depth":2,"text":"Reference"}]}},"_type":"markdown","_id":"content:topics:ai:linear-mpc.md","_source":"content","_file":"topics/ai/linear-mpc.md","_extension":"md"}]